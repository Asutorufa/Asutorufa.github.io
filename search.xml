<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2021-03-20 01:25AM</title>
    <url>/posts/d67c4794/</url>
    <content><![CDATA[<p>2021-03-20 01:25AM<a id="more"></a><br>第一次出来实习, 住的房子是同事转租给我的, 本来说是去出差, 但是没过几天就辞职了, 走的时候帮我出了500块房租, 还留了不少东西, 我还白住了半个多月没出钱, 我可以说是相当幸运, 第一次出来找工作就有不少人照顾我.<br>刚过来的时候刚好有个学长在这边, 挺照顾我的, 帮了我不少, 还给了我一些东西.<br>因为一直在学校食堂吃饭, 没怎么关注过学校食堂以外的饭馆的价格, 看到外面饭店里菜的价格, 真的是难以接受, 都是15块起步, 吃饱至少得20多, 跟学校里不到10块就能吃饱相比真的是差的很多, 而且自己还要交房租, 一开始我真的很担心实习的工资可能会导致我连饭都吃不起.<br>所以刚开始我都是能省一点就省一点, 除了中午饭, 都是自己在做, 10块钱买的菜可以吃很久, 不过过了一段时间之后就没那么担心了, 可能是因为渐渐对周围熟悉起来了, 也不太担心钱不够花的问题了, 因为在大学就想着省钱, 平时也不买水果啥的, 到了大三,大四得了一些生活习惯病, 飞蚊症,鼻炎,耳鸣… 都是些没法治的病, 刚开始还去医院花了不少钱, 到最后还没治好, 所以现在都是尽量吃的健康, 水果再贵我也要买一些吃.<br>因为大学的时候有了耳鸣, 虽然耳鸣的声音不是很大, 但是我对声音真的很敏感, 一有点声音就会醒的那种, 之前还敢睡觉的时候戴戴耳机, 自从得了耳鸣之后耳机也不敢多戴了, 一直想买一个sony的XM3, 但是好不容易攒的钱, 总是会因为各种原因花掉, 比如因为考试要回学校买机票了(因为现在机票比高铁便宜很多,所以还是买机票了), 而且学校本来给找工作同学发的助学金也发给考研的人了, 可能这就是国情吧, 贫苦生永远拿不到助学金, 拿到助学金的人全去买一双两三千的鞋了, 这正常吗?<br>刚来的时候, 我对面最大那个房间住着一家三口, 小孩还很小, 有时候会哭, 不过一般不到5分钟就不哭了, 感觉还好没那么吵. 现在对面换成一对情侣了, 真的很吵, 一直说话, 半夜12点1点不睡覺还在大笑, 还好签的合同就剩两个月了, 自己也买了新的隔音耳塞, 只能先坚持坚持了, 合同到期我一定要换一个好一点的房子, 贵点也行, 只要隔音比较好.<br>楼上还有一个敲架子鼓的, 这是我没想到的, 居民楼里敲架子鼓, 小区周围的环境也很差, 每天都有装修的, 要不是初来乍到, 我一定不会选择这里的.<br>来到这边基本哪里都没去过, 一部分原因是没钱, 还有一部分原因是自己想干的事太多, 又想学日语, 又想维护自己写的开源项目, 还想看看关注的youtuber新出的视频, 周末对我来说完全不够用, 最近上班摸鱼都有在搞自己的开源项目, 虽然可能一个用的人都没有, 但是我还是想弄好一点, 至少自己用的舒服点.<br>公司的话还好, 虽然没有想象中那么好, 但是还能接受. 主要是管理比较乱, 没有代码规范, 有些代码也写的很有问题, 如果不再改改的, 我相信只会越来越影响效率, 不少地方代码写的很有问题, 整个项目的架构也不太对, 至少从我这个大学还没毕业的来看问题还是不少的. 我不太会说话, 有时候会惹人不高兴或是事后觉得自己说的不对, 对于技术相关的问题有时我真的很想反驳, 但现在都尽量忍住了, 不想让别人觉得我这个后辈很无礼. 有时确实没有共同话题, 比如我现在真的很讨厌bilibili, 对于我来说变味太严重, 但是反而是因为出圈太严重了, 用的人越来越多, 周围同事总是会说昨天我在bilibili上看了什么, 我也不好说什么, 因为我现在已经基本不用它了.<br>自己的话, 除了多了工作和做饭, 习惯基本没什么变化, 平时瞎搞搞电脑, 看看youtube,twitter, 在笔记本上记录一下最近新知道的日语单词, 写写代码.  </p>
]]></content>
      <categories>
        <category>日常</category>
      </categories>
  </entry>
  <entry>
    <title>CIDR匹配 域名匹配</title>
    <url>/posts/3cb4313e/</url>
    <content><![CDATA[<p>所有完整实现代码:<a href="https://github.com/Asutorufa/yuhaiin/tree/master/net/match" target="_blank" rel="noopener">match</a></p>
<h2 id="CIDR"><a href="#CIDR" class="headerlink" title="CIDR"></a>CIDR</h2><p>我们知道cidr对ip匹配时,只要cidr的mask长度的前几位与要匹配的ip相同,则可以说匹配成功.  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">假设有一个cidr为128.0.0.1/24</span><br><span class="line">转换为二进制 1000 0000.0000 0000.0000 0000.0000 0001/24</span><br><span class="line">可以知道要匹配ip的前24为与cidr的前24(1000 0000.0000 0000.0000 0000)位相同则匹配成功</span><br><span class="line">假设有一个ip 128.0.0.128 二进制为 1000 0000.0000 0000.0000 0000.1000 0000</span><br><span class="line">可以看到前24位与cidr相同 则匹配成功</span><br></pre></td></tr></table></figure>

<h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>域名就比较简单了,直接按点分割就行了</p>
<h2 id="前缀树"><a href="#前缀树" class="headerlink" title="前缀树"></a>前缀树</h2><p>通过上述规则 我们可以使用前缀树实现CIDR对ip的匹配</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">        root</span><br><span class="line">       /    \</span><br><span class="line">      0      1</span><br><span class="line">     / \    / \</span><br><span class="line">    0   1  0   1</span><br><span class="line">   /</span><br><span class="line">当ip匹配到此处,此处已无任何子树,且是某一cidr的末尾时则匹配成功</span><br><span class="line">若此处节点为null(golang为nil)且不是某一cidr的末尾时则匹配失败</span><br></pre></td></tr></table></figure>

<p>域名的前缀树相同,只不过域名不再是只有0和1,而且在匹配的时候还需要跳过前面的那些前缀.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">        +---------+</span><br><span class="line">        |  root   |</span><br><span class="line">        +---------+</span><br><span class="line">       /     /      \</span><br><span class="line">facebook   google   twitter  ...</span><br><span class="line">  /        /   \       \</span><br><span class="line">com      com   mail    com   ...</span><br><span class="line">                \</span><br><span class="line">               com</span><br><span class="line"></span><br><span class="line">在对域名匹配时</span><br><span class="line">如对 www.play.google.com匹配:</span><br><span class="line">    没有www  跳过</span><br><span class="line">    没有play 跳过</span><br><span class="line">    有google 继续</span><br><span class="line">    有com 且 域名已为最后一个节点 -&gt; 判断trie中是否为最后的一个子树 -&gt; 是 -&gt; 匹配成功</span><br><span class="line"></span><br><span class="line">这里有一个明显的问题</span><br><span class="line">    比如我们同时插入了music.126.com和163.com</span><br><span class="line">    然后我们需要查询music.163.com是否被匹配</span><br><span class="line">    是不是发现了问题,无法被匹配,因为包含music,我们会匹配到music.126.com这条线,而不是163.com</span><br><span class="line"></span><br><span class="line">这里有个很简单的解决方法,就是把域名倒过来插入,倒过来匹配,就跟JAVA包名那样</span><br><span class="line">        +---------+</span><br><span class="line">        |  root   |</span><br><span class="line">        +---------+</span><br><span class="line">             /</span><br><span class="line">            com        ...</span><br><span class="line">           /   \</span><br><span class="line">         163   126     ...</span><br><span class="line">                 \</span><br><span class="line">                music</span><br><span class="line"></span><br><span class="line">这样就能被正确匹配了,而且会缩短时间,不会去完整匹配整个域名,只匹配后面有的就行了</span><br></pre></td></tr></table></figure>

<p>trie树类似上述结构</p>
<p>trie树节点 我们可以这样写<a id="more"></a><br>+node<br>|- bool(判断是否匹配成功,是否是某一cidr的末尾)<br>|- left(左树代表0)<br>|- right(右树代表1)  </p>
<p>域名的这样写<br>+node<br>|- bool<br>|- domainNode<br>|- next</p>
<h2 id="使用golang实现"><a href="#使用golang实现" class="headerlink" title="使用golang实现"></a>使用golang实现</h2><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line"> isLast <span class="keyword">bool</span></span><br><span class="line">    left   *node</span><br><span class="line">    right  *node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TrieTree <span class="keyword">struct</span> &#123;</span><br><span class="line">    root *node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTrieTree</span><span class="params">()</span> *<span class="title">TrieTree</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;TrieTree&#123;</span><br><span class="line">        root: &amp;node&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对每一个CIDR的插入<br>注意: 此处传入的CIDR为CIDR前mask位的二进制形式</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(trie *TrieTree)</span> <span class="title">Insert</span><span class="params">(str <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    nodeTemp := trie.root</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">        <span class="comment">// 1 byte is 49</span></span><br><span class="line">        <span class="keyword">if</span> str[i] == <span class="number">49</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> nodeTemp.right == <span class="literal">nil</span> &#123;</span><br><span class="line">                nodeTemp.right = <span class="built_in">new</span>(node)</span><br><span class="line">            &#125;</span><br><span class="line">            nodeTemp = nodeTemp.right</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 0 byte is 48</span></span><br><span class="line">        <span class="keyword">if</span> str[i] == <span class="number">48</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> nodeTemp.left == <span class="literal">nil</span> &#123;</span><br><span class="line">                nodeTemp.left = <span class="built_in">new</span>(node)</span><br><span class="line">            &#125;</span><br><span class="line">            nodeTemp = nodeTemp.left</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="built_in">len</span>(str)<span class="number">-1</span> &#123;</span><br><span class="line">            nodeTemp.isLast = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对ip的匹配<br>注意: 此处传入的ip为ip的二进制形式</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(trie *TrieTree)</span> <span class="title">Search</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    nodeTemp := trie.root</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> str[i] == <span class="number">49</span> &#123;</span><br><span class="line">            nodeTemp = nodeTemp.right</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> str[i] == <span class="number">48</span> &#123;</span><br><span class="line">            nodeTemp = nodeTemp.left</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> nodeTemp == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> nodeTemp.isLast == <span class="literal">true</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>CIDR</tag>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>DNS over HTTPS</title>
    <url>/posts/4b39445f/</url>
    <content><![CDATA[<p>这个DNS系列现在有以下几篇文章<br><a href="/posts/f05986bf/">DNS</a>  <a href="/posts/668530ca/">EDNS</a> <a href="/posts/1751943e/">DNSSEC</a> <a href="/posts/4b39445f/">DNS over HTTPS</a> 完整代码请看<a href="https://github.com/Asutorufa/yuhaiin/tree/master/net/dns" target="_blank" rel="noopener">DNS</a></p>
<hr>
<p>DOH就比较简单了,因为DOH使用的请求数据和应答数据均为之前的DNS协议格式,包括DNS,EDNS,DNSSEC…当然是否支持EDNS,DNSSEC需要看DNS服务器的支持情况<br>DOH的最主要的区别是把DNS使用的UDP,换成了HTTPS,这样就能防止DNS污染了,而且可以使用DNSSEC加上ESNI来防止证书劫持,DOH的协议在<a href="https://tools.ietf.org/html/rfc8484" target="_blank" rel="noopener">rfc8484</a>中有定义<br>DOH主要有两种方式HTTP的GET请求和POST的请求</p>
<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><p>GET请求需要使用BASE64对请求的字节数据进行序列化,然后作为参数传递,获取到的数据使用我们之前的解析进行解析就行了</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(dReq []<span class="keyword">byte</span>, server <span class="keyword">string</span>)</span> <span class="params">(body []<span class="keyword">byte</span>, err error)</span></span> &#123;</span><br><span class="line">    query := strings.Replace(base64.URLEncoding.EncodeToString(dReq), <span class="string">"="</span>, <span class="string">""</span>, <span class="number">-1</span>)</span><br><span class="line">    urls := <span class="string">"https://"</span> + server + <span class="string">"/dns-query?dns="</span> + query</span><br><span class="line">    res, err := http.Get(urls)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> res.Body.Close()</span><br><span class="line">    body, err = ioutil.ReadAll(res.Body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><p>POST并不需要进行序列化,直接把原始请求数据作为body就行了</p>
<a id="more"></a>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">post</span><span class="params">(dReq []<span class="keyword">byte</span>, server <span class="keyword">string</span>)</span> <span class="params">(body []<span class="keyword">byte</span>, err error)</span></span> &#123;</span><br><span class="line">    client := &amp;http.Client&#123;Timeout: <span class="number">5</span> * time.Second&#125;</span><br><span class="line">    req, err := http.NewRequest(http.MethodPost, <span class="string">""</span>, bytes.NewReader(dReq))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"DOH:post() newReq -&gt; %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    urls, err := url.Parse(<span class="string">"//"</span> + server)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"DOH:post() urlParse -&gt; %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    req.URL.Scheme = <span class="string">"https"</span></span><br><span class="line">    req.URL.Host = urls.Host</span><br><span class="line">    req.URL.Path = urls.Path + <span class="string">"/dns-query"</span></span><br><span class="line">    req.Header.Set(<span class="string">"accept"</span>, <span class="string">"application/dns-message"</span>)</span><br><span class="line">    req.Header.Set(<span class="string">"content-type"</span>, <span class="string">"application/dns-message"</span>)</span><br><span class="line">    req.ContentLength = <span class="keyword">int64</span>(<span class="built_in">len</span>(dReq))</span><br><span class="line"></span><br><span class="line">    resp, err := client.Do(req)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"DOH:post() req -&gt; %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    body, err = ioutil.ReadAll(resp.Body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"DOH:post() readBody -&gt; %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码请看开头</p>
<hr>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc8484" target="_blank" rel="noopener">rfc8484</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>DNS</tag>
        <tag>DOH</tag>
      </tags>
  </entry>
  <entry>
    <title>CRI 容器运行时接口</title>
    <url>/posts/8144a111/</url>
    <content><![CDATA[<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+----------------+       +-----------------+</span><br><span class="line">|  kubelet       |       |   CRI shim      |</span><br><span class="line">| +-----------+  |       |  +-----------+  |      +-----------+</span><br><span class="line">| |grpc client|&lt;-|-------|-&gt;|grpc server|  |&lt;----&gt;| container |</span><br><span class="line">| +-----------+  |       |  +-----------+  |      |  runtime  |</span><br><span class="line">+----------------+       +-----------------+      +-----------+</span><br></pre></td></tr></table></figure>

<h2 id="CRI-shim"><a href="#CRI-shim" class="headerlink" title="CRI shim"></a>CRI shim</h2><ul>
<li>cri-o</li>
<li>cri-containerd</li>
<li>rkt</li>
<li>frakti</li>
<li>docker (cri-dockerd)</li>
</ul>
<h2 id="container-runtime"><a href="#container-runtime" class="headerlink" title="container runtime"></a>container runtime</h2><ul>
<li>gvisor</li>
<li>kata containers</li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>CRI</tag>
        <tag>container</tag>
      </tags>
  </entry>
  <entry>
    <title>DNSSEC</title>
    <url>/posts/1751943e/</url>
    <content><![CDATA[<p>这个DNS系列现在有以下几篇文章<br><a href="/posts/f05986bf/">DNS</a>  <a href="/posts/668530ca/">EDNS</a> <a href="/posts/1751943e/">DNSSEC</a> <a href="/posts/4b39445f/">DNS over HTTPS</a> 完整代码请看<a href="https://github.com/Asutorufa/yuhaiin/tree/master/net/dns" target="_blank" rel="noopener">DNS</a></p>
<hr>
<p>注意: 这里我只完成了请求字段,主要原因是因为我学习这些DNS协议是为了找到防止DNS污染的方法,而DNSSEC并不能,而且应答头比较复杂,可能还要了解ssl和tls的知识,所以这里我没有完成代码,想了解的请看<a href="https://tools.ietf.org/html/rfc3225" target="_blank" rel="noopener">protocol change</a> <a href="https://tools.ietf.org/html/rfc4034" target="_blank" rel="noopener">rfc4034</a> <a href="https://tools.ietf.org/html/rfc4035" target="_blank" rel="noopener">rfc4035</a> <a href="https://tools.ietf.org/html/rfc4034#appendix-A.1" target="_blank" rel="noopener">Algorithm</a>  </p>
<p>DNSSEC也是使用了EDNS,而且只需要改一个字段,就是之前提到Z,具体协议请看</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">          +0 (MSB)                +1 (LSB)</span></span><br><span class="line">   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">0: |   EXTENDED-RCODE      |       VERSION         |</span><br><span class="line">   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">2: |DO|                    Z                       |</span><br><span class="line">   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br></pre></td></tr></table></figure>

<p>完成请求头</p>
<a id="more"></a>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> eDNSHeader <span class="keyword">struct</span> &#123;</span><br><span class="line">    DnsHeader   []<span class="keyword">byte</span></span><br><span class="line">    Name        [<span class="number">1</span>]<span class="keyword">byte</span></span><br><span class="line">    Type        [<span class="number">2</span>]<span class="keyword">byte</span></span><br><span class="line">    PayloadSize [<span class="number">2</span>]<span class="keyword">byte</span></span><br><span class="line">    ExtendRCode [<span class="number">1</span>]<span class="keyword">byte</span></span><br><span class="line">    EDNSVersion [<span class="number">1</span>]<span class="keyword">byte</span></span><br><span class="line">    Z           [<span class="number">2</span>]<span class="keyword">byte</span></span><br><span class="line">    Data        []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createDNSSEC</span><span class="params">(domain <span class="keyword">string</span>, reqType2 reqType)</span> <span class="params">(header eDNSHeader, b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">//eDNSHeader := createEDNSReq(domain,reqType2,[]byte&#123;&#125;)</span></span><br><span class="line">    header = eDNSHeader&#123;&#125;</span><br><span class="line">    header.DnsHeader = creatRequest(domain, reqType2)</span><br><span class="line">    header.Name[<span class="number">0</span>] = <span class="number">0</span>b0</span><br><span class="line">    header.Type = [<span class="number">2</span>]<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00101001&#125;</span><br><span class="line">    header.PayloadSize = [<span class="number">2</span>]<span class="keyword">byte</span>&#123;<span class="number">0</span>b00010000, <span class="number">0</span>b00000000&#125; <span class="comment">//4096</span></span><br><span class="line">    header.ExtendRCode = [<span class="number">1</span>]<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;</span><br><span class="line">    header.EDNSVersion = [<span class="number">1</span>]<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;</span><br><span class="line">    header.Z = [<span class="number">2</span>]<span class="keyword">byte</span>&#123;<span class="number">0</span>b10000000, <span class="number">0</span>b00000000&#125; <span class="comment">// Do bit = 1</span></span><br><span class="line">    <span class="keyword">return</span> header, createEDNSRequ(header)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是不是很简单,再结合之前的EDNS就能完成完整的请求</p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>DNS</tag>
        <tag>UDP</tag>
        <tag>DNSSEC</tag>
      </tags>
  </entry>
  <entry>
    <title>DNS客户端协议详解</title>
    <url>/posts/f05986bf/</url>
    <content><![CDATA[<p>这个DNS系列现在有以下几篇文章<br><a href="/posts/f05986bf/">DNS</a>  <a href="/posts/668530ca/">EDNS</a> <a href="/posts/1751943e/">DNSSEC</a> <a href="/posts/4b39445f/">DNS over HTTPS</a> 完整代码请看<a href="https://github.com/Asutorufa/yuhaiin/tree/master/net/dns" target="_blank" rel="noopener">DNS</a></p>
<h2 id="DNS-Header"><a href="#DNS-Header" class="headerlink" title="DNS Header"></a>DNS Header</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                1  1  1  1  1  1</span><br><span class="line">  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                      ID                       |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    QDCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    ANCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    NSCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    ARCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br></pre></td></tr></table></figure>

<p>header在dns请求和应答中相同的,查询中有Query Section,应答中有answer section.</p>
<ul>
<li>ID: 2字节,应答中也有ID,可以用来判断是否为我们请求的应答</li>
<li>QR：1bit,请求时为0,应答时为1</li>
<li>Opcode：4bit 通常值为0（标准查询），其他值为1（反向查询）和2（服务器状态请求）,[3,15]保留值</li>
<li>AA：1bit authoritative answer,在应答中才有效</li>
<li>TC：1bit 表示可截断</li>
<li>RD：1bit 期望使用递归查询</li>
<li>RA：1bit 在应答中返回,返回服务器是否支持递归查询</li>
<li>Z： Reserved for future use.</li>
<li>RCODE：4bit,应答码,代表返回的状态<ul>
<li>0 No Error</li>
<li>1 Format error 格式错误</li>
<li>2 Server failure 服务器失败</li>
<li>3 Name Error 查询域名错误</li>
<li>4 Not Implemented 未实现的查询方式</li>
<li>5 Refused 拒绝</li>
<li>6-15 Reserved for future use.<a id="more"></a></li>
</ul>
</li>
<li>QDCOUNT 请求的个数</li>
<li>ANCOUNT 应答的个数</li>
<li>NSCOUNT 无符号16bit整数表示报文授权段中的授权记录数。</li>
<li>ARCOUNT 无符号16bit整数表示报文附加段中的附加记录数。</li>
</ul>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                1  1  1  1  1  1</span><br><span class="line">  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                                               |</span><br><span class="line">/                     QNAME                     /</span><br><span class="line">/                                               /</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                     QTYPE                     |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                     QCLASS                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br></pre></td></tr></table></figure>

<ul>
<li><p>QNAME：不定长,格式为域名以点分割的长度,末尾以0结尾,例如:</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www.google.com -&gt; 3www6google3com0</span><br></pre></td></tr></table></figure>
</li>
<li><p>QTYPE:查询的类型<br>  常用的我们需要知道A为IPV4,AAAA为IPV6</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TYPE            value and meaning</span><br><span class="line">A               1 a host address</span><br><span class="line">NS              2 an authoritative name server</span><br><span class="line">MD              3 a mail destination (Obsolete - use MX)</span><br><span class="line">MF              4 a mail forwarder (Obsolete - use MX)</span><br><span class="line">CNAME           5 the canonical name for an alias</span><br><span class="line">SOA             6 marks the start of a zone of authority</span><br><span class="line">MB              7 a mailbox domain name (EXPERIMENTAL)</span><br><span class="line">MG              8 a mail group member (EXPERIMENTAL)</span><br><span class="line">MR              9 a mail rename domain name (EXPERIMENTAL)</span><br><span class="line">NULL            10 a null RR (EXPERIMENTAL)</span><br><span class="line">WKS             11 a well known service description</span><br><span class="line">PTR             12 a domain name pointer</span><br><span class="line">HINFO           13 host information</span><br><span class="line">MINFO           14 mailbox or mail list information</span><br><span class="line">MX              15 mail exchange</span><br><span class="line">TXT             16 text strings</span><br><span class="line"></span><br><span class="line">AAAA            28 &lt;- https://www.ietf.org/rfc/rfc3596.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>QCLASS：无符号16bit整数表示查询的类,比如，IN代表Internet.</p>
</li>
</ul>
<p>现在我们来完成生成请求的代码<br>使用全局变量来存储请求的类型</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> reqType [<span class="number">2</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    A     = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000001&#125; <span class="comment">// 1</span></span><br><span class="line">    NS    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000010&#125; <span class="comment">// 2</span></span><br><span class="line">    MD    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000011&#125; <span class="comment">// 3</span></span><br><span class="line">    MF    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000100&#125; <span class="comment">// 3</span></span><br><span class="line">    CNAME = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000101&#125; <span class="comment">// 5</span></span><br><span class="line">    SOA   = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000110&#125; <span class="comment">// 6</span></span><br><span class="line">    MB    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000111&#125; <span class="comment">// 7</span></span><br><span class="line">    MG    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001000&#125; <span class="comment">// 8</span></span><br><span class="line">    MR    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001001&#125; <span class="comment">// 9</span></span><br><span class="line">    NULL  = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001010&#125; <span class="comment">// 10</span></span><br><span class="line">    WKS   = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001011&#125; <span class="comment">// 11</span></span><br><span class="line">    PTR   = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001100&#125; <span class="comment">// 12</span></span><br><span class="line">    HINFO = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001101&#125; <span class="comment">// 13</span></span><br><span class="line">    MINFO = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001110&#125; <span class="comment">// 14</span></span><br><span class="line">    MX    = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001111&#125; <span class="comment">// 15</span></span><br><span class="line">    TXT   = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00010000&#125; <span class="comment">// 16</span></span><br><span class="line">    AAAA  = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00011100&#125; <span class="comment">// 28 https://www.ietf.org/rfc/rfc3596.txt</span></span><br><span class="line">    <span class="comment">// for req</span></span><br><span class="line">    AXFR = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b11111100&#125; <span class="comment">// 252</span></span><br><span class="line">    ANY  = reqType&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b11111111&#125; <span class="comment">// 255</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这里需要注意有些字段是以位的大小来存储的,需要使用移位运算符来计算(在完成这个协议前,我写了socks5,因为socks5中全部为字节的大小,可能有人会出现与我相同的错误,所以需要注意一下)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">creatRequest</span><span class="params">(domain <span class="keyword">string</span>, reqType reqType)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">    id := []<span class="keyword">byte</span>&#123;<span class="keyword">byte</span>(rand.Intn(<span class="number">255</span>)), <span class="keyword">byte</span>(rand.Intn(<span class="number">255</span>))&#125; <span class="comment">// id:</span></span><br><span class="line">    qr := <span class="keyword">byte</span>(<span class="number">0</span>b0)                                          <span class="comment">// qr 0</span></span><br><span class="line">    opCode := <span class="keyword">byte</span>(<span class="number">0</span>b0000)                                   <span class="comment">// opcode 0000</span></span><br><span class="line">    aa := <span class="keyword">byte</span>(<span class="number">0</span>b0)                                          <span class="comment">// aa 0</span></span><br><span class="line">    tc := <span class="keyword">byte</span>(<span class="number">0</span>b0)                                          <span class="comment">// tc 0</span></span><br><span class="line">    rd := <span class="keyword">byte</span>(<span class="number">0</span>b1)                                          <span class="comment">// rd 1</span></span><br><span class="line">    ra := <span class="keyword">byte</span>(<span class="number">0</span>b0)                                          <span class="comment">// ra 0</span></span><br><span class="line">    z := <span class="keyword">byte</span>(<span class="number">0</span>b000)                                         <span class="comment">// z 000</span></span><br><span class="line">    rCode := <span class="keyword">byte</span>(<span class="number">0</span>b0000)                                    <span class="comment">// rCode 0000</span></span><br><span class="line">    qr2rCode := []<span class="keyword">byte</span>&#123;qr&lt;&lt;<span class="number">7</span> + opCode&lt;&lt;<span class="number">3</span> + aa&lt;&lt;<span class="number">2</span> + tc&lt;&lt;<span class="number">1</span> + rd, ra&lt;&lt;<span class="number">7</span> + z&lt;&lt;<span class="number">4</span> + rCode&#125;</span><br><span class="line">    qdCount := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000001&#125; <span class="comment">// request number =&gt; bit: 00000000 00000001 -&gt; 01</span></span><br><span class="line">    anCount := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000000&#125; <span class="comment">// answer number(no use for req) =&gt; bit: 00000000 00000000</span></span><br><span class="line">    nsCount := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000000&#125; <span class="comment">//(no use for req) =&gt; bit: 00000000 00000000</span></span><br><span class="line">    arCount := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000000&#125; <span class="comment">//(no use for req) =&gt; bit: 00000000 00000000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> qName []<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> strings.Split(domain, <span class="string">"."</span>) &#123;</span><br><span class="line">        qName = <span class="built_in">append</span>(qName, <span class="keyword">byte</span>(<span class="built_in">len</span>(x)))</span><br><span class="line">        qName = <span class="built_in">append</span>(qName, []<span class="keyword">byte</span>(x)...)</span><br><span class="line">    &#125;</span><br><span class="line">    qName = <span class="built_in">append</span>(qName, <span class="number">0</span>b00000000) <span class="comment">// add the 0 for last of domain</span></span><br><span class="line"></span><br><span class="line">    qType := []<span class="keyword">byte</span>&#123;reqType[<span class="number">0</span>], reqType[<span class="number">1</span>]&#125;  <span class="comment">// type:</span></span><br><span class="line">    qClass := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000001&#125; <span class="comment">// 1 -&gt; from internet</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bytes.Join([][]<span class="keyword">byte</span>&#123;id, qr2rCode, qdCount, anCount, nsCount, arCount, qName, qType, qClass&#125;, []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们已经得到了完整的请求字节数组,然后使用UDP协议发起请求就行了：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 此处以www.google.com及1111 DNS为例</span></span><br><span class="line">req := creatRequest(<span class="string">"www.google.com"</span>, A)</span><br><span class="line">conn, err := net.DialTimeout(<span class="string">"udp"</span>, <span class="string">"1.1.1.1:53"</span>, <span class="number">5</span>*time.Second)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> conn.Close()</span><br><span class="line"><span class="keyword">if</span> _, err = conn.Write(req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">_ = conn.SetDeadline(time.Now().Add(<span class="number">5</span> * time.Second))</span><br><span class="line">n, err := conn.Read(b[:])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就需要解析应答请求了,来获取我们需要的数据.</p>
<h2 id="应答"><a href="#应答" class="headerlink" title="应答"></a>应答</h2><p>应答数据中具有header和请求字段,所以我们可以先写一个resovle header来分析header.<br>之前我们完成了域名编码的代码,就是<code>3www6google3com0</code>这个,这里我们还需要完成一个解析的.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getName</span><span class="params">(c []<span class="keyword">byte</span>, all []<span class="keyword">byte</span>)</span> <span class="params">(name <span class="keyword">string</span>, x []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> c[<span class="number">0</span>]&amp;<span class="number">128</span> == <span class="number">128</span> &amp;&amp; c[<span class="number">0</span>]&amp;<span class="number">64</span> == <span class="number">64</span> &#123; <span class="comment">// &lt;- 这里的这个会在下面的answer section中解释</span></span><br><span class="line">            l := c[<span class="number">1</span>]</span><br><span class="line">            c = c[<span class="number">2</span>:]</span><br><span class="line">            tmp, _ := getName(all[l:], all)</span><br><span class="line">            name += tmp</span><br><span class="line">            <span class="comment">//log.Println(c, name)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        name += <span class="keyword">string</span>(c[<span class="number">1</span>:<span class="keyword">int</span>(c[<span class="number">0</span>])+<span class="number">1</span>]) + <span class="string">"."</span></span><br><span class="line">        c = c[<span class="keyword">int</span>(c[<span class="number">0</span>])+<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> c[<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line">            c = c[<span class="number">1</span>:] <span class="comment">// lastOfDomain: one byte 0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> name, c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后就可以来分析header了：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolveHeader</span><span class="params">(req []<span class="keyword">byte</span>, answer []<span class="keyword">byte</span>)</span> <span class="params">(anCount <span class="keyword">int</span>, answerSection []<span class="keyword">byte</span>, err error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// resolve answer</span></span><br><span class="line">    <span class="keyword">if</span> answer[<span class="number">0</span>] != req[<span class="number">0</span>] || answer[<span class="number">1</span>] != req[<span class="number">1</span>] &#123; <span class="comment">// compare id</span></span><br><span class="line">        <span class="comment">// not the answer</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"id not same"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> answer[<span class="number">2</span>]&amp;<span class="number">8</span> != <span class="number">0</span> &#123; <span class="comment">// check the QR is 1(Answer)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"the qr is not 1(Answer)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rCode := fmt.Sprintf(<span class="string">"%08b"</span>, answer[<span class="number">3</span>])[<span class="number">4</span>:] <span class="comment">// check Response code(rCode)</span></span><br><span class="line">    <span class="keyword">switch</span> rCode &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0000"</span>: <span class="comment">// no error</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0001"</span>: <span class="comment">// Format error</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"request format error"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0010"</span>: <span class="comment">//Server failure</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"dns Server failure"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0011"</span>: <span class="comment">//Name Error</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"no such name"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0100"</span>: <span class="comment">// Not Implemented</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"dns server not support this request"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"0101"</span>: <span class="comment">//Refused</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"dns server Refuse"</span>)</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// Reserved for future use.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, errors.New(<span class="string">"other error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//qdCountA := []byte&#123;b[4], b[5]&#125;  // no use, for request</span></span><br><span class="line">    <span class="comment">//anCountA := []byte&#123;answer[6], answer[7]&#125;</span></span><br><span class="line">    anCount = <span class="keyword">int</span>(answer[<span class="number">6</span>])&lt;&lt;<span class="number">8</span> + <span class="keyword">int</span>(answer[<span class="number">7</span>])</span><br><span class="line">    <span class="comment">//nsCount2arCountA := []byte&#123;b[8], b[9], b[10], b[11]&#125; // no use</span></span><br><span class="line"></span><br><span class="line">    c := answer[<span class="number">12</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">string</span></span><br><span class="line">    x, c = getName(c, answer)</span><br><span class="line">    log.Println(x)</span><br><span class="line">    </span><br><span class="line">    log.Println(<span class="string">"qType:"</span>, c[:<span class="number">2</span>])</span><br><span class="line">    c = c[<span class="number">2</span>:]</span><br><span class="line">    log.Println(<span class="string">"qClass:"</span>, c[:<span class="number">2</span>])</span><br><span class="line">    c = c[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> anCount, c, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后就是我们真正需要的数据,Answer section</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                               1  1  1  1  1  1</span><br><span class="line">  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                                               |</span><br><span class="line">/                                               /</span><br><span class="line">/                      NAME                     /</span><br><span class="line">|                                               |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                      TYPE                     |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                     CLASS                     |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                      TTL                      |</span><br><span class="line">|                                               |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                   RDLENGTH                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|</span><br><span class="line">/                     RDATA                     /</span><br><span class="line">/                                               /</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br></pre></td></tr></table></figure>

<ul>
<li>NAME：不定长与之前QNAME相同,这里会使用省略字段：前两bit为11表示压缩格式，而后面跟的14bit表示的是Name所在的位置相对于DNS首部的偏移值<br>  如：之前的header数组中出现过3www6google3com0,且处的位置为12,这里就可以用192 12两个字节来省略(192是因为11000000,前两位为11)</li>
<li>QTYPE：与之前的TYPE相同</li>
<li>CLASS：与之前的QCLASS相同</li>
<li>TTL: 就是TTL 可以使用搜索引擎查询一下</li>
<li>RDLENGTH: RDATA的长度</li>
</ul>
<p>这个Answer section与之前的header不同,并不是只出现一次,与header中ANCOUNT有关,如果ANCOUNT不为1,后面就会出现多个,要使用循环来获取所有应答数据</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// resolve answer</span></span><br><span class="line">anCount, c, err := resolveHeader(req, b[:n])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// answer section</span></span><br><span class="line">log.Println()</span><br><span class="line">log.Println(<span class="string">"Answer section:"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">string</span></span><br><span class="line"><span class="keyword">for</span> anCount != <span class="number">0</span> &#123;</span><br><span class="line">    x, c = getName(c, b[:n])</span><br><span class="line">    log.Println(x)</span><br><span class="line"></span><br><span class="line">    tYPE := reqType&#123;c[<span class="number">0</span>], c[<span class="number">1</span>]&#125;</span><br><span class="line">    log.Println(<span class="string">"type:"</span>, c[<span class="number">0</span>], c[<span class="number">1</span>])</span><br><span class="line">    c = c[<span class="number">2</span>:] <span class="comment">// type</span></span><br><span class="line">    log.Println(<span class="string">"class:"</span>, c[<span class="number">0</span>], c[<span class="number">1</span>])</span><br><span class="line">    c = c[<span class="number">2</span>:] <span class="comment">// class</span></span><br><span class="line">    log.Println(<span class="string">"ttl:"</span>, c[<span class="number">0</span>], c[<span class="number">1</span>], c[<span class="number">2</span>], c[<span class="number">3</span>])</span><br><span class="line">    c = c[<span class="number">4</span>:] <span class="comment">// ttl 4byte</span></span><br><span class="line">    sum := <span class="keyword">int</span>(c[<span class="number">0</span>])&lt;&lt;<span class="number">8</span> + <span class="keyword">int</span>(c[<span class="number">1</span>])</span><br><span class="line">    log.Println(<span class="string">"rdlength"</span>, sum)</span><br><span class="line">    c = c[<span class="number">2</span>:] <span class="comment">// RDLENGTH  跳过总和，因为总和不包括计算域名的长度 2+int(c[0])&lt;&lt;8+int(c[1])</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> tYPE &#123;</span><br><span class="line">    <span class="keyword">case</span> A:</span><br><span class="line">        DNS = <span class="built_in">append</span>(DNS, c[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">        c = c[<span class="number">4</span>:] <span class="comment">// 4 byte ip addr</span></span><br><span class="line">    <span class="keyword">case</span> AAAA:</span><br><span class="line">        DNS = <span class="built_in">append</span>(DNS, c[<span class="number">0</span>:<span class="number">16</span>])</span><br><span class="line">        c = c[<span class="number">16</span>:] <span class="comment">// 16 byte ip addr</span></span><br><span class="line">    <span class="keyword">case</span> NS:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MD:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MF:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> CNAME:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> SOA:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MG:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MB:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MR:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> NULL:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> WKS:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> PTR:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> HINFO:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MINFO:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> MX:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> TXT:</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        log.Println(<span class="string">"rdata"</span>, c[:sum])</span><br><span class="line">        c = c[sum:] <span class="comment">// RDATA</span></span><br><span class="line">    &#125;</span><br><span class="line">    anCount -= <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然这里我只处理了A,和AAAA的请求类型,但是每个类型的数据格式在<a href="https://www.ietf.org/rfc/rfc1035.txt" target="_blank" rel="noopener">rfc1035</a>都有详细记录,想要自己实现并不难,毕竟我们已经完成的大部分的数据解析,剩下的一点也应该问题不大.</p>
<hr>
<blockquote>
<p><a href="https://www.ietf.org/rfc/rfc1035.txt" target="_blank" rel="noopener">rfc1035</a><br><a href="https://www.ietf.org/rfc/rfc3596.txt" target="_blank" rel="noopener">rfc3596</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>DNS</tag>
        <tag>UDP</tag>
      </tags>
  </entry>
  <entry>
    <title>EDNS</title>
    <url>/posts/668530ca/</url>
    <content><![CDATA[<p>这个DNS系列现在有以下几篇文章<br><a href="/posts/f05986bf/">DNS</a>  <a href="/posts/668530ca/">EDNS</a> <a href="/posts/1751943e/">DNSSEC</a> <a href="/posts/4b39445f/">DNS over HTTPS</a> 完整代码请看<a href="https://github.com/Asutorufa/yuhaiin/tree/master/net/dns" target="_blank" rel="noopener">DNS</a></p>
<h2 id="EDNS"><a href="#EDNS" class="headerlink" title="EDNS"></a>EDNS</h2><p>上一篇我们写了DNS,EDNS就是DNS的功能扩充.<br>上一篇的DNS里头部有ARCOUNT的计数,EDNS就包含在那个里面,EDNS发送的请求在请求头之后的Additional中,应答在Answer和Authoritative之后,我们可看以下图,跟清晰了吧</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">|        Header       |</span><br><span class="line">+---------------------+</span><br><span class="line">|       Question      | the question for the name server</span><br><span class="line">+---------------------+</span><br><span class="line">|        Answer       | RRs answering the question</span><br><span class="line">+---------------------+</span><br><span class="line">|      Authority      | RRs pointing toward an authority</span><br><span class="line">+---------------------+</span><br><span class="line">|      Additional     | RRs holding additional information</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<h2 id="协议格式"><a href="#协议格式" class="headerlink" title="协议格式"></a>协议格式</h2><p>具体协议内容请看<a href="https://tools.ietf.org/html/rfc2671" target="_blank" rel="noopener">rfc2671</a>,<a href="https://tools.ietf.org/html/rfc7871" target="_blank" rel="noopener">rfc7871</a></p>
<a id="more"></a>
<p>Additinoal包含以下部分</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">     Field Name   Field Type     Description</span></span><br><span class="line"><span class="code">     ------------------------------------------------------</span></span><br><span class="line"><span class="code">     NAME         domain name    empty (root domain)</span></span><br><span class="line"><span class="code">     TYPE         u_int16_t      OPT</span></span><br><span class="line"><span class="code">     CLASS        u_int16_t      sender's UDP payload size</span></span><br><span class="line"><span class="code">     TTL          u_int32_t      extended RCODE and flags</span></span><br><span class="line"><span class="code">     RDLEN        u_int16_t      describes RDATA</span></span><br><span class="line"><span class="code">     RDATA        octet stream   &#123;attribute,value&#125; pairs</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TTL中的东西并不是我们之前说到的TTL,这里的TTL只是一个名称,没有具体的含义,TTL中包含以下内容</span><br><span class="line"></span><br><span class="line"><span class="code">                      +0 (MSB)                            +1 (LSB)</span></span><br><span class="line"><span class="code">      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line">   0: |         EXTENDED-RCODE        |            VERSION            |</span><br><span class="line"><span class="code">      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line">   2: |                               Z                               |</span><br><span class="line"><span class="code">      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   EXTENDED-RCODE  Forms upper 8 bits of extended 12-bit RCODE.  Note</span><br><span class="line"><span class="code">                   that EXTENDED-RCODE value "0" indicates that an</span></span><br><span class="line"><span class="code">                   unextended RCODE is in use (values "0" through "15").</span></span><br><span class="line">   VERSION         EDNS VERSION</span><br><span class="line">   Z               Set to zero by senders and ignored by receivers,</span><br><span class="line"><span class="code">                   unless modified in a subsequent specification.</span></span><br><span class="line"></span><br><span class="line">这里Z我们之后会用到(不是这一篇文章)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RDATA中就是对各种扩充功能的请求字段,而每个不同的功能又有着不同的请求协议</span><br><span class="line">RDATA的格式如下</span><br><span class="line"></span><br><span class="line"><span class="code">                +0 (MSB)                            +1 (LSB)</span></span><br><span class="line"><span class="code">     +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line">  0: |                          OPTION-CODE                          |</span><br><span class="line"><span class="code">     +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line">  2: |                         OPTION-LENGTH                         |</span><br><span class="line"><span class="code">     +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line">  4: |                                                               |</span><br><span class="line"><span class="code">     /                          OPTION-DATA                          /</span></span><br><span class="line"><span class="code">     /                                                               /</span></span><br><span class="line"><span class="code">     +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line"></span><br><span class="line">   OPTION-CODE    (Assigned by IANA.)</span><br><span class="line">   OPTION-LENGTH  Size (in octets) of OPTION-DATA.</span><br><span class="line">   OPTION-DATA    Varies per OPTION-CODE.</span><br><span class="line"></span><br><span class="line">如SubNet中的请求字段就包含在其中RDATA中,所以我们要先完成SubNet的字节数组</span><br><span class="line">才能生成一个Additional,因为请求中需要数据的长度RDLEN</span><br></pre></td></tr></table></figure>

<p>因为EDNS中扩展的协议非常多,这里我们就以常用的SubNet为例吧,更多其他类型请看<a href="https://www.iana.org/assignments/dns-parameters/dns-parameters.xhtml#dns-parameters-11" target="_blank" rel="noopener">dns-parameters</a><br>因为我们以SubNet为例,所以先要了解下SubNet的具体协议格式</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">             +0 (MSB)                            +1 (LSB)</span></span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">0: |                          OPTION-CODE                          |</span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">2: |                         OPTION-LENGTH                         |</span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">4: |                            FAMILY                             |</span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">6: |     SOURCE PREFIX-LENGTH      |     SCOPE PREFIX-LENGTH       |</span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line">8: |                           ADDRESS...                          /</span><br><span class="line">   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span><br><span class="line"></span><br><span class="line">o  SOURCE PREFIX-LENGTH, an unsigned octet representing the leftmost</span><br><span class="line">   number of significant bits of ADDRESS to be used for the lookup.</span><br><span class="line">   In responses, it mirrors the same value as in the queries.</span><br><span class="line"></span><br><span class="line">o  SCOPE PREFIX-LENGTH, an unsigned octet representing the leftmost</span><br><span class="line">   number of significant bits of ADDRESS that the response covers.</span><br><span class="line">   In queries, it MUST be set to 0.</span><br><span class="line"></span><br><span class="line">o  ADDRESS, variable number of octets, contains either an IPv4 or</span><br><span class="line">   IPv6 address, depending on FAMILY, which MUST be truncated to the</span><br><span class="line">   number of bits indicated by the SOURCE PREFIX-LENGTH field,</span><br><span class="line">   padding with 0 bits to pad to the end of the last octet needed.</span><br></pre></td></tr></table></figure>

<p>这里前面三个字段就是我们之前RDATA中规定的协议格式,后面就是SubNet的格式<br>SubNet的OPTION-CODE为8,<br>        OPTION-LENGTH就是完成之后的长度<br>        FAMILY表示设置的IP的类型 IPv4为1,IPv6为2 更多类型请看<a href="https://www.iana.org/assignments/address-family-numbers/address-family-numbers.xhtml" target="_blank" rel="noopener">address-family-numbers</a><br>        SOURCE PREFIX-LENGTH为查询中位置偏移(就是CIDR中的mask),具体请了解CIDR,是计算机网络很基础的知识<br>        SCOPE PREFIX-LENGTH是响应返回的位置偏移,在查询中应为0<br>        ADDRESS就是设置的SubNet的IP地址,依据上面的FAMILY</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>看过具体协议格式规定后,我们就可以来完成代码了  </p>
<p>先定义以下各种请求的OPTION-CODE</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    Reserved         = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000000&#125; <span class="comment">//0</span></span><br><span class="line">    LLQ              = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000001&#125; <span class="comment">//1 Optional</span></span><br><span class="line">    UL               = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000010&#125; <span class="comment">//2 On-hold</span></span><br><span class="line">    NSID             = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000011&#125; <span class="comment">//3 Standard</span></span><br><span class="line">    Reserved2        = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000100&#125; <span class="comment">//4</span></span><br><span class="line">    DAU              = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000101&#125; <span class="comment">//5 Standard</span></span><br><span class="line">    DHU              = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000110&#125; <span class="comment">//6 Standard</span></span><br><span class="line">    N3U              = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000111&#125; <span class="comment">//7 Standard</span></span><br><span class="line">    EdnsClientSubnet = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001000&#125; <span class="comment">//8 Optional</span></span><br><span class="line">    EDNSEXPIRE       = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001001&#125; <span class="comment">//9 Optional</span></span><br><span class="line">    COOKIE           = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001010&#125; <span class="comment">//10 Standard</span></span><br><span class="line">    TcpKeepalive     = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001011&#125; <span class="comment">//11 Standard</span></span><br><span class="line">    Padding          = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001100&#125; <span class="comment">//12 Standard</span></span><br><span class="line">    CHAIN            = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001101&#125; <span class="comment">//13 Standard</span></span><br><span class="line">    KEYTAG           = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001110&#125; <span class="comment">//14 Optional</span></span><br><span class="line">    ExtendedDNSError = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00001111&#125; <span class="comment">//15 Standard</span></span><br><span class="line">    EDNSClientTag    = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00010000&#125; <span class="comment">//16 Optional</span></span><br><span class="line">    EDNSServerTag    = EDNSOPT&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00010001&#125; <span class="comment">//17 Optional</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然后完成SubNet的</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createEdnsClientSubnet</span><span class="params">(ip net.IP)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">    optionCode := []<span class="keyword">byte</span>&#123;EdnsClientSubnet[<span class="number">0</span>], EdnsClientSubnet[<span class="number">1</span>]&#125;</span><br><span class="line"></span><br><span class="line">    family := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000001&#125; <span class="comment">// 1:Ipv4 2:IPv6 https://www.iana.org/assignments/address-family-numbers/address-family-numbers.xhtml</span></span><br><span class="line">    sourceNetmask := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00100000&#125;      <span class="comment">// 32</span></span><br><span class="line">    scopeNetmask := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;       <span class="comment">//0 In queries, it MUST be set to 0.</span></span><br><span class="line">    subnet := ip.To4()                       <span class="comment">//depending family</span></span><br><span class="line">    <span class="keyword">if</span> subnet == <span class="literal">nil</span> &#123;</span><br><span class="line">        subnet = ip.To16()</span><br><span class="line">        family = []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000010&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    optionData := bytes.Join([][]<span class="keyword">byte</span>&#123;family, sourceNetmask, scopeNetmask, subnet&#125;, []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    optionLength := getLength(<span class="built_in">len</span>(optionData))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bytes.Join([][]<span class="keyword">byte</span>&#123;optionCode, optionLength[:], optionData&#125;, []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再完成Additional,加上完整的请求头,注意这里我们要修改一下请求头中ArCount的大小</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createEDNSReq</span><span class="params">(domain <span class="keyword">string</span>, reqType2 reqType, eDNS []<span class="keyword">byte</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">    normalReq := creatRequest(domain, reqType2)</span><br><span class="line">    normalReq[<span class="number">10</span>] = <span class="number">0</span>b00000000</span><br><span class="line">    normalReq[<span class="number">11</span>] = <span class="number">0</span>b00000001</span><br><span class="line">    name := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;</span><br><span class="line">    typeR := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00101001&#125;       <span class="comment">//41</span></span><br><span class="line">    payloadSize := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00010000, <span class="number">0</span>b00000000&#125; <span class="comment">//4096</span></span><br><span class="line">    extendRcode := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;</span><br><span class="line">    eDNSVersion := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000&#125;</span><br><span class="line">    z := []<span class="keyword">byte</span>&#123;<span class="number">0</span>b00000000, <span class="number">0</span>b00000000&#125;</span><br><span class="line">    <span class="keyword">var</span> dataLength [<span class="number">2</span>]<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">if</span> eDNS != <span class="literal">nil</span> &#123;</span><br><span class="line">        dataLength = getLength(<span class="built_in">len</span>(eDNS))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bytes.Join([][]<span class="keyword">byte</span>&#123;normalReq, name, typeR, payloadSize, extendRcode, eDNSVersion, z, dataLength[:], eDNS&#125;, []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="应答"><a href="#应答" class="headerlink" title="应答"></a>应答</h2><p>我们先分析一下应答的解析顺序,就跟最开始的一样</p>
<ul>
<li>Header</li>
<li>Answer</li>
<li>Authority</li>
<li>Additional</li>
</ul>
<p>Header和Answer的解析我们上一篇已经完成了,这里需要完成Authority和Additional</p>
<p>因为我们不需要Authority内的具体内容,这里我们就直接获取到Authority之后的数据就行了</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolveAuthoritative</span><span class="params">(c []<span class="keyword">byte</span>, nsCount <span class="keyword">int</span>, b []<span class="keyword">byte</span>)</span> <span class="params">(left []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> nsCount != <span class="number">0</span> &#123;</span><br><span class="line">        nsCount--</span><br><span class="line">        _, _, c = getName(c, b)</span><br><span class="line">        c = c[<span class="number">2</span>:] <span class="comment">// type</span></span><br><span class="line">        c = c[<span class="number">2</span>:] <span class="comment">// class</span></span><br><span class="line">        c = c[<span class="number">4</span>:] <span class="comment">// ttl</span></span><br><span class="line">        dataLength := <span class="keyword">int</span>(c[<span class="number">0</span>])&lt;&lt;<span class="number">8</span> + <span class="keyword">int</span>(c[<span class="number">1</span>])</span><br><span class="line">        c = c[<span class="number">2</span>:] <span class="comment">// data length</span></span><br><span class="line">        c = c[dataLength:]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Additional, SubNet</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolveAdditional</span><span class="params">(b []<span class="keyword">byte</span>, arCount <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> arCount != <span class="number">0</span> &#123;</span><br><span class="line">        arCount--</span><br><span class="line">        <span class="comment">//name := b[:1]</span></span><br><span class="line">        b = b[<span class="number">1</span>:]</span><br><span class="line">        typeE := b[:<span class="number">2</span>]</span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        <span class="comment">//payLoadSize := b[:2]</span></span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        <span class="comment">//rCode := b[:1]</span></span><br><span class="line">        b = b[<span class="number">1</span>:]</span><br><span class="line">        <span class="comment">//version := b[:1]</span></span><br><span class="line">        b = b[<span class="number">1</span>:]</span><br><span class="line">        <span class="comment">//z := b[:2]</span></span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        dataLength := <span class="keyword">int</span>(b[<span class="number">0</span>])&lt;&lt;<span class="number">8</span> + <span class="keyword">int</span>(b[<span class="number">1</span>])</span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        <span class="comment">//log.Println(name, typeE, payLoadSize, rCode, version, z, dataLength)</span></span><br><span class="line">        <span class="keyword">if</span> typeE[<span class="number">0</span>] != <span class="number">0</span> || typeE[<span class="number">1</span>] != <span class="number">41</span> &#123;</span><br><span class="line">            <span class="comment">//optData := b[:dataLength]</span></span><br><span class="line">            b = b[dataLength:]</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dataLength == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        optCode := EDNSOPT&#123;b[<span class="number">0</span>], b[<span class="number">1</span>]&#125;</span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        optionLength := <span class="keyword">int</span>(b[<span class="number">0</span>])&lt;&lt;<span class="number">8</span> + <span class="keyword">int</span>(b[<span class="number">1</span>])</span><br><span class="line">        b = b[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">switch</span> optCode &#123;</span><br><span class="line">        <span class="keyword">case</span> EdnsClientSubnet:</span><br><span class="line">            <span class="comment">//family := b[:2]</span></span><br><span class="line">            b = b[<span class="number">2</span>:]</span><br><span class="line">            <span class="comment">//sourceNetmask := b[:1]</span></span><br><span class="line">            <span class="comment">//log.Println("sourceNetmask", sourceNetmask)</span></span><br><span class="line">            b = b[<span class="number">1</span>:]</span><br><span class="line">            <span class="comment">//scopeNetmask := b[:1]</span></span><br><span class="line">            <span class="comment">//log.Println("scopeNetmask", scopeNetmask)</span></span><br><span class="line">            b = b[<span class="number">1</span>:]</span><br><span class="line">            <span class="comment">// Subnet IP</span></span><br><span class="line">            <span class="comment">//if family[0] == 0 &amp;&amp; family[1] == 1 &#123;</span></span><br><span class="line">            <span class="comment">//	log.Println(b[:4])</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            <span class="comment">//if family[0] == 0 &amp;&amp; family[1] == 2 &#123;</span></span><br><span class="line">            <span class="comment">//	log.Println(b[:16])</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">            b = b[optionLength<span class="number">-4</span>:]</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">//log.Println("opt data:", b[:optionLength])</span></span><br><span class="line">            b = b[optionLength:]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要在之前的DNS分析加上这两个函数,完整代码请看开头</p>
<hr>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc2671" target="_blank" rel="noopener">rfc2671</a><br><a href="https://tools.ietf.org/html/rfc7871" target="_blank" rel="noopener">rfc7871</a><br><a href="https://www.iana.org/assignments/dns-parameters/dns-parameters.xhtml#dns-parameters-11" target="_blank" rel="noopener">dns-parameters</a><br><a href="https://www.iana.org/assignments/address-family-numbers/address-family-numbers.xhtml" target="_blank" rel="noopener">address-family-numbers</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>DNS</tag>
        <tag>UDP</tag>
        <tag>EDNS</tag>
      </tags>
  </entry>
  <entry>
    <title>GeoIP mmdb format</title>
    <url>/posts/931c13a4/</url>
    <content><![CDATA[<p>complete document <a href="https://maxmind.github.io/MaxMind-DB/" target="_blank" rel="noopener">MaxMind DB File Format SpecificationDescription</a></p>
<p>here is only how convert trie tree to array</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">0100, 1011 -&gt; trie</span><br><span class="line"></span><br><span class="line"><span class="code">              root</span></span><br><span class="line"><span class="code">               |</span></span><br><span class="line"><span class="code">         +-----+------+</span></span><br><span class="line"><span class="code">        /              \</span></span><br><span class="line"><span class="code">       0                1</span></span><br><span class="line"><span class="code">     /   \             /  \</span></span><br><span class="line">   null   1           0   null</span><br><span class="line"><span class="code">         / \        /   \</span></span><br><span class="line"><span class="code">        0 null     null   1</span></span><br><span class="line"><span class="code">       / \               / \</span></span><br><span class="line"><span class="code">       0 null         null  1</span></span><br></pre></td></tr></table></figure>

<p>trie -&gt; array<br>left is 0, right is 1<br>value is index of array<a id="more"></a></p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"> left | right  byte/index</span><br><span class="line">2     |   4    0-1</span><br><span class="line">null  |   6    2-3</span><br><span class="line">8     |  null  4-5</span><br><span class="line">10    |  null  6-7</span><br><span class="line">null  |  12    8-9</span><br><span class="line">14    |  null  10-11</span><br><span class="line">null  |  16    11-12</span><br><span class="line">end   |  null  12-13</span><br><span class="line">null  |  end   13-14</span><br><span class="line"></span><br><span class="line">array: [2,4,null,6,8,null,10,null,null,12,14,null,null,16,end,null,null,end]</span><br></pre></td></tr></table></figure>

<p>for example:</p>
<p>index 1:<br> next left index 2 is null, so 00* is not exist<br> next right index 2+1 &#x3D; 3 is not null, continue search until end or null</p>
<p>this is one byte as one child, but one byte max is 255, if node more than 255, we can use multiple byte as one child</p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Network</tag>
      </tags>
  </entry>
  <entry>
    <title>HP Laptop linux 下intel&amp;amd双显卡</title>
    <url>/posts/34615c2d/</url>
    <content><![CDATA[<p>查看<code>双显卡</code>切换情况，正常情况下如果没有在用独显应该显示是<code>DynOff</code>，但是我这里即使是不开桌面也是<code>DynPwr</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[ ~ ] cat /sys/kernel/debug/vgaswitcheroo/switch</span><br><span class="line">0:DIS-Audio: :DynPwr:0000:01:00.1</span><br><span class="line">1:IGD:+:Pwr:0000:00:02.0</span><br><span class="line">2:DIS: :DynPwr:0000:01:00.0</span><br></pre></td></tr></table></figure>

<p>查看<code>dmesg</code>找到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[    3.495606] [drm] amdgpu kernel modesetting enabled.</span><br><span class="line">[    3.495628] vga_switcheroo: detected switching method \_SB_.PCI0.GFX0.ATPX handle</span><br><span class="line">[    3.495741] ATPX version 1, functions 0x00000033</span><br><span class="line">[    3.495873] ATPX Hybrid Graphics</span><br></pre></td></tr></table></figure>

<p>找到了调用的方法，网上搜了一圈都没有使用方法，然后使用<code>acpi_call</code>尝试了几个参数，最后找到</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"\_SB_.PCI0.GFX0.ATPX 2 0"</span> &gt;  /proc/acpi/call</span><br></pre></td></tr></table></figure>

<p>嗯，确实有用，但是实在是太暴力了，直接把整个显卡移除，可以看一下日志<a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[drm:amdgpu_pci_remove [amdgpu]] *ERROR* Hotplug removal is not supported</span><br><span class="line">[11499.551786] [drm] amdgpu: finishing device.</span><br><span class="line">[11499.554123] CP HQD IQ timer status time out</span><br><span class="line">[11499.554442] CP HQD dequeue request time out</span><br><span class="line">[11503.557688] cp queue preemption time out.</span><br><span class="line">[11503.557729] Creating topology SYSFS entries</span><br><span class="line">[11503.557800] amdgpu: [powerplay]</span><br><span class="line">                    .....</span><br><span class="line">                    .....</span><br><span class="line">                    .....</span><br><span class="line">                failed to send message 84 ret is 65535 </span><br><span class="line">[11503.793030] amdgpu: [powerplay] Failed to force to switch arbf0!</span><br><span class="line">[11503.928787] amdgpu 0000:01:00.0: [drm:amdgpu_ring_test_helper [amdgpu]] *ERROR* ring kiq_2.1.0 test failed (-110)</span><br><span class="line">[11503.928865] [drm:gfx_v8_0_hw_fini [amdgpu]] *ERROR* KCQ disable failed</span><br><span class="line">[11504.164622] cp is busy, skip halt cp</span><br><span class="line">[11504.282335] rlc is busy, skip halt rlc</span><br><span class="line">[11504.421048] ------------[ cut here ]------------</span><br><span class="line">[11504.421115] WARNING: CPU: 3 PID: 167022 at drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c:3170 amdgpu_vm_manager_fini+0x1e/0x50 [amdgpu]</span><br><span class="line">[11504.421115] Modules linked in: acpi_call(OE) ccm rfcomm cmac algif_hash algif_skcipher af_alg bnep btusb btrtl btbcm btintel bluetooth snd_hda_codec_realtek snd_hda_codec_generic ledtrig_audio hid_generic usbhid hid ecdh_generic ecc mousedev amdgpu uvcvideo videobuf2_vmalloc videobuf2_memops videobuf2_v4l2 videobuf2_common x86_pkg_temp_thermal intel_powerclamp coretemp videodev kvm_intel mc kvm nls_iso8859_1 nls_cp437 vfat fat i915 iwlmvm fuse irqbypass mac80211 crct10dif_pclmul gpu_sched crc32_pclmul snd_hda_codec_hdmi libarc4 ghash_clmulni_intel snd_hda_intel ttm hp_wmi snd_intel_dspcfg i2c_algo_bit snd_hda_codec mei_hdcp intel_rapl_msr wmi_bmof sparse_keymap iTCO_wdt iTCO_vendor_support aesni_intel crypto_simd joydev iwlwifi cryptd snd_hda_core glue_helper snd_hwdep intel_cstate snd_pcm drm_kms_helper intel_uncore intel_rapl_perf snd_timer cfg80211 input_leds psmouse pcspkr snd i2c_i801 cec r8169 rc_core intel_gtt realtek syscopyarea sysfillrect processor_thermal_device sysimgblt mei_me</span><br><span class="line">[11504.421137]  libphy intel_rapl_common rfkill int340x_thermal_zone soundcore intel_pch_thermal fb_sys_fops intel_soc_dts_iosf mei wmi battery hp_accel evdev lis3lv02d mac_hid hp_wireless int3400_thermal acpi_thermal_rel ac vboxnetflt(OE) vboxnetadp(OE) drm vboxdrv(OE) crypto_user agpgart ip_tables x_tables ext4 crc32c_generic crc16 mbcache jbd2 rtsx_pci_sdmmc serio_raw mmc_core atkbd libps2 crc32c_intel xhci_pci xhci_hcd rtsx_pci i8042 serio</span><br><span class="line">[11504.421149] CPU: 3 PID: 167022 Comm: kworker/u8:0 Tainted: G        W  OE     5.6.15-arch1-1 #1</span><br><span class="line">[11504.421150] Hardware name: HP OMEN by HP Laptop/82EA, BIOS F.53 12/12/2019</span><br><span class="line">[11504.421153] Workqueue: kacpi_hotplug acpi_hotplug_work_fn</span><br><span class="line">[11504.421221] RIP: 0010:amdgpu_vm_manager_fini+0x1e/0x50 [amdgpu]</span><br><span class="line">[11504.421222] Code: c7 83 a0 4e 00 00 00 00 00 00 eb 87 0f 1f 44 00 00 55 48 89 fd 48 81 c7 a8 4e 00 00 48 83 ec 08 48 83 bd b0 4e 00 00 00 74 14 &lt;0f&gt; 0b e8 4b 3d a3 d5 48 89 ef 48 83 c4 08 5d e9 ce 96 00 00 31 f6</span><br><span class="line">[11504.421223] RSP: 0018:ffffb45703ae3c90 EFLAGS: 00010286</span><br><span class="line">[11504.421225] RAX: 0000000000000000 RBX: ffff8c0f0cdc0000 RCX: 0000000000000000</span><br><span class="line">[11504.421225] RDX: ffff8c0f1c718000 RSI: ffff8c0f0cb53000 RDI: ffff8c0f0cdc4ea8</span><br><span class="line">[11504.421226] RBP: ffff8c0f0cdc0000 R08: 0000000000000040 R09: 0000000000000000</span><br><span class="line">[11504.421227] R10: 0000000000000000 R11: ffff8c0f08056438 R12: 0000000000000001</span><br><span class="line">[11504.421228] R13: ffff8c0f0cdd5020 R14: ffff8c0f1c0de800 R15: ffff8c0f1c09f740</span><br><span class="line">[11504.421229] FS:  0000000000000000(0000) GS:ffff8c0f1ed80000(0000) knlGS:0000000000000000</span><br><span class="line">[11504.421230] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[11504.421230] CR2: 00007f5a4f135fd8 CR3: 00000001a020a001 CR4: 00000000003606e0</span><br><span class="line">[11504.421231] Call Trace:</span><br><span class="line">[11504.421300]  gmc_v8_0_sw_fini+0x16/0x60 [amdgpu]</span><br><span class="line">[11504.421386]  amdgpu_device_fini+0x255/0x46f [amdgpu]</span><br><span class="line">[11504.421446]  amdgpu_driver_unload_kms+0x47/0x90 [amdgpu]</span><br><span class="line">[11504.421463]  drm_dev_unregister+0x4b/0xb0 [drm]</span><br><span class="line">[11504.421521]  amdgpu_pci_remove+0x2e/0x50 [amdgpu]</span><br><span class="line">[11504.421525]  pci_device_remove+0x3b/0xa0</span><br><span class="line">[11504.421528]  __device_release_driver+0x15c/0x210</span><br><span class="line">[11504.421529]  device_release_driver+0x24/0x30</span><br><span class="line">[11504.421532]  pci_stop_bus_device+0x68/0x90</span><br><span class="line">[11504.421534]  pci_stop_and_remove_bus_device+0xe/0x20</span><br><span class="line">[11504.421536]  disable_slot+0x49/0x90</span><br><span class="line">[11504.421538]  acpiphp_check_bridge.part.0+0xba/0x140</span><br><span class="line">[11504.421540]  acpiphp_hotplug_notify+0x170/0x280</span><br><span class="line">[11504.421541]  ? acpiphp_post_dock_fixup+0xe0/0xe0</span><br><span class="line">[11504.421544]  acpi_device_hotplug+0x9e/0x410</span><br><span class="line">[11504.421547]  acpi_hotplug_work_fn+0x3d/0x50</span><br><span class="line">[11504.421549]  process_one_work+0x1da/0x3d0</span><br><span class="line">[11504.421551]  worker_thread+0x4d/0x3e0</span><br><span class="line">[11504.421553]  ? rescuer_thread+0x3f0/0x3f0</span><br><span class="line">[11504.421555]  kthread+0x117/0x130</span><br><span class="line">[11504.421556]  ? __kthread_bind_mask+0x60/0x60</span><br><span class="line">[11504.421559]  ret_from_fork+0x35/0x40</span><br><span class="line">[11504.421562] ---[ end trace 9fc85d768333e4aa ]---</span><br><span class="line">[11504.434382] Move buffer fallback to memcpy unavailable</span><br><span class="line">[11504.434384] [TTM] Buffer eviction failed</span><br><span class="line">[11504.434384] [TTM] Cleanup eviction failed</span><br><span class="line">[11504.434402] [TTM] Finalizing pool allocator</span><br><span class="line">[11504.434881] [TTM] Finalizing DMA pool allocator</span><br><span class="line">[11504.434971] [TTM] Zone  kernel: Used memory at exit: 4312 KiB</span><br><span class="line">[11504.434974] [TTM] Zone   dma32: Used memory at exit: 0 KiB</span><br><span class="line">[11504.434976] [drm] amdgpu: ttm finalized</span><br><span class="line">[11504.434989] vga_switcheroo: disabled</span><br><span class="line">[11504.435496] i915 0000:00:02.0: vgaarb: changed VGA decodes: olddecodes=none,decodes=io+mem:owns=io+mem</span><br></pre></td></tr></table></figure>

<p>所以买笔记本一定要买有<code>linux</code>认证的电脑，即使不是也尽量不要买双显卡了，我买的这个显卡基本闲置，我也不喜欢打游戏，反而耗电。</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>bios</tag>
        <tag>computer</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPS相关</title>
    <url>/posts/11b2b8df/</url>
    <content><![CDATA[<p>最近遇到了一件事, 让我又多熟悉了下HTTPS的相关内容, 先看看HTTPS的结构  </p>
<p>通常的HTTP网络结构如下</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+------+</span><br><span class="line">| HTTP |</span><br><span class="line">+------+</span><br><span class="line">| TCP  |</span><br><span class="line">+------+</span><br><span class="line">|  IP  |</span><br><span class="line">+------+</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>HTTP的的相关内容是通过TCP明文传输的, 如果有中间监听者, 可以直接看结相关内容.  </p>
<p>HTTPS的结构</p>
<a id="more"></a>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+------+</span><br><span class="line">| HTTP |</span><br><span class="line">+------+</span><br><span class="line">| TLS  |</span><br><span class="line">+------+</span><br><span class="line">| TCP  |</span><br><span class="line">+------+</span><br><span class="line">|  IP  |</span><br><span class="line">+------+</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>TCP和HTTP之前多了一次处理, 会将HTTP的内容加密后再通过TCP传输.<br>TLS握手过程中, 会协商使用的TLS版本, 加密方式及密钥, 会通过证书确认身份, 生成的密钥也会加密, 不想被看见握手过程的话, 目前还可以采用ESNI.<br>这里并不能完全匿名, 因为还是能通过网络层知道你的目的地址, 但是具体请求的内容就不会被看见了.  </p>
<hr>
<p><strong>以下案例纯虚假编造的, 如有雷同, 纯属巧合.</strong><br>客户需求大概是这样, 希望在前后端传输过程中密码等敏感内容不要明文暴露, 不被中间劫持获取.<br>x公司x高级架构师采用的是这样的方案:</p>
<ul>
<li>前后端使用HTTP通信</li>
<li>前端对相关敏感内容对称加密后传给后端, 后端解密获取内容</li>
</ul>
<p>不采用TLS的理由如下:  </p>
<ul>
<li>可以通过浏览器漏洞获取</li>
<li>HTTPS可以被暴力破解</li>
</ul>
<p>先说下采用的方案和不合理, 目前产品是传统的BS模式, 也就是说网页会从后端获取.<br>因为网页是从后端获取的, 而且是HTTP, 也就是说中间劫持者也可以获取网页内容, 通过分析js就能获取具体的加密方式, 即使对js进行混淆也最多是花的时间稍微长那么一点, 所以说这个方案完全无用, 当然欺骗一下不懂技术的客户还是可以的, 但是从技术角度是完全不可行的.<br>这里我们可以改一下产品的模式还是可行的, 使用electron等类似的技术将网页包装成一个客户端, 不通过后端获取网页还是可行的, 可能在使用上麻烦了一点, 但是这才能真正让前端的加密具有意义.  </p>
<p>再分析下不采用TLS的理由:  </p>
<ul>
<li><p>可以通过浏览器漏洞获取<br>这句话是废话, 浏览器真有漏洞不管是HTTP还是HTTPS都无用的.</p>
</li>
<li><p>HTTPS可以被暴力破解</p>
</li>
</ul>
<p>这里我们先分析下, 目前HTTPS可能被破解的几种方式.  </p>
<ol>
<li>第一种, 在握手阶段使用虚假的证书进行握手, 这里需要在浏览器或者是客户端的系统上导入虚假的证书, 不过我认为一个安全意识很高的公司是不会随意导入不认识的证书的.</li>
<li>第二种, 暴力破解TLS的加密, 不计时间情况下当然能被破解, 但是现代密码学, 即使使用超级计算机暴力破解都要花费很长很长时间.</li>
</ol>
<p>总上所述, 这句话也是废话.  </p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>HTTPS</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript对字符串操作</title>
    <url>/posts/86cfa6a/</url>
    <content><![CDATA[<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name=<span class="string">'aaaa'</span>;</span><br><span class="line"><span class="keyword">var</span> age=<span class="string">'bbbb'</span>;</span><br><span class="line"><span class="keyword">var</span> change=<span class="string">'Hello javascript'</span>;</span><br><span class="line"><span class="keyword">var</span> message=<span class="string">`hello,<span class="subst">$&#123;name&#125;</span>,<span class="subst">$&#123;age&#125;</span>,`</span>+name+age;<span class="comment">//将多个字符串写成一句话</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> length=message.length;<span class="comment">//获取字符串长度</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> upper=message.toUpperCase();<span class="comment">//把字符串全部变成大写</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> lower=message.toLowerCase();<span class="comment">//把字符串全部变成小写</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> search=message.indexOf(<span class="string">'aaaa'</span>);<span class="comment">//搜索字符串位置</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> substr=message.substring(<span class="number">9</span>, <span class="number">15</span>);<span class="comment">//返回区间内字符串</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">x=<span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);  <span class="comment">//查找元素</span></span><br><span class="line">x.innerHTML=<span class="string">"Hello JavaScript"</span>;    <span class="comment">//改变内容</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>NAT穿透</title>
    <url>/posts/1124a628/</url>
    <content><![CDATA[<h2 id="NAT-网络地址转换"><a href="#NAT-网络地址转换" class="headerlink" title="NAT 网络地址转换"></a>NAT 网络地址转换</h2><p>网络地址转换 NAT (Network Address Translation)  方法于1994年提出。<br>需要在专用网连接到互联网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫作 NAT路由器，它至少有一个有效的外部全球IP地址。<br>所有使用本地地址的主机在和外界通信时，都要在 NAT 路由器上将其本地地址转换成全球 IP 地址，才能和互联网连接。  </p>
<h3 id="网络地址转换的过程"><a href="#网络地址转换的过程" class="headerlink" title="网络地址转换的过程"></a>网络地址转换的过程</h3><p>内部主机 A 用本地地址 IPA 和互联网上主机 B 通信所发送的数据报必须经过 NAT 路由器。<br>NAT 路由器将数据报的源地址 IPA 转换成全球地址 IPG，<strong>并把转换结果记录到NAT地址转换表中</strong>，目的地址 IPB 保持不变，然后发送到互联网。<br>NAT 路由器收到主机 B 发回的数据报时，知道数据报中的源地址是 IPB 而目的地址是 IPG。<br>根据 NAT 转换表，NAT 路由器将目的地址 IPG 转换为 IPA，转发给最终的内部主机 A。  </p>
<p>网络地址转换表例子:</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+-------------+---------------+</span><br><span class="line">| private IP  |   public IP   |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 192.168.1.55|219.152.168.222|</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 192.168.1.59|219.152.168.223|</span><br><span class="line">+-------------+---------------+</span><br><span class="line">|192.168.1.155|219.152.168.224|</span><br><span class="line">+-------------+---------------+</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="NAPT-网络地址与端口号转换"><a href="#NAPT-网络地址与端口号转换" class="headerlink" title="NAPT 网络地址与端口号转换"></a>NAPT 网络地址与端口号转换</h3><p>为了更加有效地利用 NAT 路由器上的全球IP地址，现在常用的 NAT 转换表把运输层的端口号也利用上。这样，就可以使多个拥有本地地址的主机，共用一个 NAT 路由器上的全球 IP 地址，因而可以同时和互联网上的不同主机进行通信。<br>使用端口号的 NAT 叫作网络地址与端口号转换NAPT (Network Address and Port Translation)，而不使用端口号的 NAT 就叫作传统的 NAT (traditional NAT)。  </p>
<p>带端口的网络地址转换表例子:</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+-----------------+--------------------+</span><br><span class="line">|   private IP    |     public IP      |</span><br><span class="line">+-----------------+--------------------+</span><br><span class="line">|192.168.1.55:5566|219.152.168.222:9200|</span><br><span class="line">+-----------------+--------------------+</span><br><span class="line">| 192.168.1.59:80 |219.152.168.222:9201|</span><br><span class="line">+-----------------+--------------------+</span><br><span class="line">|192.168.1.59:4465|219.152.168.222:9202|</span><br><span class="line">+-----------------+--------------------+</span><br></pre></td></tr></table></figure>

<h3 id="不同类型的NAT"><a href="#不同类型的NAT" class="headerlink" title="不同类型的NAT"></a>不同类型的NAT</h3><p>来自Wikipedia  </p>
<ul>
<li>完全圆锥型NAT（Full cone NAT），即一对一（one-to-one）NAT<br>一旦一个内部地址（iAddr:port）映射到外部地址（eAddr:port），所有发自iAddr:port的包都经由eAddr:port向外发送。任意外部主机都能通过给eAddr:port发包到达iAddr:port（注：port不需要一样）  </li>
<li>受限圆锥型NAT（Address-Restricted cone NAT）<br>内部客户端必须首先发送数据包到对方（IP&#x3D;X.X.X.X），然后才能接收来自X.X.X.X的数据包。在限制方面，唯一的要求是数据包是来自X.X.X.X。<br>内部地址（iAddr:port1）映射到外部地址（eAddr:port2），所有发自iAddr:port1的包都经由eAddr:port2向外发送。外部主机（hostAddr:any）能通过给eAddr:port2发包到达iAddr:port1。（注：any指外部主机源端口不受限制，但是目的端口必须是port2。只有外部主机数据包的目的IP 为 内部客户端的所映射的外部ip，且目的端口为port2时数据包才被放行。）  </li>
<li>端口受限圆锥型NAT（Port-Restricted cone NAT）<br>类似受限制锥形NAT（Restricted cone NAT），但是还有端口限制。<br>一旦一个内部地址（iAddr:port1）映射到外部地址（eAddr:port2），所有发自iAddr:port1的包都经由eAddr:port2向外发送。<br>在受限圆锥型NAT基础上增加了外部主机源端口必须是固定的。  </li>
<li>对称NAT（Symmetric NAT）<br>每一个来自相同内部IP与端口，到一个特定目的地地址和端口的请求，都映射到一个独特的外部IP地址和端口。<br>同一内部IP与端口发到不同的目的地和端口的信息包，都使用不同的映射<br>只有曾经收到过内部主机数据的外部主机，才能够把数据包发回</li>
</ul>
<h2 id="UDP打洞"><a href="#UDP打洞" class="headerlink" title="UDP打洞"></a>UDP打洞</h2><p>UDP打洞就是利用了NAT地址转换表.  </p>
<h3 id="正常访问一台具有公网IP的主机"><a href="#正常访问一台具有公网IP的主机" class="headerlink" title="正常访问一台具有公网IP的主机"></a>正常访问一台具有公网IP的主机</h3><figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">      +-----+</span></span><br><span class="line">A &lt;-  | NAT |  -----Public INTERNET -&gt; B</span><br><span class="line"><span class="code">      +-----+</span></span><br></pre></td></tr></table></figure>

<p>由主机A向主机B发起请求.<br>NAT将内网地址转换为公网地址,并存在NAT转换表中,这样NAT就知道了来自B的访问应该发给A.  </p>
<h3 id="两台都在NAT中的主机建立连接"><a href="#两台都在NAT中的主机建立连接" class="headerlink" title="两台都在NAT中的主机建立连接"></a>两台都在NAT中的主机建立连接</h3><figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">      +-----+                              +-----+</span></span><br><span class="line">A &lt;-  |NATA |  ----- Public INTERNET ----- | NATB|  -&gt; B</span><br><span class="line"><span class="code">      +-----+                              +-----+</span></span><br></pre></td></tr></table></figure>

<p>首先我们需要知道两台NAT的公网地址和主机A,B的端口.<br>假设NATA的公网地址为1.1.1.1,主机A的端口为1000,NATB的公网地址为1.0.0.1,主机B的端口为1001.<br>然后由A向1.0.0.1:1001发起UDP请求,这样NATA就会记住来自1.0.0.1:1001的请求应该发给A.<br>B也进行同样的操作向1.1.1.1:1000,发起UDP请求.<br>这样A和B就建立起了一条连接.</p>
<p>为了知道主机A和主机B所在网络公网地址,我们需要有一台在公网中的主机来存储A和B的公网地址和端口.</p>
<h3 id="STUN"><a href="#STUN" class="headerlink" title="STUN"></a>STUN</h3><p>STUN（Session Traversal Utilities for NAT，NAT会话穿越应用程序）是一种网络协议，它允许位于NAT（或多重NAT）后的客户端找出自己的公网地址，查出自己位于哪种类型的NAT之后以及NAT为某一个本地端口所绑定的Internet端端口。这些信息被用来在两个同时处于NAT路由器之后的主机之间创建UDP通信。该协议由<a href="https://tools.ietf.org/html/rfc5389" target="_blank" rel="noopener">RFC 5389</a>定义。  </p>
<h3 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a>TURN</h3><p>TURN（全名Traversal Using Relay NAT），是一种数据传输协议（data-transfer protocol）。允许在TCP或UDP的连在线跨越NAT或防火墙。<br>TURN是一个client-server协议。TURN的NAT穿透方法与STUN类似，都是通过获取应用层中的公有地址达到NAT穿透。但实现TURN client的终端必须在通信开始前与TURN server进行交互，并要求TURN server产生”relay port”，也就是relayed-transport-address。这时TURN server会创建peer，即远程端点（remote endpoints），开始进行中继（relay）的动作，TURN client利用relay port将数据发送至peer，再由peer转传到另一方的TURN client。该协议由<a href="https://tools.ietf.org/html/rfc5766" target="_blank" rel="noopener">RFC 5766</a>定义。  </p>
<hr>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/STUN" target="_blank" rel="noopener">STUN</a><br><a href="https://zh.wikipedia.org/wiki/TURN" target="_blank" rel="noopener">TURN</a><br><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2" target="_blank" rel="noopener">网络地址转换</a><br><a href="https://blog.csdn.net/ustcgy/article/details/5655050" target="_blank" rel="noopener">NAT与NAT穿透(二)</a><br><a href="https://zhuanlan.zhihu.com/p/40816201" target="_blank" rel="noopener">简单解释 P2P 技术之 UDP 打洞</a><br><a href="http://www.52im.net/thread-50-1-1.html" target="_blank" rel="noopener">P2P技术详解(一)：NAT详解——详细原理、P2P简介</a>  </p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>UDP</tag>
        <tag>NAT</tag>
      </tags>
  </entry>
  <entry>
    <title>Hyperledger Fabric组织更换证书</title>
    <url>/posts/afc6d6dd/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近一直在研究关于如何给一个fabric的组织更换一个新的证书, 包括所有加入的通道, 所有peer和orderer.<br>用了很多看似完美的方法却多次测试失败, 最后总算找到一种方法.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"channel_group"</span>: &#123;</span><br><span class="line">        <span class="attr">"groups"</span>: &#123;</span><br><span class="line">            <span class="attr">"Application"</span>: &#123;</span><br><span class="line">                <span class="attr">"groups"</span>: &#123;</span><br><span class="line">                    <span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">                        <span class="attr">"groups"</span>: &#123; &#125;, </span><br><span class="line">                        <span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>, </span><br><span class="line">                        <span class="attr">"values"</span>: &#123;</span><br><span class="line">                            <span class="attr">"MSP"</span>: &#123;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        <span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">                    &#125;, </span><br><span class="line">                    <span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">                        <span class="attr">"groups"</span>: &#123; &#125;, </span><br><span class="line">                        <span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>, </span><br><span class="line">                        <span class="attr">"values"</span>: &#123;</span><br><span class="line">                            <span class="attr">"MSP"</span>: &#123;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        <span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                <span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">            &#125;, </span><br><span class="line">            <span class="attr">"Orderer"</span>: &#123;</span><br><span class="line">                <span class="attr">"groups"</span>: &#123;</span><br><span class="line">                    <span class="attr">"OrdererOrg"</span>: &#123;</span><br><span class="line">                        <span class="attr">"groups"</span>: &#123; &#125;, </span><br><span class="line">                        <span class="attr">"values"</span>: &#123;</span><br><span class="line">                            <span class="attr">"MSP"</span>: &#123;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        <span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                <span class="attr">"values"</span>: &#123;</span><br><span class="line">                    <span class="attr">"ConsensusType"</span>: &#123;</span><br><span class="line">                        <span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>, </span><br><span class="line">                        <span class="attr">"value"</span>: &#123;</span><br><span class="line">                            <span class="attr">"metadata"</span>: &#123;</span><br><span class="line">                                <span class="attr">"consenters"</span>: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="attr">"client_tls_cert"</span>: <span class="string">"=="</span>, </span><br><span class="line">                                        <span class="attr">"host"</span>: <span class="string">"orderer.example.com"</span>, </span><br><span class="line">                                        <span class="attr">"port"</span>: <span class="number">7050</span>, </span><br><span class="line">                                        <span class="attr">"server_tls_cert"</span>: <span class="string">"=="</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                ], </span><br><span class="line">                                <span class="attr">"options"</span>: &#123;</span><br><span class="line">                                    <span class="attr">"election_tick"</span>: <span class="number">10</span>, </span><br><span class="line">                                    <span class="attr">"heartbeat_tick"</span>: <span class="number">1</span>, </span><br><span class="line">                                    <span class="attr">"max_inflight_blocks"</span>: <span class="number">5</span>, </span><br><span class="line">                                    <span class="attr">"snapshot_interval_size"</span>: <span class="number">16777216</span>, </span><br><span class="line">                                    <span class="attr">"tick_interval"</span>: <span class="string">"500ms"</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;, </span><br><span class="line">                            <span class="attr">"state"</span>: <span class="string">"STATE_NORMAL"</span>, </span><br><span class="line">                            <span class="attr">"type"</span>: <span class="string">"etcdraft"</span></span><br><span class="line">                        &#125;, </span><br><span class="line">                        <span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                <span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        <span class="attr">"sequence"</span>: <span class="string">"2"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个通道配置块类似上面这种,为了看的清楚有些内容我删了, 更换证书我们需要保证application及orderer的MSP是相同的, 否则更新配置块是不会成功的, 且我们得保证当前组织的raft节点的证书也要全部更换掉.</p>
<h2 id="失败过程"><a href="#失败过程" class="headerlink" title="失败过程"></a>失败过程</h2><a id="more"></a>
<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>第一次就是非常简单的想法, 先更换所有通道的通道配置块的ca证书, 然后重启所有peer和orderer节点.<br>但是这里因为raft的问题, 通道配置块内的<strong>raft的tls证书一次只能更换一个</strong>, 如果我要更换证书的组织拥有多个orderer且都作为raft节点, 这是如果直接更新可能会直接导致raft共识直接失效, 很多情况想想都不行.</p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>先移除多余的raft节点, 更换后再加进来, 测试后发现自己想的太简单了,  因为即使后面重新加进来后, 之前被移除的节点也无法拉取到新的配置块, 因为他们的通道配置块内还是旧的证书, 当然连不上了, 这里必须要更新它们的创世区块才行, 操作过于繁琐, 且在区块链创建初期很容易导致整个联盟的raft共识崩溃掉.</p>
<h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>查看官方文档, 发现orderer和raft的端口可以分开, 也就是说orderer和raft grpc服务可以分开了, 后来测试才发现是自己想错了, 且官方文档的误导性太强了, raft和组织的证书仍旧是绑定在一起的, 如果一个组织只有一个ca证书且拥有多个raft节点依旧无法更换.<br>如果使用不同的证书, 查看orderer的报错, 可以发现是在orderer连接其他orderer的raft节点时会出问题, 会报证书验证不通过, 这里我才发现下面的解决方法.</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>最后才发现fabric一个组织的msp目录下的证书都是可以放多个ca证书的, 创建创世区块时, 配置块内的证书数组就会有两个证书, 这样即使orderer和raft使用不同的ca证书签发下来的tls证书, 只要在组织的ca列表内就不会有问题.</p>
<p>这样就有了更换证书的方法, 过程大概是这样的:</p>
<ul>
<li>先将新的tlsca证书添加到所有到通道配置块内, 注意这里是添加, 不是替换.  </li>
<li>替换通道配置块内一个raft节点的证书为新证书, 替换本地orderer节点的证书文件, 重启节点.</li>
<li>重复以上步骤直到替换了所有raft节点的证书.</li>
<li>然后再替换其他的ca证书, admin证书之类的.</li>
<li>最后将通道配置块内的旧证书删除掉.</li>
</ul>
<p>这样就完成替换了, 大概过程就是如此, 实际操作时可能会有所出入.<br>当然如果觉得没有删除旧证书的必要也可以不删除.</p>
<h2 id="附加"><a href="#附加" class="headerlink" title="附加"></a>附加</h2><p>关于fabric ca</p>
<p>fabric ca在签发证书时, ca就是fabric ca server下的ca, 不会重新签发新的ca.  </p>
<p>关于msp目录</p>
<p>keystore &lt;- 节点&#x2F;用户证书的密钥<br>signcerts &lt;- 节点&#x2F;用户证书</p>
]]></content>
      <categories>
        <category>Hyperledger fabric</category>
      </categories>
      <tags>
        <tag>blockchain</tag>
        <tag>Hyperledger Fabric</tag>
      </tags>
  </entry>
  <entry>
    <title>NAT类型</title>
    <url>/posts/14e0ef9e/</url>
    <content><![CDATA[<h2 id="NAT-Mapping"><a href="#NAT-Mapping" class="headerlink" title="NAT Mapping"></a>NAT Mapping</h2><p>描述NAT在映射网络内主机地址的行为</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">computer(192.168.100.2:30086) -&gt; NAT -&gt; 1.1.1.1:2345</span><br></pre></td></tr></table></figure>

<p>Endpoint-Independent Mapping</p>
<p>网络内主机在通过同一监听udp地址向不同地址和不同端口发包时, NAT使用同一映射地址向外发包</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086</span><br><span class="line"></span><br><span class="line">此时主机向 1.0.0.1:53 发送udp包,</span><br><span class="line"><span class="code">             NAT使用 1.1.1.1:2345 向 1.0.0.1:53 发包</span></span><br><span class="line">主机又向   1.0.0.1:63 发送udp包,</span><br><span class="line"><span class="code">             NAT也使用 1.1.1.1:2345 向 1.0.0.1:63 发包</span></span><br><span class="line">主机又向   8.8.8.8:53 发送udp包,</span><br><span class="line"><span class="code">             NAT也使用 1.1.1.1:2345 向 8.8.8.8:53 发包</span></span><br><span class="line"></span><br><span class="line">这种无论目标地址和端口是什么都使用同一地址进行发包的NAT行为就是 Endpoint-Independent Mapping,</span><br><span class="line">跟没有NAT一样</span><br></pre></td></tr></table></figure>

<p>Address-Dependent Mapping</p>
<p>网络内主机在通过同一监听udp地址向同一地址和不同端口发包时, NAT使用同一映射地址向外发包</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086</span><br><span class="line"></span><br><span class="line">此时主机向 1.0.0.1:53 发送udp包,</span><br><span class="line"><span class="code">             NAT使用 1.1.1.1:2345 向 1.0.0.1:53 发包</span></span><br><span class="line">主机又向   1.0.0.1:63 发送udp包,</span><br><span class="line"><span class="code">             NAT也将使用 1.1.1.1:2345 向 1.0.0.1:63 发包</span></span><br><span class="line">主机又向   8.8.8.8:53 发送udp包,</span><br><span class="line"><span class="code">             此时NAT将使用一新映射地址 1.1.1.1:5678 向 8.8.8.8:53 发包</span></span><br><span class="line"></span><br><span class="line">这种依赖目标地址但不依赖端口的NAT映射行为就是 Address-Dependent Mapping</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>Address and Port-Dependent Mapping</p>
<p>网络内主机在通过同一监听udp地址向同一地址和同一端口发包时, NAT使用同一映射地址向外发包</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086</span><br><span class="line"></span><br><span class="line">此时主机向 1.0.0.1:53 发送udp包, </span><br><span class="line"><span class="code">            NAT使用 1.1.1.1:2345 向 1.0.0.1:53 发包</span></span><br><span class="line">主机又向   1.0.0.1:63 发送udp包,</span><br><span class="line"><span class="code">            NAT将使用一新映射地址 1.1.1.1:3789 向 1.0.0.1:63 发包</span></span><br><span class="line">主机又向   8.8.8.8:53 发送udp包,</span><br><span class="line"><span class="code">           此时NAT将使用一新映射地址 1.1.1.1:5678 向 8.8.8.8:53 发包</span></span><br><span class="line">主机又向 1.0.0.1:53 发送udp包,</span><br><span class="line"><span class="code">            NAT使用相同地址 1.1.1.1:2345 向 1.0.0.1:53 发包</span></span><br><span class="line"></span><br><span class="line">这种同时依赖目标地址和端口的NAT映射行为就是 Address and Port-Dependent Mapping,</span><br><span class="line">这种NAT类型是没有办法进行NAT穿透的</span><br></pre></td></tr></table></figure>

<h2 id="NAT-Filtering"><a href="#NAT-Filtering" class="headerlink" title="NAT Filtering"></a>NAT Filtering</h2><p>描述当NAT为网络内主机映射一地址后，互联网内主机向映射地址发送数据时，将允许哪些地址通过的行为</p>
<p>Endpoint-Independent Filtering</p>
<p>A NAT device employing the combination of “Endpoint-Independent<br>  Mapping” and “Endpoint-Independent Filtering” will accept incoming<br>  traffic to a mapped public port from ANY external endpoint on the<br>  public network.</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086, NAT将其映射到 1.1.1.1:2345</span><br><span class="line"></span><br><span class="line">无论外部任何地址和端口的主机向1.1.1.1:2345发包, NAT都将会将其转发到 192.168.100.2:30086</span><br></pre></td></tr></table></figure>

<p>Address-Dependent Filtering<br>for receiving packets from a specific external endpoint, it is necessary for the internal endpoint to<br>  send packets first to that specific external endpoint’s IP address.</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086, NAT将其映射到 1.1.1.1:2345</span><br><span class="line"></span><br><span class="line">如果需要NAT将外部数据包转发到主机上,</span><br><span class="line">必须先由主机向某一地址发包, </span><br><span class="line">NAT都会将收到的同一地址(所有端口)的数据包转发到主机上</span><br></pre></td></tr></table></figure>

<p>Address and Port-Dependent Filtering</p>
<p>for receiving  packets from a specific external endpoint, it is necessary for<br>  the internal endpoint to send packets first to that external endpoint’s IP address and port.</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如 网络内一主机监听了一udp地址 192.168.100.2:30086, NAT将其映射到 1.1.1.1:2345</span><br><span class="line"></span><br><span class="line">如果需要NAT将外部数据包转发到主机上</span><br><span class="line">必须先由主机向某一地址和某一端口发包</span><br><span class="line">NAT都会将收到的同一地址和同一端口的数据包转发到主机上</span><br><span class="line"></span><br><span class="line">这种NAT类型是没发进行NAT穿透的</span><br></pre></td></tr></table></figure>

<h2 id="NAT穿透"><a href="#NAT穿透" class="headerlink" title="NAT穿透"></a>NAT穿透</h2><p>是否可以进行NAT穿透, 同时依赖NAT Mapping和NAT Filtering</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Mapping和Filtering都为Endpoint-Independent Mapping,</span><br><span class="line"><span class="code">         这种是百分之百可以进行穿透</span></span><br><span class="line">Mapping为Endpoint-Independent Mapping, Filtering为Address and Port-Dependent Filtering,</span><br><span class="line"><span class="code">         这种也是可以进行穿透的</span></span><br><span class="line">但如果Mapping和Filtering都为Address and Port-Dependent Filtering,</span><br><span class="line"><span class="code">         这种是必不可能穿透</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>UDP</tag>
        <tag>NAT</tag>
      </tags>
  </entry>
  <entry>
    <title>RSA加密</title>
    <url>/posts/f1a158c9/</url>
    <content><![CDATA[<h2 id="质数"><a href="#质数" class="headerlink" title="质数"></a>质数</h2><p>质数（Prime number），又称素数，指在大于1的自然数中，除了1和该数自身外，无法被其他自然数整除的数（也可定义为只有1与该数本身两个正因数的数）。  </p>
<p>来自 <a href="https://zh.wikipedia.org/wiki/%E8%B4%A8%E6%95%B0" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E8%B4%A8%E6%95%B0</a>  </p>
<h3 id="互质"><a href="#互质" class="headerlink" title="互质"></a>互质</h3><p>互质是公约数只有1的两个整数，也可记gcd(a,b)&#x3D;1, 叫做互质整数。</p>
<h2 id="欧拉"><a href="#欧拉" class="headerlink" title="欧拉"></a>欧拉</h2><p>在数论中，对正整数n，欧拉函数phi(n)是小于等于n的正整数中与n互质的数的数目。此函数以其首名研究者欧拉命名，它又称为φ函数（由高斯所命名）或是欧拉总计函数（totient function，由西尔维斯特所命名）。  </p>
<p>来自 <a href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0</a>  </p>
<a id="more"></a>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">例如 11 的欧拉:</span><br><span class="line"></span><br><span class="line">比11小且与11互质的正整数有: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span><br><span class="line"></span><br><span class="line">所以phi(11) = 10 = 11-1</span><br></pre></td></tr></table></figure>

<p>由上例子同时可知, 质数的欧拉是他本身减1: phi(N) &#x3D; N - 1<br>同时 歐拉函數是積性函數，即是说若m,n互質，則 phi(mn) &#x3D; phi(m)phi(n)</p>
<h2 id="欧几里得算法"><a href="#欧几里得算法" class="headerlink" title="欧几里得算法"></a>欧几里得算法</h2><p>也叫辗转相除法，用来找出两个数的最大公约数<code>gcd(a,b)</code><br>商记作<code>qi</code>, 余数记作<code>ri</code>, 欧几里得算法可写为 <code>ri-1 = qi * ri + ri+1</code></p>
<p>eg1: 寻找160, 11 的最大公约数</p>
<table>
<thead>
<tr>
<th align="center"><code>ri-1 = qi * ri + ri+1</code></th>
<th align="center">商<code>qi</code></th>
<th align="center">余数<code>ri</code></th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">160</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">160 &#x3D; 14 * 11 + 6</td>
<td align="center">14</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">11 &#x3D; 1 * 6 + 5</td>
<td align="center">1</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">6 &#x3D; 1 * 5 + 1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">5 &#x3D; 5 * 1 + 0</td>
<td align="center">5</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p>可得最大公约数为1, 同时因为<code>gcd(160,11) = 1</code>, 所以 160, 11 互质</p>
<p>eg2: 寻找 160, 122 的最大公约数</p>
<table>
<thead>
<tr>
<th align="center"><code>ri-1 = qi * ri + ri+1</code></th>
<th align="center">商<code>qi</code></th>
<th align="center">余数<code>ri</code></th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">160</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">122</td>
</tr>
<tr>
<td align="center">160 &#x3D; 1 * 122 + 38</td>
<td align="center">1</td>
<td align="center">38</td>
</tr>
<tr>
<td align="center">122 &#x3D; 3 * 38 +8</td>
<td align="center">3</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">38 &#x3D; 4 * 8 + 6</td>
<td align="center">4</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">8 &#x3D; 1 * 6 + 2</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">6 &#x3D; 3 * 2 + 0</td>
<td align="center">3</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p>所以最大公约数为2</p>
<h2 id="模反元素"><a href="#模反元素" class="headerlink" title="模反元素"></a>模反元素</h2><p>模逆元也称为模倒数，或者模逆元。&lt;- 模反元素<br>如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。这时，b就叫做a的“模反元素”。  </p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">如3关于20的模反元素是7，(3*7)%20=1</span><br></pre></td></tr></table></figure>

<p><a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0</a></p>
<h3 id="拓展欧几里得算法"><a href="#拓展欧几里得算法" class="headerlink" title="拓展欧几里得算法"></a>拓展欧几里得算法</h3><p>计算欧几里得同时多计算<code>si-1 = qi *si + si+1</code>和<code>si-1 = qi *si + si+1</code>, 初始分别为<code>s0 = 1</code>,<code>s1 = 0</code>和<code>t0 = 0</code>, <code>t1 = 1</code>，<br>寻找出满足 <code>ax + by = gcd(x,y)</code>的<code>a</code>,<code>b</code>, 同时还可用来求模乘逆元</p>
<p>eg1: 寻找160, 11 的最大公约数</p>
<table>
<thead>
<tr>
<th align="center"><code>ri-1 = qi * ri + ri+1</code></th>
<th align="center">商<code>qi</code></th>
<th align="center">余数<code>ri</code></th>
<th align="center"><code>si-1 = qi * si + si+1</code></th>
<th align="center"><code>si</code></th>
<th align="center"><code>ti-1 = qi * si + ti+1</code></th>
<th align="center"><code>ti</code></th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">160</td>
<td align="center"></td>
<td align="center">1</td>
<td align="center"></td>
<td align="center">0</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">11</td>
<td align="center"></td>
<td align="center">0</td>
<td align="center"></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">160 &#x3D; 14 * 11 + 6</td>
<td align="center">14</td>
<td align="center">6</td>
<td align="center">1 &#x3D; 14 * 0 + 1</td>
<td align="center">1</td>
<td align="center">0 &#x3D; 14 * 1 - 14</td>
<td align="center">-14</td>
</tr>
<tr>
<td align="center">11 &#x3D; 1 * 6 + 5</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">0 &#x3D; 1 * 1 - 1</td>
<td align="center">-1</td>
<td align="center">1 &#x3D; 1 * (-14) + 15</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">6 &#x3D; 1 * 5 + 1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1 &#x3D; 1 * (-1) + 2</td>
<td align="center">2</td>
<td align="center">-14&#x3D; 1 * 15 - 29</td>
<td align="center">-29</td>
</tr>
<tr>
<td align="center">5 &#x3D; 5 * 1 + 0</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">-1 &#x3D; 5 * 2 - 11</td>
<td align="center">11</td>
<td align="center">15 &#x3D; 5 * (-29) + 130</td>
<td align="center">130</td>
</tr>
</tbody></table>
<p>可得 <code>gcd(160,11) = 1 = 2 * 160 + (-29) * 11 = 320 - 319</code>,<br>所以<br>  2是160关于11的模乘逆元<br>  131 &#x3D; -29 + 160是11关于160的模乘逆元, 因为-29为负数需要加上模变成正数</p>
<h3 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h3><p>在数论中，欧拉定理（也称费马-欧拉定理或欧拉phi函数定理）是一个关于同余的性质。欧拉定理表明，若n,a为正整数，且n,a互素（即gcd(a,n)&#x3D;1），则<br><em><strong>a^phi(n) &#x3D; 1 (mod n)</strong></em><br>即 a^phi(n)与1在模n下同余。欧拉定理得名于瑞士数学家莱昂哈德·欧拉。  </p>
<blockquote>
<p>gcd: greatest common divisor(最大公约数)</p>
</blockquote>
<h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><ol>
<li>隨意選擇兩個大的質數 p和q,p不等于q,计算N&#x3D;pq.  </li>
<li>求N的欧拉，r &#x3D; phi(N) &#x3D; phi(q) x phi(p) &#x3D; (p-1)(q-1)  </li>
<li>选择一个小于r的整数e，使e与r互质。並求得e关于r的模反元素，命名为d。  </li>
<li>(N,e)是公钥，(N,d)是私钥。  </li>
<li>加密原文m, 得到密文 x &#x3D; (m^e)%N  </li>
<li>解密公式为 m &#x3D; (x^d)%N<br><strong>只能加密比N小的数字，比N大的数字无法加密。</strong></li>
</ol>
<p>eg：</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">选择两个质数3,11。</span><br><span class="line">计算得到N=3*11=33</span><br><span class="line">计算N的欧拉，r=phi(N)=phi(3)*phi(11)=(3-1)(11-1)=20</span><br><span class="line">选择一个小于的r且与r互质的整数3，求得3关于20的模反元素7</span><br><span class="line">得到公钥(33,3),私钥(33,7)</span><br><span class="line"></span><br><span class="line">加密：</span><br><span class="line">加密数字24，(24^3)%33 = 30, 获得加密后的密文 30</span><br><span class="line">解密：</span><br><span class="line">对密文30解密，(30^7)%33 = 24, 获得解密后的明文24</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
        <tag>RSA</tag>
      </tags>
  </entry>
  <entry>
    <title>OpenCV瞳孔定位</title>
    <url>/posts/88967b7c/</url>
    <content><![CDATA[<h2 id="利用OpenCV自带的分类器识别面部及眼睛"><a href="#利用OpenCV自带的分类器识别面部及眼睛" class="headerlink" title="利用OpenCV自带的分类器识别面部及眼睛"></a>利用OpenCV自带的分类器识别面部及眼睛</h2><p>OpenCV自带里许多分类器,可在<a href="https://github.com/opencv/opencv/tree/master/data/haarcascades" target="_blank" rel="noopener">haarcascades</a>下载  </p>
<h3 id="获取面部"><a href="#获取面部" class="headerlink" title="获取面部"></a>获取面部</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取面部</span></span><br><span class="line"><span class="comment">// image 为输入的OpenCV的格式的图像</span></span><br><span class="line"><span class="comment">// out 为输出图像 &lt;- 此处输出图像为裁剪下来的矩形面部图像</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get_face</span><span class="params">(cv::Mat image, cv::Mat &amp;out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将图像转为灰度图像,可提高识别精度</span></span><br><span class="line">    cv::Mat gray;</span><br><span class="line">    cv::cvtColor(image, gray, CV_BGR2GRAY, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 此处的rect为用来存储识别出的面部的定位 &lt;- 这里为vector是因为识别的面部可能不止为一个</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect&gt; rect;</span><br><span class="line">    <span class="comment">// 初始化OpenCV的分类器</span></span><br><span class="line">    cv::CascadeClassifier cas = cv::CascadeClassifier(<span class="string">"haarcascade_frontalface_default.xml"</span>);</span><br><span class="line">    cas.detectMultiScale(gray, rect, <span class="number">1.15</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 判断rect是否为空,为空的话就是没有被识别的面部</span></span><br><span class="line">    <span class="keyword">if</span> (rect.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 输出图像,这里的rect可能不止为一个(因为可能不止一张脸),所以实际中应该使用for循环</span></span><br><span class="line">    <span class="comment">// 我这里用rect[0]为了简化</span></span><br><span class="line">    out = image(rect[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="获取眼睛"><a href="#获取眼睛" class="headerlink" title="获取眼睛"></a>获取眼睛</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这里与上面相同(这里我只识别左眼,OpenCV还提供了其他文件可获取右眼和双眼)</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get_left_eye</span><span class="params">(cv::Mat image, cv::Mat &amp;out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 之后与面部相同</span></span><br><span class="line">    cv::Mat gray;</span><br><span class="line">    cv::cvtColor(image, gray, CV_BGR2GRAY, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect&gt; rect;</span><br><span class="line">    cv::CascadeClassifier cas = cv::CascadeClassifier(<span class="string">"xml/haarcascade_lefteye_2splits.xml"</span>);</span><br><span class="line">    cas.detectMultiScale(gray, rect, <span class="number">1.15</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (rect.empty())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    out = image(rect[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="瞳孔定位"><a href="#瞳孔定位" class="headerlink" title="瞳孔定位"></a>瞳孔定位</h2><ul>
<li>获取的眼睛图像</li>
<li>裁剪去除眉毛</li>
<li>伽马矫正提高图像对比度</li>
<li>转化为灰度图像</li>
<li>利用threshold进行阈值操作(此处可能会改为inRange,目前还在测试)</li>
<li>腐蚀</li>
<li>膨胀</li>
<li>medianBlur平滑图像</li>
<li>检测关键点并画在图像上</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定位眼球 -&gt; 检测关键点</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt; <span class="title">dector</span><span class="params">(cv::Mat image)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::SimpleBlobDetector::Params detector_params;</span><br><span class="line">    detector_params.filterByArea = <span class="literal">true</span>;</span><br><span class="line">    detector_params.maxArea = <span class="number">1500</span>;</span><br><span class="line">    cv::Ptr&lt;cv::SimpleBlobDetector&gt; blob_dector = cv::SimpleBlobDetector::create(detector_params);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt; keypoints;</span><br><span class="line">    blob_dector-&gt;detect(image, keypoints);</span><br><span class="line">    <span class="keyword">return</span> keypoints;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get_pupil</span><span class="params">(cv::Mat image, cv::Mat &amp;out)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// width -&gt; image.rows ;</span></span><br><span class="line">    <span class="comment">// height -&gt; image.cols;</span></span><br><span class="line">    <span class="comment">// cut eyebrow 裁剪 去除眉毛</span></span><br><span class="line">    image = image(cv::Rect(image.cols / <span class="number">10</span>, image.rows / <span class="number">2.5</span>, image.cols * <span class="number">8</span> / <span class="number">10</span>, image.rows / <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Gamma correction/gamma nonlinearity 伽马校正 -&gt; https://www.cnblogs.com/sdu20112013/p/11597171.html</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">look_up_table</span><span class="params">(<span class="number">1</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">    uchar *p = look_up_table.ptr();</span><br><span class="line">    <span class="keyword">float</span> gamma = <span class="number">0.7</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i)</span><br><span class="line">        p[i] = cv::saturate_cast&lt;uchar&gt;(<span class="built_in">pow</span>(i / <span class="number">255.0</span>, gamma) * <span class="number">255.0</span>);</span><br><span class="line">    cv::LUT(image, look_up_table, image);</span><br><span class="line"></span><br><span class="line">    cv::Mat gray;</span><br><span class="line">    <span class="comment">// 转化为灰度图像</span></span><br><span class="line">    cv::cvtColor(image, gray, CV_BGR2GRAY, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 阈值操作</span></span><br><span class="line">    cv::threshold(gray, gray, inRange_threshold, <span class="number">255</span>, CV_THRESH_BINARY);</span><br><span class="line">    <span class="comment">//膨胀及腐蚀</span></span><br><span class="line">    cv::erode(gray, gray, cv::Mat(), cv::Point(<span class="number">-1</span>, <span class="number">-1</span>), <span class="number">2</span>);</span><br><span class="line">    cv::dilate(gray, gray, cv::Mat(), cv::Point(<span class="number">-1</span>, <span class="number">-1</span>), <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 平滑图像</span></span><br><span class="line">    cv ::medianBlur(gray, gray, <span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 检测并画出关键点</span></span><br><span class="line">    cv::drawKeypoints(image, dector(gray), image, cv::Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span><br><span class="line">    out = image;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="OpenCV在ArchLinux上的使用"><a href="#OpenCV在ArchLinux上的使用" class="headerlink" title="OpenCV在ArchLinux上的使用"></a>OpenCV在ArchLinux上的使用</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S opencv</span><br><span class="line"><span class="meta">#</span><span class="bash"> vtk和hdf5为opencv的依赖,不安装编译会失败</span></span><br><span class="line">sudo pacman -S vtk</span><br><span class="line">sudo pacman -Ss hdf5</span><br></pre></td></tr></table></figure>

<h3 id="Cmake文件"><a href="#Cmake文件" class="headerlink" title="Cmake文件"></a>Cmake文件</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">project</span>(eyedector)</span><br><span class="line"><span class="keyword">add_definitions</span>(-std=c++<span class="number">11</span>)</span><br><span class="line"><span class="comment"># 这里只需要添加OpenCV的就能编译成功</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"><span class="keyword">link_libraries</span>(<span class="variable">$&#123;OpenCV_LIBS&#125;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(out opencvtest.cpp)</span><br></pre></td></tr></table></figure>

<h3 id="利用安卓手机充当网络摄像头"><a href="#利用安卓手机充当网络摄像头" class="headerlink" title="利用安卓手机充当网络摄像头"></a>利用安卓手机充当网络摄像头</h3><p>手机安装这个<a href="https://play.google.com/store/apps/details?id=com.pas.webcam" target="_blank" rel="noopener">IP Webcam</a>,使用时会显示局域网中的地址  </p>
<p>OpenCV中</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">cv::VideoCapture <span class="title">cap</span><span class="params">(<span class="string">"http://192.168.0.xx:8080/video"</span>)</span></span>; <span class="comment">// 这里为网络摄像头的地址,需要在后面加上/video</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    cv::Mat frame;</span><br><span class="line">    cap &gt;&gt; frame;</span><br><span class="line">    cv::imshow(<span class="string">"test"</span>, frame);</span><br><span class="line">    <span class="keyword">if</span> (cv::waitKey(<span class="number">1</span>) == <span class="number">27</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Computer Graphics</category>
      </categories>
      <tags>
        <tag>C++</tag>
        <tag>OpenCV</tag>
        <tag>archlinux</tag>
      </tags>
  </entry>
  <entry>
    <title>TUN网卡</title>
    <url>/posts/a67af13f/</url>
    <content><![CDATA[<h2 id="Golang-Tun-gVisor"><a href="#Golang-Tun-gVisor" class="headerlink" title="Golang Tun (gVisor)"></a>Golang Tun (gVisor)</h2><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"gvisor.dev/gvisor/pkg/tcpip/stack"</span> <span class="comment">// gvisor</span></span><br><span class="line"></span><br><span class="line">s := stack.New(stack.Options&#123;</span><br><span class="line">  NetworkProtocols:   []stack.NetworkProtocolFactory&#123;ipv4.NewProtocol, ipv6.NewProtocol&#125;,</span><br><span class="line">  TransportProtocols: []stack.TransportProtocolFactory&#123;tcp.NewProtocol, udp.NewProtocol, icmp.NewProtocol4, icmp.NewProtocol6&#125;,</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line">ep := fdbased.New(&amp;fdbased.Options&#123;</span><br><span class="line">   FDs:            []<span class="keyword">int</span>&#123;fd&#125;, <span class="comment">// fd: linux文件标识符, 如android中最后会获取到一个文件标识符</span></span><br><span class="line">   MTU:            <span class="keyword">uint32</span>(<span class="number">1500</span>),</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line"> nicID := tcpip.NICID(s.UniqueID())</span><br><span class="line"> <span class="keyword">if</span> er := s.CreateNIC(nicID, ep); er != <span class="literal">nil</span> &#123;</span><br><span class="line">  ep.Attach(<span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isdns</span><span class="params">(opt *TunOpt, id stack.TransportEndpointID)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"> <span class="keyword">if</span> id.LocalPort == <span class="number">53</span> &amp;&amp; (opt.DNSHijacking || id.LocalAddress.String() == opt.Gateway) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TCP</span></span><br><span class="line"> s.SetTransportProtocolHandler(tcp.ProtocolNumber, tcp.NewForwarder(s, defaultWndSize, maxConnAttempts,  <span class="function"><span class="keyword">func</span><span class="params">(r *tcp.ForwarderRequest)</span></span> &#123;</span><br><span class="line">  wq := <span class="built_in">new</span>(waiter.Queue)</span><br><span class="line">  id := r.ID()</span><br><span class="line"></span><br><span class="line">  ep, err := r.CreateEndpoint(wq)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">   r.Complete(<span class="literal">true</span>)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  r.Complete(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(local net.Conn, id stack.TransportEndpointID)</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> local.Close()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> isdns(opt, id) &#123; <span class="comment">// 劫持一下dns</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Handle DNS</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   target := net.JoinHostPort(id.LocalAddress.String(), id.LocalPort) <span class="comment">// 远程目标地址</span></span><br><span class="line">   nconn, er := net.Dial(<span class="string">"tcp"</span>, target)</span><br><span class="line">   <span class="keyword">if</span> er != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> conn.Close()</span><br><span class="line">   utils.Relay(local, conn)</span><br><span class="line">  &#125;(gonet.NewTCPConn(wq, ep), id)</span><br><span class="line"> &#125;).HandlePacket)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// UDP</span></span><br><span class="line"> s.SetTransportProtocolHandler(udp.ProtocolNumber, udp.NewForwarder(s, <span class="function"><span class="keyword">func</span><span class="params">(fr *udp.ForwarderRequest)</span></span> &#123;</span><br><span class="line">    <span class="comment">// handle udp, 和tcp差不多</span></span><br><span class="line"> &#125;).HandlePacket)</span><br></pre></td></tr></table></figure>

<p>完整代码: <a href="https://github.com/Asutorufa/yuhaiin/tree/main/pkg/net/proxy/tun" target="_blank" rel="noopener">tun</a></p>
<h2 id="Android-VPN-Service"><a href="#Android-VPN-Service" class="headerlink" title="Android VPN Service"></a>Android VPN Service</h2><p>Android 的VPN Service只能处理Tun接口</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyVpnService</span> : <span class="type">VpnService</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        Builder().apply &#123;</span><br><span class="line">            setMtu(<span class="number">1500</span>)</span><br><span class="line">            setSession(<span class="string">"my vpn"</span>)</span><br><span class="line"></span><br><span class="line">            addAddress(<span class="string">"172.19.0.1"</span>, <span class="number">24</span>).addRoute(<span class="string">"172.19.0.2"</span>, <span class="number">32</span>)</span><br><span class="line">            addAddress(<span class="string">"fdfe:dcba:9876::1"</span>, <span class="number">126</span>)</span><br><span class="line">                .addRoute(<span class="string">"2000::"</span>, <span class="number">3</span>) <span class="comment">// https://issuetracker.google.com/issues/149636790</span></span><br><span class="line">                .addRoute(<span class="string">"fdfe:dcba:9876::2"</span>, <span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">            addDnsServer(<span class="string">"172.19.0.2"</span>) <span class="comment">// 记得在Tun中劫持172.19.0.2:53处理所有的DNS请求</span></span><br><span class="line"></span><br><span class="line">            addDisallowedApplication(<span class="string">"com.example"</span>) <span class="comment">// Disallowed和Allowed不能同时调用</span></span><br><span class="line">            <span class="comment">// addAllowedApplication("com.example")</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fd = establish()</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    fd 为 linux文件标识符</span></span><br><span class="line"><span class="comment">    如果是通过tun2socks这种命令行工具处理</span></span><br><span class="line"><span class="comment">    需要使用Linux socket将fd发送给子进程</span></span><br><span class="line"><span class="comment">           </span></span><br><span class="line"><span class="comment">    如果是调用so动态库则不需要</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    通过unix文件socket发送sd</span></span><br><span class="line"><span class="comment">      private fun sendFd(path: String) &#123;</span></span><br><span class="line"><span class="comment">            LocalSocket().use &#123; localSocket -&gt;</span></span><br><span class="line"><span class="comment">                localSocket.connect(</span></span><br><span class="line"><span class="comment">                    LocalSocketAddress(</span></span><br><span class="line"><span class="comment">                        path,</span></span><br><span class="line"><span class="comment">                        LocalSocketAddress.Namespace.FILESYSTEM</span></span><br><span class="line"><span class="comment">                    )</span></span><br><span class="line"><span class="comment">                )</span></span><br><span class="line"><span class="comment">                localSocket.setFileDescriptorsForSend(arrayOf(fd)) // &lt;------</span></span><br><span class="line"><span class="comment">                localSocket.outputStream.write(42)</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> START_STICKY   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码: <a href="https://github.com/Asutorufa/yuhaiin-android/tree/main/app/src/main/kotlin/io/github/asutorufa/yuhaiin/service" target="_blank" rel="noopener">VpnService</a></p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Tun</tag>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>TUF GAMING B550M-PLUS WIFI II lm_sensors</title>
    <url>/posts/fe953398/</url>
    <content><![CDATA[<p>the sensors not show fan and voltage<br>it’s a kernel bug now <a href="https://bugzilla.kernel.org/show_bug.cgi?id=204807" target="_blank" rel="noopener">Hardware monitoring sensor nct6798d doesn’t work unless acpi_enforce_resources&#x3D;lax is enabled</a><br>need wait add the motherboard name to linux kernel code list <a href="https://github.com/torvalds/linux/blob/4bbf3422df78029f03161640dcb1e9d1ed64d1ea/drivers/hwmon/nct6775-platform.c#L1044" target="_blank" rel="noopener">linux&#x2F;drivers&#x2F;hwmon&#x2F;nct6775-platform.c</a>  </p>
<h2 id="temporary-measure"><a href="#temporary-measure" class="headerlink" title="temporary measure"></a>temporary measure</h2><p>add</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">acpi<span class="emphasis">_enforce_</span>resources=lax</span><br></pre></td></tr></table></figure>

<p>to linux boot parameter  </p>
<p>load nct6775 kernel module  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">modprobe -v nct6775</span><br></pre></td></tr></table></figure>

<p>run <code>sensors-detect --auto</code>.  </p>
<p>finally, you will see nct6798-isa-* in sensors.</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>android dumpsys tool</title>
    <url>/posts/25303996/</url>
    <content><![CDATA[<p>查看dumpsys所有的子命令:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dumpsys | grep &quot;DUMP OF SERVICE&quot;</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DUMP OF SERVICE SurfaceFlinger:</span><br><span class="line">DUMP OF SERVICE accessibility:</span><br><span class="line">DUMP OF SERVICE account:</span><br><span class="line">DUMP OF SERVICE activity:</span><br><span class="line">DUMP OF SERVICE alarm:</span><br><span class="line">DUMP OF SERVICE appwidget:</span><br><span class="line">DUMP OF SERVICE audio:</span><br><span class="line">DUMP OF SERVICE backup:</span><br><span class="line">DUMP OF SERVICE battery:</span><br><span class="line">DUMP OF SERVICE batteryinfo:</span><br><span class="line">DUMP OF SERVICE clipboard:</span><br><span class="line">DUMP OF SERVICE connectivity:</span><br><span class="line">DUMP OF SERVICE content:</span><br><span class="line">DUMP OF SERVICE cpuinfo:</span><br><span class="line">DUMP OF SERVICE device_policy:</span><br><span class="line">DUMP OF SERVICE devicestoragemonitor:</span><br><span class="line">DUMP OF SERVICE diskstats:</span><br><span class="line">DUMP OF SERVICE dropbox:</span><br><span class="line">DUMP OF SERVICE entropy:</span><br><span class="line">DUMP OF SERVICE hardware:</span><br><span class="line">DUMP OF SERVICE input_method:</span><br><span class="line">DUMP OF SERVICE iphonesubinfo:</span><br><span class="line">DUMP OF SERVICE isms:</span><br><span class="line">DUMP OF SERVICE location:</span><br><span class="line">DUMP OF SERVICE media.audio_flinger:</span><br><span class="line">DUMP OF SERVICE media.audio_policy:</span><br><span class="line">DUMP OF SERVICE media.player:</span><br><span class="line">DUMP OF SERVICE meminfo:</span><br><span class="line">DUMP OF SERVICE mount:</span><br><span class="line">DUMP OF SERVICE netstat:</span><br><span class="line">DUMP OF SERVICE network_management:</span><br><span class="line">DUMP OF SERVICE notification:</span><br><span class="line">DUMP OF SERVICE package:</span><br><span class="line">DUMP OF SERVICE permission:</span><br><span class="line">DUMP OF SERVICE phone:</span><br><span class="line">DUMP OF SERVICE power:</span><br><span class="line">DUMP OF SERVICE reboot:</span><br><span class="line">DUMP OF SERVICE screenshot:</span><br><span class="line">DUMP OF SERVICE search:</span><br><span class="line">DUMP OF SERVICE sensor:</span><br><span class="line">DUMP OF SERVICE simphonebook:</span><br><span class="line">DUMP OF SERVICE statusbar:</span><br><span class="line">DUMP OF SERVICE telephony.registry:</span><br><span class="line">DUMP OF SERVICE throttle:</span><br><span class="line">DUMP OF SERVICE usagestats:</span><br><span class="line">DUMP OF SERVICE vibrator:</span><br><span class="line">DUMP OF SERVICE wallpaper:</span><br><span class="line">DUMP OF SERVICE wifi:</span><br><span class="line">DUMP OF SERVICE window:</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>eg:<br>1.得到电池的所有信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys battery</span><br></pre></td></tr></table></figure>

<p>2.得到wifi的所有信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys wifi</span><br></pre></td></tr></table></figure>

<p>3.得到cpu的所有信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys cpuinfo</span><br></pre></td></tr></table></figure>

<p>4.得到总的存储情况</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys meminfo</span><br></pre></td></tr></table></figure>

<p>5.得到某应用的存储情况</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys meminfo &apos;your apps package name&apos;</span><br></pre></td></tr></table></figure>

<p>6.得到所有的服务列表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell service list</span><br></pre></td></tr></table></figure>

<p>7.得到所有的账户列表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys account</span><br></pre></td></tr></table></figure>

<p>8.获得某子命令的帮助信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys account -h</span><br></pre></td></tr></table></figure>

<p>参考:<br><a href="https://stackoverflow.com/questions/11201659/whats-the-android-adb-shell-dumpsys-tool-and-what-are-its-benefits" target="_blank" rel="noopener">What’s the Android ADB shell “dumpsys” tool and what are its benefits?</a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
        <tag>adb</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言中格式化字符的应用</title>
    <url>/posts/b6b4601/</url>
    <content><![CDATA[<h2 id="格式化规定符"><a href="#格式化规定符" class="headerlink" title="格式化规定符"></a>格式化规定符</h2><p>符号 作用<br>%d 十进制有符号整数<br>%u 十进制无符号整数<br>%f 浮点数<br>%s 字符串<br>%c 单个字符<br>%p 指针的值<br>%e 指数形式的浮点数<br>%x, %X 无符号以十六进制表示的整数<a id="more"></a><br>%0 无符号以八进制表示的整数<br>%g 自动选择合适的表示法</p>
<p>说明:<br>(1). 可以在”%”和字母之间插进数字表示最大场宽。<br>例如: %3d 表示输出3位整型数, 不够3位右对齐。<br>%9.2f 表示输出场宽为9的浮点数, 其中小数位为2, 整数位为6,小数点占一位, 不够9位右对齐。<br>另外, 若想在输出值前加一些0, 就应在场宽项前加个0。<br>例如: %04d 表示在输出一个小于4位的数值时, 将在前面补0使其总宽度为4位。<br>如果用浮点数表示字符或整型量的输出格式, 小数点后的数字代表最大宽度,小数点前的数字代表最小宽度。<br>例如: %6.9s 表示显示一个长度不小于6且不大于9的字符串。若大于9, 则第9个字符以后的内容将被删除。<br>(2). 可以在”%”和字母之间加小写字母l, 表示输出的是长型数。<br>例如: %ld 表示输出long整数,%lf 表示输出double浮点数<br>(3). 可以控制输出左对齐或右对齐, 即在”%”和字母之间加入一个”-“ 号可说明输出为左对齐, 否则为右对齐。<br>例如: %-7d 表示输出7位整数左对齐,%-10s 表示输出10个字符左对齐.</p>
<h2 id="一些特殊规定字符"><a href="#一些特殊规定字符" class="headerlink" title="一些特殊规定字符"></a>一些特殊规定字符</h2><p>字符 作用<br>&#x2F;n   换行<br>&#x2F;f   清屏并换页<br>&#x2F;r   回车<br>&#x2F;t   Tab符<br>&#x2F;xhh 表示一个ASCII码用16进表示,其中hh是1到2个16进制数</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言基本类型在内存中的存储方式</title>
    <url>/posts/e404489/</url>
    <content><![CDATA[<h2 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h2><h3 id="float"><a href="#float" class="headerlink" title="float"></a>float</h3><table>
<thead>
<tr>
<th align="center">符号位</th>
<th align="center">+</th>
<th align="center">指数位</th>
<th align="center">+</th>
<th align="center">尾数位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">↑</td>
<td align="center"></td>
<td align="center">↑</td>
<td align="center"></td>
<td align="center">↑</td>
</tr>
<tr>
<td align="center">第一位</td>
<td align="center"></td>
<td align="center">8位</td>
<td align="center"></td>
<td align="center">23位</td>
</tr>
</tbody></table>
<a id="more"></a>

<h3 id="double"><a href="#double" class="headerlink" title="double"></a>double</h3><table>
<thead>
<tr>
<th align="center">符号位</th>
<th align="center">+</th>
<th align="center">指数位</th>
<th align="center">+</th>
<th align="center">尾数位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">↑</td>
<td align="center"></td>
<td align="center">↑</td>
<td align="center"></td>
<td align="center">↑</td>
</tr>
<tr>
<td align="center">第一位</td>
<td align="center"></td>
<td align="center">11位</td>
<td align="center"></td>
<td align="center">52位</td>
</tr>
</tbody></table>
<h2 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h2><p>整数在内存中是以补码的形式存储</p>
<h3 id="正整数"><a href="#正整数" class="headerlink" title="正整数"></a>正整数</h3><p>原码&#x3D;反码&#x3D;补码</p>
<h3 id="负整数"><a href="#负整数" class="headerlink" title="负整数"></a>负整数</h3><p>原码即为原码<br>反码&#x3D;原码符号为不变,其余取反(注:第一位为符号位)<br>补码&#x3D;反码+1</p>
<p><strong>2019年4月3日更新</strong><br>原码范围:</p>
<ul>
<li>整数:(1111…1) <strong>$-(2^n-1) \leq x \leq 2^n-1$</strong> (01111…1)</li>
<li>小数:(1.111…1) <strong>$-(1-2^n) \leq x \leq 1-2^{-n}$</strong> (0.111…1)</li>
</ul>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言数组输出的另一种方法</title>
    <url>/posts/854ed6ec/</url>
    <content><![CDATA[<p>今天看到这样一种写法,原文链接:<a href="http://blog.accut.cn/archives/173" target="_blank" rel="noopener">一个有趣的C语言程序</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int a = 1;</span><br><span class="line">    int x[5]=&#123;1,2,3,4,5&#125;;</span><br><span class="line">    printf(&quot;%d&quot;,a[x]);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">output: 2</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>int x[5],x实际上保存的是这个数组首元素的地址也就是&amp;x[0].<br>a[x]的等效写法是*(a+&amp;x).因为上面说了x实际上是x[0].<br>所以可以进一步写成*(a+&amp;x[0]),又因为a&#x3D;1所以可以替换成*(&amp;x[0]+1),也就是x[1].<br>所以就是x[1]对应的值：2</p>
<p>由此我又想到了二位数组</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int a = 1;</span><br><span class="line">    int x[2][2]=&#123;&#123;1,2&#125;,&#123;3,4&#125;&#125;;</span><br><span class="line">    printf(&quot;%d&quot;,a[a[x]]);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">output: 4</span><br></pre></td></tr></table></figure>

<p>感觉好神奇,而且在之前不知道在哪看到__c语言的数组其实就是指针的合集__,而且最近要用链表,更觉得链表和数组差不多.</p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>archlinux安装记录</title>
    <url>/posts/e3707853/</url>
    <content><![CDATA[<p>详细安装教程请参考arch wiki <a href="https://wiki.archlinux.org/index.php/Installation_guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">Installation guide (简体中文)</a>,此处只记录安装后遇到的问题.</p>
<hr>
<p>暗影精灵2 PRO 静音LED不起作用和左边耳机会有噼里啪啦声:<br>具体解决方法我已经写到archwiki里了,请看: <a href="https://wiki.archlinux.org/index.php?title=Laptop/HP#HP_Omen_15_ax210TX" target="_blank" rel="noopener">Laptop&#x2F;HP#HP_Omen_15_ax210TX</a></p>
<hr>
<p>grub更新菜单  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<p>安装os-prober让grub检测到其他系统并自动创建引导</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S os-prober</span><br></pre></td></tr></table></figure>

<p>使用system-boot(就是直接使用linux内核引导系统,不再需要grub,如果有多系统不推荐,会把efi分区搞得很乱):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S efibootmgr dosfstools</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此处注意:此处要把efi分区挂载为/boot,而非平常的/boot/efi</span></span><br><span class="line">bootctl install --path=/boot</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p><strong>关于efi的部分可以看我的另一贴.</strong></p>
<p>arch 安装应用后 应用菜单不刷新怎么办(这个正常情况是不会遇到的,只是刚装完有些功能不完整会这样,我就遇到了):  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kbuildsycoca5 --noincremental</span><br></pre></td></tr></table></figure>

<hr>
<p>新增用户<sup><a href="#1"><font color="red">[1]</font></a></sup>:<br>首先添加一个用户，并把它加到wheel组  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd -m -G wheel -s /bin/bash  [用户名]</span><br></pre></td></tr></table></figure>

<p>然后为这个用户设置密码  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">passwd [用户名]</span><br></pre></td></tr></table></figure>

<p>最后设置wheel组的用户能用sudo获取root权限:  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">visudo</span><br><span class="line">    #找到这样的一行,把前面的#去掉:</span><br><span class="line">    #%wheel ALL=(ALL) ALL</span><br><span class="line">按ESC键，输入x!回车就可以保存并退出</span><br></pre></td></tr></table></figure>

<hr>
<p>关闭NetworkManager网络检查(ping.archlinux.org有时候会被墙-_-)<br><a href="https://wiki.archlinux.org/title/NetworkManager#Checking_connectivity" target="_blank" rel="noopener">NetworkManager#Checking_connectivity</a>  </p>
<p>启用dhcp自动获取网络地址,不然开机无法自动联网</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable dhcpcd.service</span><br></pre></td></tr></table></figure>

<p>如果只使用有线网络 可以使用<a href="https://wiki.archlinux.org/index.php/Systemd-networkd" target="_blank" rel="noopener">Systemd-networkd</a><br>——以下已包含dhcp的功能,下面两条命令包括上面那个的功能——</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -s networkmanager</span><br><span class="line">systemctl enable NetworkManager  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动这个后开机有个NetworkManager-wait-online会占用大概6s的时间,嫌慢的可以屏蔽</span></span><br><span class="line">systemctl mask NetworkManager-wait-online</span><br></pre></td></tr></table></figure>

<hr>
<p>安装一个图形界面,比如kde</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S plasma-desktop</span><br><span class="line">systemctl start sddm.service</span><br></pre></td></tr></table></figure>

<p>缩略图生成<br>若要在桌面和 Dolphin 内为媒体或文档文件生成缩略图，安装 <code>kdegraphics-thumbnailers</code>，<code>ffmpegthumbs</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S kdegraphics-thumbnailers ffmpegthumbs</span><br></pre></td></tr></table></figure>

<p>一些gtk应用的plasma panel托盘图标模糊且右键菜单比较奇怪<br>解决方法: 安装libappindicator-gtk3 libappindicator-gtk2</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S libappindicator-gtk3 libappindicator-gtk2</span><br></pre></td></tr></table></figure>

<p>安装一个终端,不然进入图形界面只能进tty输入命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S konsole</span><br></pre></td></tr></table></figure>

<hr>
<p>无法检测到蓝牙适配器:<br>安装<code>bluez</code>,<code>bluez-utils</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S bluez bluez-utils</span><br></pre></td></tr></table></figure>

<p>首先确定内核的蓝牙模块已载入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">modinfo btusb</span><br></pre></td></tr></table></figure>

<p>如果没有的话就是没载入,手动载入:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">modprobe btusb</span><br></pre></td></tr></table></figure>

<p>开启bluetooth服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start bluetooth</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机自启</span></span><br><span class="line">systemctl enable bluetooth</span><br></pre></td></tr></table></figure>

<p>开机后自动启动:<br>修改 <code>/etc/bluetooth/main.conf</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Policy]</span><br><span class="line"># 这一句的注释删除 并将false改成true</span><br><span class="line">AutoEnable=true</span><br></pre></td></tr></table></figure>

<p>已知问题:<br>有时候会崩溃,且无法找到蓝牙适配器,使用<code>dmesg</code>查看错误日志.</p>
<hr>
<p>蓝牙耳机可能载入模块失败</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pactl load-module module-bluetooth-discover</span><br><span class="line">Failure: Module initialization failed</span><br></pre></td></tr></table></figure>

<p>临时解决方法:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pactl unload-module  module-bluetooth-discover</span><br><span class="line">pactl   load-module  module-bluetooth-discover</span><br></pre></td></tr></table></figure>

<p>长期解决方法<sup><a href="#2"><font color="red">[2]</font></a></sup>:</p>
<p>Edit the file:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/pulse/default.pa</span><br></pre></td></tr></table></figure>

<p>and comment out (with an # at the beginning of the line) the following line:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">load-module module-bluetooth-discover</span></span><br></pre></td></tr></table></figure>

<p>now edit the file:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/start-pulseaudio-x11</span><br></pre></td></tr></table></figure>

<p>and after the lines:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ x”$SESSION_MANAGER” != x ] ; then</span><br><span class="line">     /usr/bin/pactl load-module module-x11-xsmp “display=$DISPLAY session_manager=$SESSION_MANAGER” &gt; /dev/null</span><br><span class="line"> fi</span><br></pre></td></tr></table></figure>

<p>add the following line:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/pactl load-module module-bluetooth-discover</span><br></pre></td></tr></table></figure>

<p>This way the Pulse audio’s Bluetooth modules will not be downloaded at boot time but after x11 is started.  </p>
<hr>
<p>字体优化:<br>有些字体可能看不见,比如 𫔭 𪠸 :</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装 ttf-hanazono ttf-ume(mincho) 字体</span></span><br><span class="line">pacman -S ttf-hanazono ttf-ume</span><br></pre></td></tr></table></figure>

<p>不要使用noto和思源黑体的亚洲字体整合包,因为会优先使用日语字体,造成中文大小不一,尽量下载思源黑体的分开的字体包,然后在<code>~/.config/fontconfig/fonts.conf</code>中将中文的思源黑体设置为第一个,具体设置参考<a href="https://wiki.archlinux.org/index.php/Font_configuration" target="_blank" rel="noopener">Font_configuration</a>  </p>
<hr>
<p>解决DNS污染问题:<br>安装dnscrypt-proxy 具体方法参见arch wiki <a href="https://wiki.archlinux.org/index.php/Dnscrypt-proxy" target="_blank" rel="noopener">dnscrypt-proxy</a>,使用<a href="https://github.com/felixonmars/dnsmasq-china-list" target="_blank" rel="noopener">dnsmasq-china-list</a>排除中国域名  </p>
<hr>
<p>arch 使用pyhon-dlib会提示<code>Undefined symbol: cblas_dtrsm</code><br>使用aur或archlinuxcn中的openblas-lapack-git代替pacman源中的cblas,貌似源中的cblas版本太低  </p>
<hr>
<p>自动清除pacman的缓存:<br>创建<code>/usr/share/libalpm/hooks/clean-pacman-cache.hook</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Trigger]</span><br><span class="line">Operation = Remove</span><br><span class="line">Operation = Install</span><br><span class="line">Operation = Upgrade</span><br><span class="line">Type = Package</span><br><span class="line">Target = *</span><br><span class="line"></span><br><span class="line">[Action]</span><br><span class="line">Description = Cleaning up old packages...</span><br><span class="line">When = PostTransaction</span><br><span class="line">Exec = /usr/bin/paccache -rvk3</span><br></pre></td></tr></table></figure>

<hr>
<p>ext4分区优化:  </p>
<p><code>有备用电源或者笔记本可以关闭ext4的barriers具体方法参考</code><a href="https://wiki.archlinux.org/index.php/Ext4#Turning_barriers_off" target="_blank" rel="noopener">Ext4#Turning_barriers_off</a>  </p>
<p>调整内核的I&#x2F;O调度<a href="https://wiki.archlinux.org/title/Improving_performance#Changing_I/O_scheduler" target="_blank" rel="noopener">Improving_performance#Changing_I&#x2F;O_scheduler</a><br>The process to change I&#x2F;O scheduler, depending on whether the disk is rotating or not can be automated and persist across reboots. For example the udev rule below sets the scheduler to none for NVMe, mq-deadline for SSD&#x2F;eMMC, and bfq for rotational drives:</p>
<p>&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;60-ioschedulers.rules</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># set scheduler for NVMe</span><br><span class="line">ACTION==&quot;add|change&quot;, KERNEL==&quot;nvme[0-9]n[0-9]&quot;, ATTR&#123;queue/scheduler&#125;=&quot;none&quot;</span><br><span class="line"># set scheduler for SSD and eMMC</span><br><span class="line">ACTION==&quot;add|change&quot;, KERNEL==&quot;sd[a-z]|mmcblk[0-9]*&quot;, ATTR&#123;queue/rotational&#125;==&quot;0&quot;, ATTR&#123;queue/scheduler&#125;=&quot;mq-deadline&quot;</span><br><span class="line"># set scheduler for rotating disks</span><br><span class="line">ACTION==&quot;add|change&quot;, KERNEL==&quot;sd[a-z]&quot;, ATTR&#123;queue/rotational&#125;==&quot;1&quot;, ATTR&#123;queue/scheduler&#125;=&quot;bfq&quot;</span><br></pre></td></tr></table></figure>

<hr>
<p>deadbeef-git 打开提示<code>plugin cdda.so not found or failed to load</code><br>解决方法: 安装 libcddb libcdio</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S libcddb libcdio</span><br></pre></td></tr></table></figure>

<hr>
<p>使用anime4k会提示缺少openCL库,安装ocl-icd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S ocl-icd</span><br></pre></td></tr></table></figure>

<hr>
<p>开启powertop的自动优化节省电量:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装powertop</span></span><br><span class="line">pacman -S powertop</span><br><span class="line"><span class="meta">#</span><span class="bash">开机自动启用</span></span><br><span class="line">vim /etc/systemd/system/powertop.service</span><br><span class="line"><span class="meta">#</span><span class="bash">填入以下内容</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Powertop tunings</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/powertop --auto-tune &amp;&amp; echo 'on'</span><br><span class="line">RemainAfterExit=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用</span></span><br><span class="line">systemctl enable powertop.service</span><br></pre></td></tr></table></figure>

<p>以下shell是禁用usb的休眠,不然鼠标用起来很难受(<strong>注意:每个电脑的命令都不同,请自行用powertop查看相应的命令</strong>)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Autosuspend <span class="keyword">for</span> USB device USB Optical Mouse [PixArt]</span></span><br><span class="line">echo 'on' &gt; '/sys/bus/usb/devices/1-1/power/control';</span><br><span class="line"><span class="meta">#</span><span class="bash"> Autosuspend <span class="keyword">for</span> USB device HP Wide Vision HD [Generic]</span></span><br><span class="line">echo 'on' &gt; '/sys/bus/usb/devices/1-4/power/control';</span><br><span class="line"><span class="meta">#</span><span class="bash"> Autosuspend <span class="keyword">for</span> USB device xHCI Host Controller [usb1]</span></span><br><span class="line">echo 'on' &gt; '/sys/bus/usb/devices/usb1/power/control';</span><br><span class="line"><span class="meta">#</span><span class="bash"> Autosuspend <span class="keyword">for</span> USB device xHCI Host Controller [usb2]</span></span><br><span class="line">echo 'on' &gt; '/sys/bus/usb/devices/usb2/power/control';</span><br><span class="line"><span class="meta">#</span><span class="bash"> Autosuspend <span class="keyword">for</span> unknown USB device 1-7 (8087:0a2a)</span></span><br><span class="line">echo 'on' &gt; '/sys/bus/usb/devices/1-7/power/control';</span><br></pre></td></tr></table></figure>

<hr>
<p>rider 需要安装moon(.net framework&#x2F;.net core)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S moon</span><br></pre></td></tr></table></figure>

<p>服务端需要mono-xsp,使用aur安装:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yay -S xsp</span><br></pre></td></tr></table></figure>

<hr>
<p>vscode 开发<code>asp.net</code>:<br>安装 moon dotnet</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S moon dotnet-sdk</span><br></pre></td></tr></table></figure>

<p>dotnet 安装 dotnet-dev-certs 生成证书:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dotnet tool install --global dotnet-dev-certs</span><br></pre></td></tr></table></figure>

<p>export要加入.bashrc 或者每次开始前执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH="$PATH:/home/[user]/.dotnet/tools"</span><br></pre></td></tr></table></figure>

<p>生成证书</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dotnet dev-certs https</span><br></pre></td></tr></table></figure>

<p>如果想卸载</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dotnet tool uninstall --global dotnet-dev-certs</span><br></pre></td></tr></table></figure>

<hr>
<p>编译汇编语言 需要安装nasm</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S nasm</span><br></pre></td></tr></table></figure>

<hr>
<p>chrome&#x2F;chromium 即使已经设置为默认浏览器也会提示设置为默认浏览器:<br>解决方法:</p>
<blockquote>
<p>What has worked for me is go to <code>Settings -&gt; Applications -&gt; File Associations</code> and there, filter with <code>html</code>. Then for the entries <code>xhtml+xml</code> and <code>html</code>, you can move <code>Google Chrome</code> to the first position of the preference order.<a href="#3"><sup><font color="red">[3]</font></sup></a>  </p>
</blockquote>
<p>个人测试 只要把<code>xhtml+xml</code>的默认开启最高优先级应用设置为chromium&#x2F;chrome就行了</p>
<hr>
<p>archLinux进行openGl的开发<br>安装glfw-x11 glad-c-git</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yay -S glfw-x11 glad-c-git</span><br></pre></td></tr></table></figure>

<p>open GL导入现有模型时需要安装assimp:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S assimp</span><br></pre></td></tr></table></figure>

<p>顺便推荐一个glsl的教程: <a href="https://learnopengl-cn.github.io/" target="_blank" rel="noopener">LearnOpenGL CN</a></p>
<hr>
<p>python使用tkinter需要安装tk库:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S tk</span><br></pre></td></tr></table></figure>

<hr>
<p>kde设置三指手势:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S gebaar xdotool</span><br></pre></td></tr></table></figure>

<hr>
<p>手动安装mariadb:<br>运行<code>mariadb/scripts/mariadb-install-db</code></p>
<p>设置路径(提示失败 路径更改成功):</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./mysqld --datadir="./data" --langdir="./mysql/share" --basedir="./data/base"</span><br></pre></td></tr></table></figure>

<p>最后</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">You can start the MariaDB daemon with:</span><br><span class="line">cd '.' ; ./bin/mysqld_safe --datadir='./data'</span><br><span class="line"></span><br><span class="line">You can test the MariaDB daemon with mysql-test-run.pl</span><br><span class="line">cd './mysql-test' ; perl mysql-test-run.pl</span><br></pre></td></tr></table></figure>

<hr>
<p>使用redash:<br>安装<code>docker-compose</code>(此处可改docker的root目录,建议谷歌), 手动安装时需要临时使用<code>pwgen</code>生成密钥,安装完成后可卸载.<br>安装时参考ubuntu的安装脚本 稍微改改就行了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S docker-compose pwgen</span><br><span class="line">pacman -Rs pwgen</span><br></pre></td></tr></table></figure>

<hr>
<p>遇到以下问题:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Possibly missing firmware for module: aic94xx</span><br><span class="line"> Possibly missing firmware for module: wd719x</span><br></pre></td></tr></table></figure>

<p>直接使用aur中提供的驱动:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yay -S aic94xx-firmware wd719x-firmware</span><br></pre></td></tr></table></figure>

<hr>
<p>为<code>kde spellChecker</code>添加字典:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pacman -S hunspell-en_US</span><br></pre></td></tr></table></figure>

<hr>
<p>wine-wechat 数据文件:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">==&gt; WeChat data will be put into ~/.local/lib/wine-wechat when needed.</span><br><span class="line">==&gt; run 'wechat --config' if you want to adjust DPI settings.</span><br></pre></td></tr></table></figure>

<p>wine-wechat 运行要保证当前运行环境变量为中文,否则无法显示中文字体,即使wine装了中文字体:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LC_ALL=zh_CN.UTF-8 wechat</span><br></pre></td></tr></table></figure>

<p>使用此<a href="https://github.com/askme765cs/Wine-QQ-TIM" target="_blank" rel="noopener">Wine-QQ-TIM</a>项目的QQ或者TIM乱码,缺少字体:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pacman -S wqy-microhei</span><br></pre></td></tr></table></figure>

<hr>
<p>耳机电流声:  </p>
<blockquote>
<p><a href="https://wiki.archlinux.org/index.php/PulseAudio/Troubleshooting#Glitches,_skips_or_crackling" target="_blank" rel="noopener">Troubleshooting#Glitches,_skips_or_crackling</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">The newer implementation of the PulseAudio sound server uses timer-based audio scheduling instead of the traditional, interrupt-driven approach.</span><br><span class="line"></span><br><span class="line">Timer-based scheduling may expose issues in some ALSA drivers. On the other hand, other drivers might be glitchy without it on, so check to see what works on your system.</span><br><span class="line"></span><br><span class="line">To turn timer-based scheduling off add tsched=0 in /etc/pulse/default.pa:</span><br><span class="line"></span><br><span class="line">/etc/pulse/default.pa</span><br><span class="line"></span><br><span class="line">load-module module-udev-detect tsched=0</span><br><span class="line"></span><br><span class="line">Then restart the PulseAudio server:</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> pulseaudio -k</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pulseaudio --start</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://wiki.archlinux.org/index.php/PulseAudio/Troubleshooting#Static_noise_when_using_headphones" target="_blank" rel="noopener">Troubleshooting#Static_noise_when_using_headphones</a>  </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Static noise when using headphones</span><br><span class="line"></span><br><span class="line">Time-based scheduling may be causing this, disable it as explained in #Glitches, skips or crackling.</span><br><span class="line"></span><br><span class="line">Another reason you are encountering static noise in your headphone jack could be ALSA's loopback mixing.</span><br><span class="line"></span><br><span class="line">Make sure you have alsa-utils installed, launch alsamixer, then select your audio device (pressing F6&#125;), navigate all the way left using the left arrow, and stop on Loopback, if Enabled disable it using the down arrow. This should not impact audio playback or microphone recording negatively, unless you require loopback mixing.</span><br><span class="line"></span><br><span class="line">Some notebook models, like Dell XPS 13 9360, suffer from continuous hissing sound when a headphone is plugged in.</span><br><span class="line"></span><br><span class="line">Yet another reason for this symptom could be the power-saving mode of your audio device.[10] If you followed Power management#Audio, revert the changes and check if it solves the problem.</span><br></pre></td></tr></table></figure>

<p>开启alsa的噪音消减模块:  </p>
<blockquote>
<p><a href="https://wiki.archlinux.org/index.php/PulseAudio/Troubleshooting#Enable_Echo.2FNoise-Cancellation" target="_blank" rel="noopener">Troubleshooting#Enable_Echo.2FNoise-Cancellation</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Arch does not load the Pulseaudio Echo-Cancellation module by default, therefore, we have to add it in /etc/pulse/default.pa. First you can test if the module is present with pacmd and entering list-modules. If you cannot find a line showing name: &lt;module-echo-cancel&gt; you have to add</span><br><span class="line"></span><br><span class="line">/etc/pulse/default.pa</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Enable Echo/Noise-Cancellation</span></span></span><br><span class="line">load-module module-echo-cancel use_master_format=1 aec_method=webrtc aec_args="analog_gain_control=0\ digital_gain_control=1" source_name=echoCancel_source sink_name=echoCancel_sink</span><br><span class="line">set-default-source echoCancel_source</span><br><span class="line">set-default-sink echoCancel_sink</span><br><span class="line"></span><br><span class="line">then restart Pulseaudio</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> pulseaudio -k</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pulseaudio --start</span></span><br></pre></td></tr></table></figure>

<hr>
<p>kde discover 无法使用pacman backend<br><del>discover 使用了 packagekit,使用 pkcon 需要root权限,按理来说packagekit会自动获取root且无需输入密码,但discover无法获取root已无法已root用户运行,问题未知,放弃解决<br>解决方法:<br>卸载discover packagekit packagekit-qt5<br>新安装的话 索性不装就行了</del>  </p>
<p>2020年2月4日已解决,重新安装后好了,可能之前是bug,现在修复好了</p>
<hr>
<p>C++使用openCV:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S opencv</span><br><span class="line"><span class="meta">#</span><span class="bash"> vtk和hdf5为openCV的依赖 不安装会编译失败</span></span><br><span class="line">sudo pacman -S vtk</span><br><span class="line">sudo pacman -Ss hdf5</span><br><span class="line"><span class="meta">#</span><span class="bash"> cmake用来生成makefile</span></span><br><span class="line">pacman -S cmake</span><br></pre></td></tr></table></figure>

<hr>
<p>traceroute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">目前使用了ipip.net 的besttrace</span></span><br><span class="line">pacman -S besttrace</span><br></pre></td></tr></table></figure>

<hr>
<p>wine 错误<br><code>0009:err:module:load_so_dll failed to load .so lib &quot;/usr/bin/../lib32/wine/l3codeca.acm.so&quot;: libmpg123.so.0: cannot open shared object file: No such file or directory</code><br>解决方法:<br><code>sudo pacman -S lib32-mpg123</code></p>
<p>包含中国国内软件的<a href="https://github.com/hillwoodroc/winetricks-zh" target="_blank" rel="noopener">winetricks-zh</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S winetricks-zh</span><br></pre></td></tr></table></figure>

<p>qq軽聊版需要库:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pacman -S lib32-libpulse</span><br></pre></td></tr></table></figure>

<hr>
<p>ark 解压7z和rar</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">查看可选依赖</span><br><span class="line">pacman -Qi ark</span><br><span class="line">支持7z</span><br><span class="line">sudo pacman -S p7zip</span><br><span class="line">支持rar</span><br><span class="line">sudo pacman -S unrar</span><br></pre></td></tr></table></figure>

<hr>
<p>plasma的鼠标样式有时候会不应用在标题栏和其他地方</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">I had a similar problem on Arch.</span><br><span class="line"></span><br><span class="line">Try edit /usr/share/icons/default/index.theme</span><br><span class="line"></span><br><span class="line">Replace: Inherits=Adwaita</span><br><span class="line"></span><br><span class="line">to: Inherits=breeze_cursors</span><br><span class="line"></span><br><span class="line">This will change the cursor to the dark breeze, I don't know the name of the white cursor.</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><a href="https://www.reddit.com/r/kde/comments/3pse8f/plasma_5_cursor_icon_changes_to_the_kde_classic/" target="_blank" rel="noopener">[Plasma 5] Cursor icon changes to the “KDE Classic” theme when hovering over a windows title bar&#x2F;resizing it etc?</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Cursor_themes_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#XDG_%E8%A7%84%E5%88%99" target="_blank" rel="noopener">Cursor_themes_(简体中文)#XDG_规则</a></li>
</ul>
</blockquote>
<hr>
<p>plasma自带的虚拟桌面指示有些bug而且不好看,代替默认虚拟桌面的指示</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yay -S plasma5-applets-virtual-desktop-bar-git</span><br></pre></td></tr></table></figure>

<hr>
<p>为arch添加command not found  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pacman -S pkgfile</span><br></pre></td></tr></table></figure>

<p>更新command-not-found数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pkgfile -U</span><br></pre></td></tr></table></figure>

<p>最后在<code>~/.bashrc</code>添加</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /usr/share/doc/pkgfile/<span class="built_in">command</span>-not-found.bash</span><br></pre></td></tr></table></figure>

<hr>
<p>nethogs: 按进程查看流量占用</p>
<hr>
<p>coc中c语言自动补全,需要安装ccls:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pacman -S ccls</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<ol>
<li>此方法参考自 <a id="1"><a href="https://www.jianshu.com/p/6eaf642a94ed" target="_blank" rel="noopener">用户添加</a></a></li>
<li>此方法参考自 <a id="2"><a href="https://askubuntu.com/questions/689281/pulseaudio-can-not-load-bluetooth-module" target="_blank" rel="noopener">PulseAudio can not load bluetooth module</a></a></li>
<li>此方法来自 <a id="3"><a href="https://bbs.archlinux.org/viewtopic.php?id=198432" target="_blank" rel="noopener">Plasma wont set Chromium as default browser</a></a></li>
</ol>
</blockquote>
<hr>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>archlinux</tag>
        <tag>efi</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>golang socks5/http proxy</title>
    <url>/posts/c7816edc/</url>
    <content><![CDATA[<p>完整实现代码:<br><a href="https://github.com/Asutorufa/yuhaiin/blob/master/net/proxy/socks5/client/socks5client.go" target="_blank" rel="noopener">socks5 client</a><br><a href="https://github.com/Asutorufa/yuhaiin/blob/master/net/proxy/socks5/server/server.go" target="_blank" rel="noopener">socks5 server</a><br><a href="https://github.com/Asutorufa/yuhaiin/blob/master/net/proxy/http/server/server.go" target="_blank" rel="noopener">http server</a>  </p>
<p>此处已socks5client为例,大致流程都相同,只是协议不同:  </p>
<p>socks5运行流程如下:</p>
<p>tcp:<br>    - 本机和代理服务端协商和建立连接；<br>    - 本机告诉代理服务端目标服务的地址；<br>    - 代理服务端去连接目标服务，成功后告诉本机；<br>    - 本机开始发送原本应发送到目标服务的数据给代理服务端，由代理服务端完成数据转发。<br>udp:<br>    - udp因为是无连接的,所以所以数据一次只用一个udp包<br>    - socks5是通过tcp先确认socks5 server支持udp,然后再通过udp发送请求</p>
<h2 id="先进行TCP连接"><a href="#先进行TCP连接" class="headerlink" title="先进行TCP连接"></a>先进行TCP连接</h2><p>golang实现(<em>这里的地址我是本地socks5服务端</em>)</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">conn,err := net.Dial(<span class="string">"tcp"</span>,<span class="string">"127.0.0.1:1080"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="向socks5服务端发送验证"><a href="#向socks5服务端发送验证" class="headerlink" title="向socks5服务端发送验证"></a>向socks5服务端发送验证</h2><p>验证字段:</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">NMETHODS</th>
<th align="center">METHODS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1字节</td>
<td align="center">1字节</td>
<td align="center">1-255字节</td>
</tr>
</tbody></table>
<ul>
<li>VER是SOCKS版本，这里应该是0x05； <a id="more"></a> </li>
<li>NMETHODS是METHODS部分的长度；  </li>
<li>METHODS是客户端支持的认证方式列表，每个方法占1字节。当前的定义是：  <ul>
<li>0x00 不需要认证</li>
<li>0x01 GSSAPI</li>
<li>0x02 用户名、密码认证</li>
<li>0x03 - 0x7F由IANA分配（保留）</li>
<li>0x80 - 0xFE为私人方法保留</li>
<li>0xFF 无可接受的方法</li>
</ul>
</li>
</ul>
<p>golang实现代码:  </p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">sendData := []<span class="keyword">byte</span>&#123;<span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x00</span>&#125;</span><br><span class="line"><span class="keyword">if</span> _, err := conn.Write(sendData); err != <span class="literal">nil</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">getData := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">if</span> _, err = conn.Read(getData[:]); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> getData[<span class="number">0</span>] != <span class="number">0x05</span> || getData[<span class="number">1</span>] == <span class="number">0xFF</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"socks5 first handshake failed!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> getData[<span class="number">1</span>] == <span class="number">0x02</span> &#123;</span><br><span class="line">    sendData := <span class="built_in">append</span>(</span><br><span class="line">        <span class="built_in">append</span>(</span><br><span class="line">            <span class="built_in">append</span>(</span><br><span class="line">                []<span class="keyword">byte</span>&#123;<span class="number">0x01</span>, <span class="keyword">byte</span>(<span class="built_in">len</span>(socks5client.Username))&#125;,</span><br><span class="line">                []<span class="keyword">byte</span>(socks5client.Username)...),</span><br><span class="line">            <span class="keyword">byte</span>(<span class="built_in">len</span>(socks5client.Password))),</span><br><span class="line">        []<span class="keyword">byte</span>(socks5client.Password)...)</span><br><span class="line">    _, _ = conn.Write(sendData)</span><br><span class="line">    getData := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> _, err = conn.Read(getData[:]); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> getData[<span class="number">1</span>] == <span class="number">0x01</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">"username or password not correct,socks5 handshake failed!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="向socks5服务端发送请求"><a href="#向socks5服务端发送请求" class="headerlink" title="向socks5服务端发送请求"></a>向socks5服务端发送请求</h2><p>请求字段:</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">CMD</th>
<th align="center">RSV</th>
<th align="center">ATYP</th>
<th align="center">DST.ADDR</th>
<th align="center">DST.PORT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1字节</td>
<td align="center">1字节</td>
<td align="center">0x00</td>
<td align="center">1字节</td>
<td align="center">动态</td>
<td align="center">2字节</td>
</tr>
</tbody></table>
<ul>
<li>VER是SOCKS版本，这里应该是0x05；</li>
<li>CMD是SOCK的命令码<ul>
<li>0x01表示CONNECT请求</li>
<li>0x02表示BIND请求</li>
<li>0x03表示UDP转发</li>
</ul>
</li>
<li>RSV 0x00，保留</li>
<li>ATYP DST.ADDR类型<ul>
<li>0x01 IPv4地址，DST.ADDR部分4字节长度</li>
<li>0x03 域名，DST.ADDR部分第一个字节为域名长度，DST.ADDR剩余的内容为域名，没有\0结尾。</li>
<li>0x04 IPv6地址，16个字节长度。</li>
</ul>
</li>
<li>DST.ADDR 目的地址</li>
<li>DST.PORT 网络字节序表示的目的端口</li>
</ul>
<p>golang实现代码</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 此处为向 www.google.com:443 发送请求</span></span><br><span class="line">domain := <span class="string">"www.google.com"</span></span><br><span class="line">serverPort := <span class="number">443</span></span><br><span class="line">sendData = <span class="built_in">append</span>(</span><br><span class="line">    <span class="built_in">append</span>(</span><br><span class="line">        []<span class="keyword">byte</span>&#123;<span class="number">0x5</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="keyword">byte</span>(<span class="built_in">len</span>(domain))&#125;,</span><br><span class="line">        []<span class="keyword">byte</span>(domain)...), <span class="keyword">byte</span>(serverPort&gt;&gt;<span class="number">8</span>),</span><br><span class="line">    <span class="keyword">byte</span>(serverPort&amp;<span class="number">255</span>))</span><br><span class="line"><span class="keyword">if</span> _,err = conn.Write(sendData); err!=<span class="literal">nil</span>&#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">getData := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line"><span class="keyword">if</span> _, err = conn.Read(getData[:]); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> getData[<span class="number">0</span>] != <span class="number">0x05</span> || getData[<span class="number">1</span>] != <span class="number">0x00</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"socks5 second handshake failed!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="进行数据转发"><a href="#进行数据转发" class="headerlink" title="进行数据转发"></a>进行数据转发</h2><p>golang实现代码(<em>不太熟悉各种请求这里随便弄了一个</em>)</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> _,err = conn.Write([]<span class="keyword">byte</span>(<span class="string">"GET /generate_204/ HTTP/2.0\r\n"</span>)); err!=<span class="literal">nil</span>&#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关闭TCP连接"><a href="#关闭TCP连接" class="headerlink" title="关闭TCP连接"></a>关闭TCP连接</h2><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">conn.Close()</span><br></pre></td></tr></table></figure>

<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><figure class="highlight md"><table><tr><td class="code"><pre><span class="line"> +----+------+------+----------+----------+----------+</span><br><span class="line"> |RSV | FRAG | ATYP | DST.ADDR | DST.PORT |   DATA   |</span><br><span class="line"> +----+------+------+----------+----------+----------+</span><br><span class="line"> | 2  |  1   |  1   | Variable |    2     | Variable |</span><br><span class="line"> +----+------+------+----------+----------+----------+</span><br><span class="line"></span><br><span class="line">The fields in the UDP request header are:</span><br><span class="line"></span><br><span class="line"><span class="code">     o  RSV  Reserved X'0000'</span></span><br><span class="line"><span class="code">     o  FRAG    Current fragment number</span></span><br><span class="line"><span class="code">     o  ATYP    address type of following addresses:</span></span><br><span class="line"><span class="code">        o  IP V4 address: X'01'</span></span><br><span class="line"><span class="code">        o  DOMAINNAME: X'03'</span></span><br><span class="line"><span class="code">        o  IP V6 address: X'04'</span></span><br><span class="line"><span class="code">     o  DST.ADDR       desired destination address</span></span><br><span class="line"><span class="code">     o  DST.PORT       desired destination port</span></span><br><span class="line"><span class="code">     o  DATA     user data</span></span><br></pre></td></tr></table></figure>

<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p><a href="https://en.wikipedia.org/wiki/SOCKS" target="_blank" rel="noopener">SOCKS(维基百科)</a><br><a href="https://my.oschina.net/997155658/blog/1563154" target="_blank" rel="noopener">SOCKS5 协议介绍</a><br><a href="https://tools.ietf.org/html/rfc1928" target="_blank" rel="noopener">rfc1928</a>  </p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>socks5</tag>
      </tags>
  </entry>
  <entry>
    <title>golang实现子进程后台</title>
    <url>/posts/89c4c907/</url>
    <content><![CDATA[<h2 id="系统的进程机制"><a href="#系统的进程机制" class="headerlink" title="系统的进程机制"></a>系统的进程机制</h2><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">linux下的进程机制,当父进程被杀死之后,子进程就被系统接管</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; system管理</span><br><span class="line">|--子进程 -&gt; 父进程管理</span><br><span class="line"></span><br><span class="line">当父进程被杀死之后</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; 被杀死</span><br><span class="line">|--子进程 -&gt; system管理</span><br><span class="line"></span><br><span class="line">如果子进程被杀死,而且父进程没有处理子进程的善后工作,那么子进程就会变成僵尸进程</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; system管理</span><br><span class="line">|--子进程(被杀死) -&gt; 僵尸进程</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">windows下的进程机制就不太一样了,当父进程被杀死之后,子进程也会被杀死</span><br><span class="line">但是如果子进程还有子进程,杀死子进程但不杀死父进程,子进程的子进程就会被系统接管</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; system管理</span><br><span class="line">|--子进程 -&gt; 父进程管理</span><br><span class="line">|---孙进程 -&gt; 子进程管理</span><br><span class="line"></span><br><span class="line">当父进程被杀死</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; 被杀死</span><br><span class="line">|--子进程 -&gt; 被杀死  </span><br><span class="line">|---孙进程 -&gt; 被杀死</span><br><span class="line"></span><br><span class="line">当子进程被杀死</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-父进程 -&gt; 系统管理</span><br><span class="line">|--子进程 -&gt; 被杀死</span><br><span class="line">|-孙进程 -&gt; 系统管理</span><br><span class="line"></span><br><span class="line">windows的机制和linux不太一样,如果子进程被杀死也不会有僵尸进程这种东西,所以子进程可以放心杀死</span><br></pre></td></tr></table></figure>

<h2 id="实现golang的后台"><a href="#实现golang的后台" class="headerlink" title="实现golang的后台"></a>实现golang的后台</h2><p>如果想实现golang子进程后台,而且不杀死当前父进程,那么我们至少得创建子进程,子进程创建孙进程,然后杀死子进程,这种方法不管在linux还是windows都可以实现<br>如果使用c语言我们可以使用系统提供的fork,使用double fork实现上述过程<br>golang只提供了forkexec,也就是说一个程序只能创建子进程<br><strong>通过这个我想到了一个比较另类的方法,就是在创建进程的时候再次调用本程序再创建进程,这样就相当于创建了子进程,子进程创建孙进程</strong><br><strong>实现就是给程序加参数,再次调用的时候加上这个参数再创建想要的进程</strong></p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">daemonF</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cmd := exec.Command(<span class="string">"puthon"</span>,<span class="string">"-m"</span>,<span class="string">"http.server"</span>)</span><br><span class="line">    cmd.Start()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    daemon := flag.Bool(<span class="string">"d"</span>, <span class="literal">false</span>, <span class="string">"d"</span>)</span><br><span class="line">    flag.Parse()</span><br><span class="line">    <span class="keyword">if</span> *daemon == <span class="literal">true</span> &#123;</span><br><span class="line">        daemonF()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nowFunction, _ := filepath.Abs(os.Args[<span class="number">0</span>])</span><br><span class="line">        cmd := exec.Command(nowFunction,<span class="string">"-d"</span>)</span><br><span class="line">        cmd.Run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">比如我们有一个程序叫makebk,有一个参数 -d</span><br><span class="line"></span><br><span class="line">+系统</span><br><span class="line">|-makebk(再次调用makebk并加上参数-d) -&gt; 父进程:system</span><br><span class="line">|--makebk -d(加上参数之后再创建想要的进程) -&gt; 父进程:makebk</span><br><span class="line">|---子进程 -&gt; 父进程:makebk -d</span><br></pre></td></tr></table></figure>

<p>这样就得到我们想要的三层结构了,这时候让父进程杀死make -d,就实现子进程被系统接管,实现子进程后台</p>
]]></content>
      <categories>
        <category>golang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>linux</tag>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>gpg使用</title>
    <url>/posts/7d547224/</url>
    <content><![CDATA[<p>生成一个密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --full-gen-key</span><br></pre></td></tr></table></figure>

<p>之后会选择加密方式, 有效期, 用户名及邮箱, 密码, 按自己需求填就行了.</p>
<p>创建一个子密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --edit-key [key <span class="built_in">hash</span>]</span><br><span class="line"></span><br><span class="line">gpg&gt; addkey</span><br><span class="line"><span class="comment">#只有与前面是相同的, 按需求选择.</span></span><br><span class="line"></span><br><span class="line">gpg&gt; save</span><br><span class="line"><span class="comment"># 保存</span></span><br></pre></td></tr></table></figure>

<p>导出密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg -o /path/gpg_key --<span class="built_in">export</span>-secret-keys [key <span class="built_in">hash</span>]</span><br></pre></td></tr></table></figure>

<p>导出子密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg -o /path/gpg_key.sub --<span class="built_in">export</span>-secret-subkeys [key <span class="built_in">hash</span>]</span><br></pre></td></tr></table></figure>

<p>导出吊销证书</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --generate-revocation [key <span class="built_in">hash</span>]</span><br><span class="line"><span class="comment"># 输出是文本内容, 复制保存下来就行了</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>删除密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --delete-secret-keys [key <span class="built_in">hash</span>]</span><br><span class="line">gpg --delete-keys [key <span class="built_in">hash</span>]</span><br></pre></td></tr></table></figure>

<p>导入子密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --import /path/gpg_key.sub</span><br></pre></td></tr></table></figure>

<p>查看密钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg -k</span><br><span class="line">gpg -K</span><br></pre></td></tr></table></figure>

<p>加密文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg -r [user name] -o [output file] -e [filename]</span><br></pre></td></tr></table></figure>

<p>解密</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg -o [output file] -d [filename] <span class="comment"># 输出到文件</span></span><br><span class="line">gpg -d [filename] <span class="comment"># 直接输出到终端</span></span><br></pre></td></tr></table></figure>

<hr>
<p><a href="https://gist.github.com/jhjguxin/6037564" target="_blank" rel="noopener">GPG 加密解密简明教程</a><br><a href="https://mogeko.me/2019/068/" target="_blank" rel="noopener">GPG 的正确使用姿势</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>encrypt</tag>
      </tags>
  </entry>
  <entry>
    <title>http Keep-Alive</title>
    <url>/posts/d91b7c06/</url>
    <content><![CDATA[<h2 id="http-keep-alive"><a href="#http-keep-alive" class="headerlink" title="http keep-alive"></a>http keep-alive</h2><p>http头部<code>Connection: Keep-Alive</code>代表连接请求保持长连接<br><strong>如果是http代理,必须处理<code>Proxy-Connection: Keep-Alive</code>为<code>Connection: Keep-Alive</code>,如果代理没有实现<code>Keep-Alive</code>就不变或者将Connection设为close.</strong>  </p>
<p>优点:减少握手次数,如下图(图来源文章最下面)<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://milestone-of-se.nesuke.com/wp-content/uploads/2018/12/http-keepalive-2v2.png" alt="keep-alive"></p>
<a id="more"></a>
<h2 id="判断一次连接的传输结束"><a href="#判断一次连接的传输结束" class="headerlink" title="判断一次连接的传输结束"></a>判断一次连接的传输结束</h2><h3 id="使用消息首部字段Conent-Length"><a href="#使用消息首部字段Conent-Length" class="headerlink" title="使用消息首部字段Conent-Length"></a>使用消息首部字段<code>Conent-Length</code></h3><p><code>Conent-Length</code>表示实体内容长度，客户端（服务器）可以根据这个值来判断数据是否接收完成。</p>
<h3 id="使用Transfer-Encoding-chunked"><a href="#使用Transfer-Encoding-chunked" class="headerlink" title="使用Transfer-Encoding: chunked"></a>使用<code>Transfer-Encoding: chunked</code></h3><p>chunk编码将数据分成一块一块的发生。Chunked编码将使用若干个Chunk串连而成，由一个标明长度为0的chunk标示结束。</p>
<hr>
<p>参考:</p>
<ul>
<li><a href="https://www.google.com/amp/s/milestone-of-se.nesuke.com/nw-basic/as-nw-engineer/keepalive-tcp-http/%3Famp=1" target="_blank" rel="noopener">【図解】TCP Keep-Alive&#x2F;http Keep-Aliveの仕組みと違い ～Client&#x2F;Serverの挙動とメリット,設定～</a>  </li>
<li><a href="https://www.cnblogs.com/skynet/archive/2010/12/11/1903347.html#!comments" target="_blank" rel="noopener">HTTP头部详解</a>  </li>
<li><a href="https://www.jianshu.com/p/49551bda6619" target="_blank" rel="noopener">HTTP协议的Keep-Alive 模式</a></li>
</ul>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>iptables</title>
    <url>/posts/736b1750/</url>
    <content><![CDATA[<p>iptables chain</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="code">    +---------------------------------------------------------+</span></span><br><span class="line"><span class="code">    |                   Network Card                          |</span></span><br><span class="line"><span class="code">    +---------------------------------------------------------+</span></span><br><span class="line"><span class="code">      |                                                    ^</span></span><br><span class="line"><span class="code">      |                                                    |</span></span><br><span class="line"><span class="code">      v                                                    |</span></span><br><span class="line"> +----------+          is?      no    +-------+        +-----------+</span><br><span class="line"> |prerouting| ----&gt; localhost ------&gt; |forward| ----&gt;  |postrouting|</span><br><span class="line"> +----------+          |              +-------+        +-----------+ </span><br><span class="line"><span class="code">                       | yes                                 ^</span></span><br><span class="line"><span class="code">                       |                                     |</span></span><br><span class="line"><span class="code">                       v                                     |</span></span><br><span class="line"><span class="code">                    +---------+                        +-----------+</span></span><br><span class="line"><span class="code">                    |  input  |                        |   output  |</span></span><br><span class="line"><span class="code">                    +---------+                        +-----------+</span></span><br><span class="line"><span class="code">                         |                                   ^</span></span><br><span class="line"><span class="code">                         |                                   |</span></span><br><span class="line"><span class="code">                         |                                   |</span></span><br><span class="line"><span class="code">                         v                                   |</span></span><br><span class="line"><span class="code">    +----------------------------------------------------------+</span></span><br><span class="line"><span class="code">    |                        user                              |</span></span><br><span class="line"><span class="code">    +----------------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line">out -&gt; localhost: prerouting -&gt; input</span><br><span class="line">forward:          prerouting -&gt; forward    -&gt; postrouting</span><br><span class="line">localhost -&gt; out: output     -&gt; postrouting</span><br></pre></td></tr></table></figure>

<p>iptables table:  </p>
<ul>
<li>filter:</li>
<li>nat:</li>
<li>magle:</li>
<li>raw:</li>
</ul>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">table &lt;-&gt; chain  </span><br><span class="line">raw: PREROUTING, OUTPUT  </span><br><span class="line">mangle: PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING  </span><br><span class="line">nat: PREROUTING, OUTPUT, POSTROUTING, INPUT  </span><br><span class="line">filter: INPUT, FORWARD, OUTPUT</span><br><span class="line"></span><br><span class="line">raw –&gt; mangle –&gt; nat –&gt; filter  </span><br><span class="line"></span><br><span class="line">chain &lt;-&gt; table</span><br><span class="line">PREROUTING: raw, mangle, nat</span><br><span class="line">INPUT: mangle, filter, nat</span><br><span class="line">FORWARD: mangle, filter</span><br><span class="line">OUTPUT: raw, mangle, nat, filter</span><br><span class="line">POSTROUTING: mangle, nat</span><br></pre></td></tr></table></figure>

<p>query</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iptables -t &lt;table&gt; -nvL &lt;chain&gt;</span><br></pre></td></tr></table></figure>

<hr>
<p><a href="https://www.zsythink.net/archives/tag/iptables/page/2" target="_blank" rel="noopener">iptables</a></p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>linux下intel&amp;AMD双显卡切换</title>
    <url>/posts/3b8b96de/</url>
    <content><![CDATA[<p>使用<strong>xrandr</strong>显示可支持的显卡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --listproviders</span><br></pre></td></tr></table></figure>

<p>输出类似以下内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Providers: number : 2</span><br><span class="line">Provider 0: id: 0x6b cap: 0x9, Source Output, Sink Offload crtcs: 3 outputs: 7 associated providers: 1 name:modesetting</span><br><span class="line">Provider 1: id: 0x41 cap: 0x6, Sink Output, Source Offload crtcs: 2 outputs: 0 associated providers: 1 name:OLAND @ pci:0000:01:00.0</span><br></pre></td></tr></table></figure>

<p>To be able to render GPU-intensive applications by the more powerful discrete card use</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --setprovideroffloadsink 1 0</span><br></pre></td></tr></table></figure>

<p>或者<a id="more"></a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --setprovideroffloadsink 0x41 0x6b</span><br></pre></td></tr></table></figure>

<p>使用DRI_PRIME为某个应用选择使用哪一张显卡,使用glxinfo可以查看正在使用的显卡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DRI_PRIME=0 glxinfo | grep "OpenGL renderer"</span><br><span class="line">DRI_PRIME=1 glxinfo | grep "OpenGL renderer"</span><br></pre></td></tr></table></figure>

<p>如为steam启用独显</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DRI_PRIME=1 steam</span><br></pre></td></tr></table></figure>

<p>如果需要使用独显进行视频硬件播放,还需指定视频解码库,不然会乱码:<br>如AMD:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DRI_PRIME=1            # for laptops with switchable graphics</span><br><span class="line">LIBVA_DRIVER_NAME=r600 # value depends on the driver, check /usr/lib/dri for possible options</span><br></pre></td></tr></table></figure>

<p>使用mpv:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">DRI_PRIME=1  LIBVA_DRIVER_NAME=r600 mpv [...]</span><br></pre></td></tr></table></figure>

<p>参考资料:<br>1.<a href="https://askubuntu.com/questions/1038271/intel-amd-hybrid-graphics-ubuntu-18-04" target="_blank" rel="noopener">Intel&#x2F;AMD Hybrid graphics Ubuntu 18.04</a><br>2.<a href="https://wiki.archlinux.org/index.php/PRIME" target="_blank" rel="noopener">PRIME (简体中文)</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>双显卡</tag>
        <tag>amd</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs异步回调函数</title>
    <url>/posts/5938ae8c/</url>
    <content><![CDATA[<p>研究了一下javascript的异步回调函数,本来想像golang那样使用chan可以返回原始值,不过貌似无法做到,最后止步async&#x2F;await,差不多就是用Promise的resolve返回值然后用await调用,不过await必须使用在async的函数里,局限还是有的.<br>如果使用非async的函数调用,返回的依旧是Promise类型,需要使用.then.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        resolve(<span class="string">"test"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">await</span> test())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>python使用lxml分析网页</title>
    <url>/posts/77d15527/</url>
    <content><![CDATA[<p>首先得引入lxml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#xpath为</span><br><span class="line">frome lxml import etree</span><br><span class="line">#cssselector为</span><br><span class="line">import lxml.html</span><br><span class="line">#cssselector使用起来简单但功能比xpath少</span><br></pre></td></tr></table></figure>

<p>cssselector</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tree = lxml.html.fromstring(&apos;你获取的网页源代码文件或变量&apos;)</span><br><span class="line">css = tree.cssselect(&apos;要选择的内容&apos;)</span><br><span class="line"></span><br><span class="line">#例如tree.cssselect(&apos;div.word-info &gt; div.pronounces &gt; span.word-audio&apos;)</span><br><span class="line">#选择器选择的结果为list</span><br><span class="line"></span><br><span class="line">css.text_content()</span><br><span class="line"></span><br><span class="line">#表示选择的内容</span><br><span class="line"></span><br><span class="line">css.attrib[&apos;要表示的标签属性&apos;]</span><br><span class="line"></span><br><span class="line">#如css.attrb[&apos;class&apos;]表示的就是所选择内容的class属性</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p><strong>如果选择的内容换行符太多可以使用split表示成list去除</strong></p>
<table>
<thead>
<tr>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>选择所有标签</td>
<td>*</td>
</tr>
<tr>
<td>选择&lt;a&gt;标签</td>
<td>a</td>
</tr>
<tr>
<td>选择所有class&#x3D;”link”的标签</td>
<td>.link</td>
</tr>
<tr>
<td>选择class&#x3D;”link”的&lt;a&gt;标签</td>
<td>a.link</td>
</tr>
<tr>
<td>选择id&#x3D;”home”的&lt;a&gt;标签</td>
<td>a#home</td>
</tr>
<tr>
<td>选择父元素为&lt;a&gt;标签的所有&lt;span&gt;标签</td>
<td>a &gt; span</td>
</tr>
<tr>
<td>选择&lt;a&gt;标签内部的所有&lt;span&gt;标签</td>
<td>a span</td>
</tr>
<tr>
<td>选择title属性为”Home”的所有&lt;a&gt;标签</td>
<td>a[title&#x3D;Home]</td>
</tr>
</tbody></table>
<p>xpath</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">selector=etree.HTML(&apos;你获取的网页源代码文件或变量&apos;)</span><br><span class="line">css = selector.xpath(&apos;要选择的内容&apos;)</span><br><span class="line">#xpath可直接表示</span><br><span class="line">#xpath可选择并表示属性</span><br></pre></td></tr></table></figure>

<p><em>xpath由于内容太多,可以直接参考官方文档</em></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>编程</tag>
      </tags>
  </entry>
  <entry>
    <title>linux PPPOE拨号上网</title>
    <url>/posts/59c8ffd6/</url>
    <content><![CDATA[<h2 id="安装rp-pppoe"><a href="#安装rp-pppoe" class="headerlink" title="安装rp-pppoe"></a>安装rp-pppoe</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pacman -S rp-pppoe</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pppoe-setup</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Enter your PPPoE user name:</span></span><br></pre></td></tr></table></figure>

<p>这里输入网络运营商提供给你的用户名.</p>
<a id="more"></a>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Enter the Ethernet interface connected to the DSL modem</span></span><br><span class="line">For Solaris, this is likely to be something like /dev/hme0.</span><br><span class="line">For Linux, it will be ethn, where 'n' is a number. :</span><br></pre></td></tr></table></figure>

<p>这里输入你链接网络的网卡,可以使用<code>ip addr</code>进行查看 比如<code>eth1</code>,<code>wlo1</code>.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Enter the demand value (default no):</span><br></pre></td></tr></table></figure>

<p>这里可以直接回车</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Enter the DNS information here:</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Enter the secondary DNS server address here:</span></span><br></pre></td></tr></table></figure>

<p>这里输入两个DNS,比如<code>1.1.1.1</code>,<code>8.8.8.8</code>.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Please enter your PPPoE password:</span></span><br></pre></td></tr></table></figure>

<p>这里输入网络运营商提供给你的密码.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">The firewall choices are:</span><br><span class="line">0 - NONE: This script will not set any firewall rules.  You are responsible</span><br><span class="line">          for ensuring the security of your machine.  You are STRONGLY</span><br><span class="line">          recommended to use some kind of firewall rules.</span><br><span class="line">1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation</span><br><span class="line">2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway</span><br><span class="line">                for a LAN</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Choose a <span class="built_in">type</span> of firewall (0-2):</span></span><br></pre></td></tr></table></figure>

<p>这里我使用1,可以按照自己的需求选择防火墙配置.</p>
<h2 id="启用"><a href="#启用" class="headerlink" title="启用"></a>启用</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pppoe-start</span><br></pre></td></tr></table></figure>

<p>可以使用<code>ip addr</code>进行查看,现在应该有一个<code>ppp0</code>的网络.</p>
<h2 id="查看路由确认启用"><a href="#查看路由确认启用" class="headerlink" title="查看路由确认启用"></a>查看路由确认启用</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ ~ ] route</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         0.0.0.0         0.0.0.0         U     0      0        0 ppp0</span><br><span class="line">                                ...</span><br><span class="line">                                ...</span><br></pre></td></tr></table></figure>

<p>如果没有default到ppp0的这条路由,需要手动创建:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo route add default dev ppp0</span><br></pre></td></tr></table></figure>

<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<ul>
<li><a href="https://www.cnblogs.com/viusuangio/p/7112674.html" target="_blank" rel="noopener">archlinux pppoe拨号连接使用详解[转载]</a>  </li>
<li><a href="https://www.librehat.com/guide-on-linux-ppp-over-wireless-network/" target="_blank" rel="noopener">Linux下连接无线网络后拨号（即PPP over WiFi）</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>archlinux</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>snap删除旧的core(snap删除其他版本的软件)</title>
    <url>/posts/b6b8953/</url>
    <content><![CDATA[<p>偶尔发现snap会自动升级core且不删除旧版，在’&#x2F;snap&#x2F;core’<br>会发现好几个版本的文件夹。<br>使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo snap remove core --revision xxx</span><br></pre></td></tr></table></figure>

<p>删除某个版本的core，xxx是软件的rev，使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">snap list</span><br></pre></td></tr></table></figure>

<p>可以查看软件的rev，其他软件也能用这个方法删除旧的版本哦。</p>
<p>参考：<a href="https://askubuntu.com/questions/828859/how-to-unmount-and-possibly-delete-old-ubuntu-core-snap" target="_blank" rel="noopener">How to unmount and possibly delete old Ubuntu Core snap</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>snap</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu终端下连接wifi</title>
    <url>/posts/fb6d8628/</url>
    <content><![CDATA[<h2 id="首先使用rfkill查看你的wifi设备是否被停用"><a href="#首先使用rfkill查看你的wifi设备是否被停用" class="headerlink" title="首先使用rfkill查看你的wifi设备是否被停用"></a>首先使用rfkill查看你的wifi设备是否被停用</h2><p>使用命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rfkill list</span><br></pre></td></tr></table></figure>

<p>获得设备列表，每个都包含与之关联的索引号，从 0 开始<br>查看设备是否被停用，要启用被停用的设备，请运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rfkill unblock &lt;索引号&gt;</span><br></pre></td></tr></table></figure>

<p>要启用所有设备，请运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rfkill unblock all</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>您可以使用这个索引号让 rfkill 停使或者使用某个设备，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rfkill block 0</span><br></pre></td></tr></table></figure>

<p>您还可以使用 rfkill 阻断某一类设备，或者所有启用了RFKill的设备。例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rfkill block wifi</span><br></pre></td></tr></table></figure>

<p>停用系统中的所有Wi-Fi设备</p>
<h2 id="启用无线网卡"><a href="#启用无线网卡" class="headerlink" title="启用无线网卡"></a>启用无线网卡</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifconfig wlan0 up</span><br></pre></td></tr></table></figure>

<h2 id="使用iwconfig命令搜索无线网"><a href="#使用iwconfig命令搜索无线网" class="headerlink" title="使用iwconfig命令搜索无线网"></a>使用iwconfig命令搜索无线网</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iwlist wlan0 scan</span><br></pre></td></tr></table></figure>

<p>记下essid<br>连接无密码的无线网</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iwconfig wlan0 essid essidname</span><br></pre></td></tr></table></figure>

<p>其中essidname是搜索到的无线网essid<br>连接有密码的无线网 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iwconfig wlan0 essid essidname key &lt;密码&gt;</span><br></pre></td></tr></table></figure>

<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>通过dhcp获取IP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dhclient wlan0</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dhcpcd wlan0</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>uefi and efi</title>
    <url>/posts/a99a60b1/</url>
    <content><![CDATA[<p>创建efi分区:  </p>
<p>创建efi分区要设置boot flag,而不是纯FAT32文件系统<br>使用gdisk</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gdisk /dev/sd**</span><br><span class="line"><span class="meta">#</span><span class="bash">这里要注意后面输入分区系统编号 要选择EFI分区,目前efi分区编号是 ef00</span></span><br></pre></td></tr></table></figure>

<p>使用parted</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">parted /dev/sd**</span><br><span class="line">(parted) set 1 boot on</span><br></pre></td></tr></table></figure>

<p>之后再格式化为fat32</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkfs.vfat -F 32 /dev/sd**</span><br></pre></td></tr></table></figure>

<p>更新bios中的启动项应该在将启动文件安装到efi分区时还要向bios中的nvram存储器上写入相应的路径,在linux中可以使用efibootmgr完成相应的操作,当然如果你是安装grub,安装grub时会自动向nvram中写入内容,比如在bios更新后,会清除nvram中的内容,所有还要重新安装grub,或是使用efibootmgr写入引导文件路径.可参考<a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface#efibootmgr" target="_blank" rel="noopener">Unified_Extensible_Firmware_Interface#efibootmgr</a>,windows中也有相应的工具,具体操作方式可在网路上搜索.<br>如果是u盘的话,uefi 会查看所有 fat 分区，看看里面有没有 EFI&#x2F;boot&#x2F;bootx64.efi(目前还没有找到相应的文档表示是这个,这只是我个人的猜想,因为在我试过的无论是windows还是linux的iso镜像的efi文件都是这个地方) 引导文件,然后只要是 FAT32 文件系统就行,所以可以把 windows 或 ubuntu 的 iso 直接解压到一个 fat 分区（比如 fat 的 u 盘或移动硬盘）然后引导<br><strong>有些UEFI系统只会识别 efi分区下的EFI&#x2F;boot文件夹内的efi文件,有的甚至只会识别EFI&#x2F;boot&#x2F;bootx64.efi</strong></p>
]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>efi</tag>
        <tag>uefi</tag>
      </tags>
  </entry>
  <entry>
    <title>python获取网页源码(爬虫?)</title>
    <url>/posts/cee10602/</url>
    <content><![CDATA[<p>利用requrst,使用首先要</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url = &apos;要获取的网页地址&apos;</span><br><span class="line">useragent = &apos;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&apos;#user-agent 可有可无,有些网页防爬虫就要模拟浏览器</span><br><span class="line">requests.get(url,headers=&#123;&apos;User-Agent&apos;:useragent&#125;))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>编程</tag>
      </tags>
  </entry>
  <entry>
    <title>とある番組の記録</title>
    <url>/posts/fe7367b8/</url>
    <content><![CDATA[<p>最近わたくしはたくさん言葉知りました、記録したい、例えば：どこ見つかった、どうおもう。<br>今回は「２２・７　計算中」、この番組すごくおもしろい、ぜひ見てください。</p>
<h2 id="ツッコミ・漫才・呆け"><a href="#ツッコミ・漫才・呆け" class="headerlink" title="ツッコミ・漫才・呆け"></a>ツッコミ・漫才・呆け</h2><p>この番組のMCは三四郎さん、おふたりはお笑い芸人ですね、この前に私は全然しらなかった、いつも「ツッコミ」を言うで、知りたいですからしらべました。</p>
<h2 id="パクリ"><a href="#パクリ" class="headerlink" title="パクリ"></a>パクリ</h2><p>「滝川みうのテンションが上がる動画選手権」で都ちゃんの得点は０点、理由は彼女作りASMR動画は最初みうちゃんの自己PR動画のなかのひとつのパクリ。ここがわたくし知りました。</p>
<h2 id="醍醐味"><a href="#醍醐味" class="headerlink" title="醍醐味"></a>醍醐味</h2><p>相田さんはとある回あるVTRの評価です。</p>
<h2 id="屁理屈"><a href="#屁理屈" class="headerlink" title="屁理屈"></a>屁理屈</h2><p>桜ちゃんたくさん屁理屈を言った、でもかわいいです。</p>
<h2 id="キャバクラ"><a href="#キャバクラ" class="headerlink" title="キャバクラ"></a>キャバクラ</h2><p>「誰かキャバクラに誘うたらどうですか？」は第７３回と７４回でひとつ問題です。神木みかみ優しすぎる、結果受ける。</p>
<h2 id="ため口"><a href="#ため口" class="headerlink" title="ため口"></a>ため口</h2><p>じつはわたくしは日本の上下関係理解不能。なんで「先輩に対してため口なんであり得ないだろう。」、堅苦しい過ぎるじゃないか。</p>
<h2 id="オラオラ"><a href="#オラオラ" class="headerlink" title="オラオラ"></a>オラオラ</h2><p>わたくし今覚えるのはこれは相田さん誰に評価です。</p>
<h2 id="オフショット・グラビア"><a href="#オフショット・グラビア" class="headerlink" title="オフショット・グラビア"></a>オフショット・グラビア</h2><p>１．いつもの写真<br>２．アイドルの写真</p>
<h2 id="ロケ"><a href="#ロケ" class="headerlink" title="ロケ"></a>ロケ</h2><p>多分VTRです。外へ出てに撮影すること。</p>
<hr>
<p>まだまだあるです。</p>
]]></content>
      <categories>
        <category>日本語</category>
      </categories>
      <tags>
        <tag>日本語</tag>
      </tags>
  </entry>
  <entry>
    <title>三蛋空间自建贴吧云签到</title>
    <url>/posts/8a291f21/</url>
    <content><![CDATA[<h2 id="–"><a href="#–" class="headerlink" title="–"></a>–</h2><p>这是我自建的贴吧云签到:<del><a href="http://dmly.tk/" target="_blank" rel="noopener">http://dmly.tk</a></del>(已失效)<br>之后为教程</p>
<h3 id="注册免费空间"><a href="#注册免费空间" class="headerlink" title="注册免费空间"></a>注册免费空间</h3><p>首先你得注册一个三蛋空间的账号,三蛋空间注册网址:<a href="https://www.000webhost.com/members/website/list" target="_blank" rel="noopener">三蛋空间</a><a id="more"></a></p>
<h3 id="创建网站"><a href="#创建网站" class="headerlink" title="创建网站"></a>创建网站</h3><p>注册完成之后点击这里 添加一个空模版,如图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/%E6%B3%A8%E5%86%8C.png"></p>
<p>写上名字和密码,点击create</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/%E5%90%8D%E5%AD%97.png"></p>
<h3 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h3><p>下载SmartFTP Client或者其他你熟悉的ftp上传工具,这里百度就行了<br>进入三蛋空间的管理网站,点击这里,如图</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/detile.png"><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/%5D%60$%603%29%284TGPPR%5DZDA8@60W8.png"></p>
<p>把这里的信息填入SmartFTP Client中</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/NS0ID6B9@2EIS4%25%7D%7B%60KLQQ7.png"><br>然后点ok</p>
<h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p>贴吧云签到源码github地址:<a href="https://github.com/MoeNetwork/Tieba-Cloud-Sign" target="_blank" rel="noopener">Tieba-Cloud-Sign</a><br>点击这里下载zip并解压</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/GA%5D3BI8Q77U8J%7DTW2%25PD%5D4L.png"></p>
<p>将解压得到的所有文件拖入ftp上的public_html文件夹中</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/LR%7D$65~BX37S2%29I%7DL%60Y309.png"></p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>然后进入三蛋空间创建数据库<br>三蛋空间会自动给你的数据库名字前加上数字,所以之后在贴吧安装中要注意</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/4%25JP1V7TEKX4IE0~1UUQN%5DU.png"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>之后进入你的网站,然后安装就行了.</p>
<h3 id="创建cron-job"><a href="#创建cron-job" class="headerlink" title="创建cron job"></a>创建cron job</h3><p>安装完成后就要把do.php加入cron,否则是不会自动签到的,按图中的步骤进行<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/P5LC1%7B%7D%7BQ%7B1_QCZ0%5DE@L0WO.png"></p>
]]></content>
      <categories>
        <category>建站</category>
      </categories>
      <tags>
        <tag>建站</tag>
        <tag>免费</tag>
      </tags>
  </entry>
  <entry>
    <title>利用结构体让函数返回多个值</title>
    <url>/posts/c69434f1/</url>
    <content><![CDATA[<h2 id="c语言"><a href="#c语言" class="headerlink" title="c语言"></a>c语言</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">typedef struct test //建立结构体</span><br><span class="line">&#123;</span><br><span class="line">    int a;</span><br><span class="line">    int b;</span><br><span class="line">    int c;</span><br><span class="line">&#125;T;</span><br><span class="line"></span><br><span class="line">T testt(int aa,int bb,int cc) //建立函数</span><br><span class="line">&#123;</span><br><span class="line">    T aaa;</span><br><span class="line">    aaa.a=aa*bb;</span><br><span class="line">    aaa.b=aa*cc;</span><br><span class="line">    aaa.c=bb*cc;</span><br><span class="line">    return aaa; //返回结构</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    T b=testt(4,5,6);</span><br><span class="line">    printf(&quot;%d %d %d \n&quot;,b.a,b.b,b.c);</span><br><span class="line">    T *f=&amp;b;</span><br><span class="line">    printf(&quot;%d %d %d&quot;,f-&gt;a,f-&gt;b,f-&gt;c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &quot;iostream&quot;</span><br><span class="line">typedef struct sss //建立结构体</span><br><span class="line">&#123;</span><br><span class="line">    int a;</span><br><span class="line">    int b;</span><br><span class="line">    int c;</span><br><span class="line">&#125;S;</span><br><span class="line"></span><br><span class="line">S s(double a,double b,double c) 建立函数</span><br><span class="line">&#123;</span><br><span class="line">    S d;</span><br><span class="line">    d.a=a*a;</span><br><span class="line">    d.b=b*b;</span><br><span class="line">    d.c=c*c;</span><br><span class="line">    return d;//返回结构体</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    S z=s(3,4,5);</span><br><span class="line">    std::cout&lt;&lt;z.a</span><br><span class="line">             &lt;&lt;std::endl</span><br><span class="line">             &lt;&lt;z.b</span><br><span class="line">             &lt;&lt;std::endl</span><br><span class="line">             &lt;&lt;z.c</span><br><span class="line">             &lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C++</tag>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言利用char指针变量将int按字节打印地址</title>
    <url>/posts/43cb2931/</url>
    <content><![CDATA[<p>因为int变量的大小为四个字节,所以如果利用int指针变量+1输出地址的话,实际上是加了四个字节后的地址.<br>而char的大小刚好为一个字节,是我们想要的东西.<br>这样我们可以强制转换为char指针变量输出每个字节的地址然后+1,+2,+3来分别输出int的四个字节的地址,得到我们想要的内容.<br>代码如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int a=-65;</span><br><span class="line">char *b=(char *)&amp;a;</span><br><span class="line">printf(&quot;%p\n%p\n%p\n%p\n&quot;,a,a+1,a+2,a+3);</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>如果你想按字节输出内存中的内容可以这样写,这里我输出的是16进制整数.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int a=-65;</span><br><span class="line">char *b=(char *)&amp;a;</span><br><span class="line">printf(&quot;%02x\n%02x\n%02x\n%02x\n&quot;,*(unsigned char*)a,*(unsigned char*)(a+1),*(unsigned char*)(a+2),*(unsigned char*)(a+3));</span><br></pre></td></tr></table></figure>

<p>两者结合一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int a=-65;</span><br><span class="line">char *b=(char *)&amp;a;</span><br><span class="line">printf(&quot;%p %02x\n%p %02x\n%p %02x\n%p %02x\n&quot;,a,*(unsigned char*)a,a+1,*(unsigned char*)(a+1),a+2,*(unsigned char*)(a+2),a+3,*(unsigned char*)(a+3));</span><br></pre></td></tr></table></figure>

<p>输出内容如图<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/TIM%E6%88%AA%E5%9B%BE20171024224821.png"><br><strong>有任何错误请邮箱联系我指出我的错误,万分感谢</strong></p>
]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>为广告而生,从使用到干掉大陆版MIUI</title>
    <url>/posts/6c3a98b5/</url>
    <content><![CDATA[<p>使用四年多的锤子手机越来越不堪重负，我决定换一款新的手机，在精心挑选后，选定了今年年初发布的一款Red MI手机，其极高的性价比打动了我。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在收货当天就迫不及待下班回家开始把玩，有一个词可以形容我当时的体验：軽い。<br>换手机的契机也是如此，国产app越来越毒瘤，旧手机越来越卡，开启健康码和支付宝都要至少等待2秒。由于四年的落差，即使是一款性价比手机也让我觉得好流畅，还有120hz屏幕，令我爱不释手。  </p>
<h2 id="忍受"><a href="#忍受" class="headerlink" title="忍受"></a>忍受</h2><p>我知道MIUI是有广告的，但根据各种网上的说法，是有开关是可以关闭的。<br>所以我一入手就根据网上流传的各种方法将隐藏在系统不同角落的广告关闭了。<br>确实有效，APP和系统设置中的一些广告确实没有了，天真的我以为真的干掉了广告。<br>但是不定时广告推送，小米商城推送各种促销，系统自带浏览器也开始充当新闻客户端，各种推送傻逼新闻，而这一切的前提都是在我进入软件关闭各种推送的条件下，在了解后得知可以使用ADB冻结几个系统软件解决，我冻结了以下系统软件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb shell pm disable-user com.xiaomi.ab</span><br><span class="line">adb shell pm disable-user com.miui.systemAdSolution</span><br><span class="line">adb shell pm disable-user com.miui.analytics</span><br><span class="line">adb shell pm disable-user com.sohu.inputmethod.sogou.xiaomi</span><br></pre></td></tr></table></figure>

<p>确实有效，而且连某些app的开屏广告都没了。</p>
<h2 id="愤怒"><a href="#愤怒" class="headerlink" title="愤怒"></a>愤怒</h2><a id="more"></a>
<p>虽然我不重度依赖谷歌，但我重度使用Twitter,Youtube,Reddit，在使用一段时间后，我发现推特的推送不灵了，每次开屏才会一堆一堆的推送，而在息屏的情况下根本收不到推送。<br>最初我一度认为是自己的设置有问题，毕竟连我的旧手机锤子都可以及时收到各种推送。<br>在对Google Play Service各种设置后，包括但不限于，取消应用黑名单，后台锁住app，但没有任何改变。<br>在了解后得知，大陆版MIUI会在息屏后断开FCM的连接，且强制设置在FCM断开后不再允许其重连，这一切我都可以理解，由于国内的环境，不断重试确实会导致耗电增加，在网友提醒下我通过ADB冻结了以下两个应用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb shell pm disable-user com.miui.powerkeeper</span><br><span class="line">adb shell pm disable-user com.xiaomi.powerchecker</span><br></pre></td></tr></table></figure>

<p>别说，还真有用，基本上能正常收到推送了，我以为我解决问题了。<br><strong>但是</strong><br>我发现息屏情况下播放音乐，音乐会自动暂停，在上网搜索后，我发现不只我有这个问题，在各方打听后得知是冻结<code>com.miui.powerkeeper</code>导致的。<br>加上KDE connect会时不时的断开，我真的很愤怒，我能理解MIUI的做法，但我无法忍受不给用户任何开关一刀切的做法，所以我决定干掉自带的陆版MIUI。</p>
<h2 id="成为“欧洲人”"><a href="#成为“欧洲人”" class="headerlink" title="成为“欧洲人”"></a>成为“欧洲人”</h2><p>在经过7天的忍受之后，备份好手机内的各种资料后，成功解锁了手机。<br>我决定刷入<code>XIAOMI.EU</code>，一个被小米官方和欧洲ABC经销商认可的官改系统。<br>在<a href="https://xiaomi.eu/" target="_blank" rel="noopener">xiaomi.eu</a>上提前下载适用于手机的twrp和ROM。  </p>
<ul>
<li><p>临时刷入TWRP并进入TWRP</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fastboot flash recovery twrp.img</span><br><span class="line">fastboot boot twrp.img</span><br></pre></td></tr></table></figure>
</li>
<li><p>在TWRP内格式化DATA分区，<strong>注意不要清除System和Persist分区</strong>。</p>
</li>
<li><p>在TWRP内开启sideload。  </p>
</li>
<li><p>通过sideload刷入rom</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb sideload xxxxx.ZIP</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在百分之47的时候会结束，貌似是个bug，不过这个时候其实已经成功刷入了，直接重启进入系统即可。</p>
<h2 id="享受"><a href="#享受" class="headerlink" title="享受"></a>享受</h2><p>没有了小米的各种广告推送，自带谷歌play商店，而不是小米应用商店，手动安装应用时不再要求你多次确认，正常的FCM推送，不再断开的KDE Connect，虽然缺失了一部分特有的功能，但此时此刻我感受到了成为“欧洲人”的优越感。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果你喜欢折腾且会刷机，那么小米手机依旧可以在你的购机候选名单中，否贼就将其永久拉黑。<br>我不认同广告漫天飞的系统会符合用户习惯，包括所谓“符合中国用户习惯”。  </p>
]]></content>
      <categories>
        <category>Personally</category>
      </categories>
  </entry>
  <entry>
    <title>使用GVT-g显卡虚拟化</title>
    <url>/posts/3a1d136/</url>
    <content><![CDATA[<h2 id="为内核添加参数"><a href="#为内核添加参数" class="headerlink" title="为内核添加参数"></a>为内核添加参数</h2><p>比如<code>grub</code>在<code>/etc/default/grub</code>的<code>GRUB_CMDLINE_LINUX_DEFAULT=</code>中添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">intel_iommu=on i915.enable_gvt=1 i915.enable_guc=0</span><br></pre></td></tr></table></figure>

<h2 id="启用modules"><a href="#启用modules" class="headerlink" title="启用modules"></a>启用modules</h2><p>在<code>/etc/mkinitcpio.conf</code>的MODULES&#x3D;()&#96;中添加:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># linux 5.14后，arch的linux内核模块已经不会勾选vfio-mdev，自测不影响gvt-g</span><br><span class="line">kvmgt vfio vfio-iommu-type1s</span><br></pre></td></tr></table></figure>

<p>然后运行,我用的zen内核所以是linux-zen,默认内核是linux</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkinitcpio -p linux-zen</span><br></pre></td></tr></table></figure>

<p>重启计算机  </p>
<p>查看<code>/sys/devices/pci0000:00/0000:00:02.0/mdev_supported_types</code>可以看见类似如下的目录</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ls /sys/devices/pci$&#123;GVT_DOM&#125;/$GVT_PCI/mdev_supported_types</span></span><br><span class="line">i915-GVTg_V5_1  <span class="comment"># Video memory: &lt;512MB, 2048MB&gt;, resolution: up to 1920x1200</span></span><br><span class="line">i915-GVTg_V5_2  <span class="comment"># Video memory: &lt;256MB, 1024MB&gt;, resolution: up to 1920x1200</span></span><br><span class="line">i915-GVTg_V5_4  <span class="comment"># Video memory: &lt;128MB, 512MB&gt;, resolution: up to 1920x1200</span></span><br><span class="line">i915-GVTg_V5_8  <span class="comment"># Video memory: &lt;64MB, 384MB&gt;, resolution: up to 1024x768</span></span><br></pre></td></tr></table></figure>

<p>向create文件中写入uuid(自己生成)就会创建相应的虚拟显卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$GVT_GUID</span>"</span> &gt; <span class="string">"/sys/devices/pci<span class="variable">$&#123;GVT_DOM&#125;</span>/<span class="variable">$GVT_PCI</span>/mdev_supported_types/<span class="variable">$GVT_TYPE</span>/create"</span></span><br></pre></td></tr></table></figure>

<p>移除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/bus/pci/devices/<span class="variable">$GVT_PCI</span>/<span class="variable">$GVT_GUID</span>/remove</span><br></pre></td></tr></table></figure>

<h2 id="qemu添加钩子-启动虚拟机时自动创建虚拟显卡"><a href="#qemu添加钩子-启动虚拟机时自动创建虚拟显卡" class="headerlink" title="qemu添加钩子, 启动虚拟机时自动创建虚拟显卡"></a>qemu添加钩子, 启动虚拟机时自动创建虚拟显卡</h2><p><code>/etc/libvirt/hooks/qemu</code>中, 沒有则自己创建</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">GVT_PCI=&lt;GVT_PCI&gt; <span class="comment"># 这里为显卡的地址, 比如 0000:00:02.0</span></span><br><span class="line">GVT_GUID=&lt;GVT_GUID&gt; <span class="comment"># 这里为自己生成的uuid</span></span><br><span class="line">MDEV_TYPE=&lt;GVT_TYPE&gt; <span class="comment"># 这里为要使用的虚拟的类型, 比如 i915-GVTg_V5_8</span></span><br><span class="line">DOMAIN=&lt;DOMAIN name&gt; <span class="comment"># qemu虚拟机的名字</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ge 3 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> = <span class="string">"<span class="variable">$DOMAIN</span>"</span> -a <span class="variable">$2</span> = <span class="string">"prepare"</span> -a <span class="variable">$3</span> = <span class="string">"begin"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$GVT_GUID</span>"</span> &gt; <span class="string">"/sys/bus/pci/devices/<span class="variable">$GVT_PCI</span>/mdev_supported_types/<span class="variable">$MDEV_TYPE</span>/create"</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$1</span> = <span class="string">"<span class="variable">$DOMAIN</span>"</span> -a <span class="variable">$2</span> = <span class="string">"release"</span> -a <span class="variable">$3</span> = <span class="string">"end"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 1 &gt; /sys/bus/pci/devices/<span class="variable">$GVT_PCI</span>/<span class="variable">$GVT_GUID</span>/remove</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>这样启动虚拟机时会自动创建, 停止后会自动删除</p>
<h2 id="生成虚拟机配置"><a href="#生成虚拟机配置" class="headerlink" title="生成虚拟机配置"></a>生成虚拟机配置</h2><p>可以使用<code>virt-manager</code>先生成一个虚拟机, 再修改相应的配置, 默认配置文件在<code>/etc/libvirt/qemu/</code><br>需要添加&#x2F;修改的配置:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">qemu:commandline</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'-set'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'device.hostdev0.x-igd-opregion=on'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'-set'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'device.hostdev0.ramfb=on'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'-set'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:arg</span> <span class="attr">value</span>=<span class="string">'device.hostdev0.driver=vfio-pci-nohotplug'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">qemu:env</span> <span class="attr">name</span>=<span class="string">'MESA_LOADER_DRIVER_OVERRIDE'</span> <span class="attr">value</span>=<span class="string">'i965'</span>/&gt;</span> <span class="comment">&lt;!--intel启用OpenGL可能会花屏, 不会就不要加这一条--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">qemu:commandline</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>hostdev配置可以在添加硬件(PCI HOST Devices)的界面直接修改xml, 更方便一点</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hostdev</span> <span class="attr">mode</span>=<span class="string">'subsystem'</span> <span class="attr">type</span>=<span class="string">'mdev'</span> <span class="attr">managed</span>=<span class="string">'no'</span> <span class="attr">model</span>=<span class="string">'vfio-pci'</span> <span class="attr">display</span>=<span class="string">'on'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">address</span> <span class="attr">uuid</span>=<span class="string">'93397e71-15bf-4889-98b7-aa2d735e6260'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">address</span> <span class="attr">type</span>=<span class="string">'pci'</span> <span class="attr">domain</span>=<span class="string">'0x0000'</span> <span class="attr">bus</span>=<span class="string">'0x00'</span> <span class="attr">slot</span>=<span class="string">'0x09'</span> <span class="attr">function</span>=<span class="string">'0x0'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hostdev</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">model</span> <span class="attr">type</span>=<span class="string">'none'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">graphics</span> <span class="attr">type</span>=<span class="string">'spice'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listen</span> <span class="attr">type</span>=<span class="string">'none'</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">compression</span>=<span class="string">'off'</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jpeg</span> <span class="attr">compression</span>=<span class="string">'never'</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zlib</span> <span class="attr">compression</span>=<span class="string">'never'</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">playback</span> <span class="attr">compression</span>=<span class="string">'off'</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">streaming</span> <span class="attr">mode</span>=<span class="string">'off'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">gl</span> <span class="attr">enable</span>=<span class="string">'yes'</span> <span class="attr">rendernode</span>=<span class="string">'/dev/dri/by-path/pci-0000:00:02.0-render'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">graphics</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">'static'</span>&gt;</span>2<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cputune</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">'0'</span> <span class="attr">cpuset</span>=<span class="string">'1'</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">vcpupin</span> <span class="attr">vcpu</span>=<span class="string">'1'</span> <span class="attr">cpuset</span>=<span class="string">'2'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cputune</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>启动虚拟机后, 进入虚拟机安装相应的显卡驱动就行了.<br>这样就快很多了, 比软件渲染快多了, 这样用linux也能愉快的使用其他系统了.</p>
<hr>
<p><a href="https://wiki.archlinux.org/index.php/Intel_GVT-g" target="_blank" rel="noopener">Intel_GVT-g</a><br><a href="https://medium.com/@langleyhouge/%E8%AE%A9-kvm-%E4%B8%8A%E7%9A%84-windows-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8F%92%E4%B8%8Agvt-g-%E7%9A%84%E7%BF%85%E8%86%80-ac0ac28b73b8" target="_blank" rel="noopener">让 KVM 上的 Windows 虚拟机插上GVT-g 的翅膀</a><br><a href="https://www.libvirt.org/hooks.html" target="_blank" rel="noopener">libvirt hooks</a><br><a href="https://blog.bepbep.co/posts/gvt/" target="_blank" rel="noopener">Intel Gvt</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>qemu</tag>
        <tag>GVT-g</tag>
        <tag>intel</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓使用dalvikvm运行java(termux运行java)</title>
    <url>/posts/8b98169e/</url>
    <content><![CDATA[<p>一直想要使用termux来在安卓上写java,但termux上只有ecj可以使java编译为目标文件class,却不能使其编译为可执行文件<br>发现通过安卓自带的dalvikvm可以运行,只是步骤繁琐一些  </p>
<h2 id="安装所需工具"><a href="#安装所需工具" class="headerlink" title="安装所需工具"></a>安装所需工具</h2><p>termux上安装 ecj 和 dx就可以了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt install ecj dx</span><br></pre></td></tr></table></figure>

<h2 id="编译为class文件"><a href="#编译为class文件" class="headerlink" title="编译为class文件"></a>编译为class文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ecj XXX.java</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<h2 id="编译成dex文件"><a href="#编译成dex文件" class="headerlink" title="编译成dex文件"></a>编译成dex文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dx --dex --output=XXX.dex XXX.class</span><br></pre></td></tr></table></figure>

<h2 id="使用dalvikvm运行"><a href="#使用dalvikvm运行" class="headerlink" title="使用dalvikvm运行"></a>使用dalvikvm运行</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dalvikvm -cp XXX.dex XXX</span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://bbs.pediy.com/thread-184592.htm" target="_blank" rel="noopener">使用 dalvikvm 执行一个运行于命令行的 Hello World</a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>加密模式</title>
    <url>/posts/903c04f7/</url>
    <content><![CDATA[<h2 id="流密码"><a href="#流密码" class="headerlink" title="流密码"></a>流密码</h2><p>密码学中，流密码（英語：Stream cipher），又譯為串流加密、資料流加密，是一种对称加密算法，加密和解密双方使用相同伪随机加密数据流（pseudo-random stream）作为密钥，明文数据每次与密钥数据流顺次对应加密，得到密文数据流。实践中数据通常是一个位（bit）并用异或（xor）操作加密。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E6%B5%81%E5%AF%86%E7%A0%81" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%B5%81%E5%AF%86%E7%A0%81</a></p>
<ul>
<li>chacha20&#x2F;salsa20</li>
<li>rc4</li>
</ul>
<h2 id="块密码-x2F-分组密码"><a href="#块密码-x2F-分组密码" class="headerlink" title="块密码&#x2F;分组密码"></a>块密码&#x2F;分组密码</h2><p>块密码只能对确定长度的数据块进行处理, 如aes每个块的大小必须为16, 如果不满16就需要进行padding</p>
<h3 id="加密模式"><a href="#加密模式" class="headerlink" title="加密模式"></a>加密模式</h3><h4 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h4><p>最简单的加密模式即为电子密码本（Electronic codebook，ECB）模式。需要加密的消息按照块密码的块大小被分为数个块，并对每个块进行独立加密。</p>
<h4 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h4><p>在CBC模式中，每个明文块先与前一个密文块进行异或后，再进行加密。在这种方法中，每个密文块都依赖于它前面的所有明文块。同时，为了保证每条消息的唯一性，在第一个块中需要使用初始化向量。</p>
<h4 id="PCBC"><a href="#PCBC" class="headerlink" title="PCBC"></a>PCBC</h4><p>填充密码块链接（PCBC，Propagating cipher-block chaining）或称为明文密码块链接（Plaintext cipher-block chaining），是一种可以使密文中的微小更改在解密时导致明文大部分错误的模式，并在加密的时候也具有同样的特性。</p>
<a id="more"></a>
<h4 id="块密码-gt-流密码"><a href="#块密码-gt-流密码" class="headerlink" title="块密码 -&gt; 流密码"></a>块密码 -&gt; 流密码</h4><ul>
<li>CFB<br>  密文反馈（CFB，Cipher feedback）模式类似于CBC，可以将块密码变为自同步的流密码；工作过程亦非常相似，CFB的解密过程几乎就是颠倒的CBC的加密过程.<br>  由于CFB加密没有使用异或, 所以即使CFB是流密码, 但加密解密操作不同.</li>
<li>OFB<br>  输出反馈模式（Output feedback, OFB）可以将块密码变成同步的流密码。它产生密钥流的块，然后将其与明文块进行异或，得到密文。与其它流密码一样，密文中一个位的翻转会使明文中同样位置的位也产生翻转。这种特性使得许多错误校正码，例如奇偶校验位，即使在加密前计算，而在加密后进行校验也可以得出正确结果。</li>
<li>CTR<br>  与OFB相似，CTR将块密码变为流密码。它通过递增一个加密计数器以产生连续的密钥流，其中，计数器可以是任意保证长时间不产生重复输出的函数，但使用一个普通的计数器是最简单和最常见的做法。使用简单的、定义好的输入函数是有争议的：批评者认为它“有意的将密码系统暴露在已知的、系统的输入会造成不必要的风险”。目前，CTR已经被广泛的使用了，由输入函数造成的问题被认为是使用的块密码的缺陷，而非CTR模式本身的弱点。无论如何，有一些特别的攻击方法，例如基于使用简单计数器作为输入的硬件差错攻击。</li>
</ul>
<h2 id="认证加密-AE"><a href="#认证加密-AE" class="headerlink" title="认证加密(AE)"></a>认证加密(AE)</h2><p>A typical programming interface for an AE implementation provides the following functions:</p>
<ul>
<li>Encryption<br>  Input: plaintext, key, and optionally a header in plaintext that will not be encrypted, but will be covered by authenticity protection.<br>  Output: ciphertext and authentication tag (message authentication code or MAC).</li>
<li>Decryption<br>  Input: ciphertext, key, authentication tag, and optionally a header (if used during the encryption).<br>  Output: plaintext, or an error if the authentication tag does not match the supplied ciphertext or header.</li>
</ul>
<p>The header part is intended to provide authenticity and integrity protection for networking or storage metadata for which confidentiality is unnecessary, but authenticity is desired.</p>
<p><a href="https://en.wikipedia.org/wiki/Authenticated_encryption#Authenticated_encryption_with_associated_data_(AEAD)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Authenticated_encryption#Authenticated_encryption_with_associated_data_(AEAD)</a></p>
<h3 id="传统认证加密"><a href="#传统认证加密" class="headerlink" title="传统认证加密"></a>传统认证加密</h3><ul>
<li><p>Encrypt-then-MAC (EtM)<br>  首先对明文进行加密，然后根据得到的密文生成訊息鑑別碼（MAC）。密文和它的MAC一起发送。</p>
  <figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+---------+</span><br><span class="line">|plaintext|</span><br><span class="line">+---------+</span><br><span class="line"><span class="code">    |</span></span><br><span class="line"><span class="code">    v</span></span><br><span class="line">+----------+</span><br><span class="line">|Encryption|<span class="xml"><span class="tag">&lt;<span class="name">------key1</span></span></span></span><br><span class="line"><span class="xml">+----------+</span></span><br><span class="line"><span class="xml">     |</span></span><br><span class="line"><span class="xml">     |--------------+</span></span><br><span class="line"><span class="xml">     |              |</span></span><br><span class="line"><span class="xml">     |              v</span></span><br><span class="line"><span class="xml">     |        +-------------+</span></span><br><span class="line"><span class="xml">     |        |hash function|<span class="tag">&lt;<span class="name">-------key2</span></span></span></span><br><span class="line"><span class="xml">     |        +-------------+</span></span><br><span class="line"><span class="xml">     |              |</span></span><br><span class="line"><span class="xml">     v              v</span></span><br><span class="line"><span class="xml">+----------------+------+</span></span><br><span class="line"><span class="xml">|    Ciphertext  | MAC  |</span></span><br><span class="line"><span class="xml">+----------------+------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Encrypt-and-MAC (E&amp;M)<br>  基于明文生成MAC，并且明文在没有MAC的情况下被加密。明文的MAC和密文一起发送。</p>
  <figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+---------+</span><br><span class="line">|plaintext|</span><br><span class="line">+---------+</span><br><span class="line"><span class="code">    |</span></span><br><span class="line"><span class="code">    |--------------------------------+</span></span><br><span class="line"><span class="code">    |                                |</span></span><br><span class="line"><span class="code">    v                                v</span></span><br><span class="line">+----------+                 +-------------+</span><br><span class="line">|Encryption|<span class="xml"><span class="tag">&lt;<span class="name">------key1----</span>&gt;</span></span> |hash function|</span><br><span class="line">+----------+                 +-------------+</span><br><span class="line"><span class="code">     |                               |</span></span><br><span class="line"><span class="code">     v                               v</span></span><br><span class="line">+------------------------------+--------+</span><br><span class="line">|        Ciphertext            |   MAC  |</span><br><span class="line">+------------------------------+--------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>MAC-then-Encrypt (MtE)<br>  基于明文生成MAC，然后将明文和MAC一起加密以基于两者生成密文。密文（包含加密的MAC）被发送。MtE方法本身并未被证明是“强不可伪造”的。</p>
  <figure class="highlight md"><table><tr><td class="code"><pre><span class="line">+---------+</span><br><span class="line">|plaintext|                           key</span><br><span class="line">+---------+                            |</span><br><span class="line"><span class="code">    |                                  |</span></span><br><span class="line"><span class="code">    |------------------+               |</span></span><br><span class="line"><span class="code">    |                  |               |</span></span><br><span class="line"><span class="code">    |                  v               |</span></span><br><span class="line"><span class="code">    |           +-------------+        |</span></span><br><span class="line"><span class="code">    |           |hash function|&lt;-------|</span></span><br><span class="line"><span class="code">    |           +-------------+        |</span></span><br><span class="line"><span class="code">    |                  |               |</span></span><br><span class="line"><span class="code">    v                  v               |</span></span><br><span class="line">+------------------+------+            |</span><br><span class="line">|     plaintext    | MAC  |            |</span><br><span class="line">+------------------+------+            |</span><br><span class="line"><span class="code">             |                         |</span></span><br><span class="line"><span class="code">             v                         |</span></span><br><span class="line"><span class="code">      +----------------+               |</span></span><br><span class="line"><span class="code">      | Encryption     |&lt;--------------+</span></span><br><span class="line"><span class="code">      +----------------+</span></span><br><span class="line"><span class="code">             |</span></span><br><span class="line"><span class="code">             v</span></span><br><span class="line"><span class="code">       +-------------+</span></span><br><span class="line"><span class="code">       | Ciphertext  |</span></span><br><span class="line"><span class="code">       +-------------+</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="AEAD-带有关联数据的认证加密"><a href="#AEAD-带有关联数据的认证加密" class="headerlink" title="AEAD(带有关联数据的认证加密)"></a>AEAD(带有关联数据的认证加密)</h3><h4 id="chacha20-poly1305"><a href="#chacha20-poly1305" class="headerlink" title="chacha20-poly1305"></a>chacha20-poly1305</h4><p>chacha20-poly1305是将流密码chahca20和消息验证码(MAC)poly1305组合而成的AEAD.  </p>
<p>chacha20-poly1305加密过程<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/903c04f7/chacha20poly1305-enc.png" alt="chacha20-enc"></p>
<p>chacha20-poly1305解密<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/903c04f7/chacha20poly1305-dec.png" alt="chacha20-dec"></p>
<hr>
<ul>
<li><a href="https://tex2e.github.io/blog/crypto/chacha20poly1305" target="_blank" rel="noopener">ChaCha20-Poly1305の解説と実装</a></li>
</ul>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
        <tag>AEAD</tag>
        <tag>流密码</tag>
        <tag>块密码</tag>
        <tag>chacha20-poly1305</tag>
      </tags>
  </entry>
  <entry>
    <title>动漫影评</title>
    <url>/posts/665020d8/</url>
    <content><![CDATA[<p>目前我只会记录最近看了个，有些看的比较早的就不记录了，记忆也比较模糊。</p>
<h2 id="自定义神剧（个人主观决定）"><a href="#自定义神剧（个人主观决定）" class="headerlink" title="自定义神剧（个人主观决定）"></a>自定义神剧（个人主观决定）</h2><ul>
<li>CLANNAD</li>
<li>Kanon</li>
<li>リトルバスターズ!</li>
<li>Air</li>
<li>Angel Beats! -1st beat-</li>
<li>かぎなど</li>
<li>true tears</li>
<li>花咲くいろは</li>
<li>TARI TARI</li>
</ul>
<h2 id="Key"><a href="#Key" class="headerlink" title="Key"></a>Key</h2><p>key社的动漫作品我几乎全看了，大部分都很好看，推荐：</p>
<ul>
<li>CLANNAD</li>
<li>Kanon</li>
<li>リトルバスターズ!</li>
<li>Air</li>
<li>Angel Beats! -1st beat-</li>
</ul>
<h3 id="リトルバスターズ"><a href="#リトルバスターズ" class="headerlink" title="リトルバスターズ!"></a>リトルバスターズ!</h3><p>主讲友情，第一季主要根据不同角色为引进行剧情引导，剧情引导也很自然。<br>第二季类似揭秘篇，来揭秘第一季剧情的真实面目及背景，当然也是key社的特点，真实中带有一点奇幻。<br>还有几集ova讲隐藏角色和后续剧情之类的。  </p>
<p>动画制作是 J.C. Staff, 对我来说很好，崛江由衣配的男主角我也很喜欢，很符合角色的形象。  </p>
<p>对我来说，与Kanon，CLANNAD略逊一筹，但也很好看，非常推荐，我是一天就看完了第一季20多集，第二天把剩下都看完了。</p>
<h4 id="クドわふたー"><a href="#クドわふたー" class="headerlink" title="クドわふたー"></a>クドわふたー</h4><p>算是不同世界线的一个剧场版，女主角变成了クド，剧情也比较短，没有TV动画好看，但也能看，不影响主剧剧情。</p>
<h3 id="Angel-Beats-1st-beat"><a href="#Angel-Beats-1st-beat" class="headerlink" title="Angel Beats! -1st beat-"></a>Angel Beats! -1st beat-</h3><p>与P.A. Works合作的第一部原创TV动画，剧情背景是死后世界，主讲男主一行人对女主的误解，及最后知道真相后对主角一行人的救赎。<br>剧情还是比较好看的，也没有硬伤，相信每个人看完之后都对人的一生的意义有不同看法，相信也能让不少人决定自己今后应该如何活下去。  </p>
<p>比不上Key社自己的作品，但也比另外两部原创动画好看且有意义，值得一看。</p>
<h3 id="Kanon"><a href="#Kanon" class="headerlink" title="Kanon"></a>Kanon</h3><p>这部算是主讲男主对几位女主的救赎（除水瀬名雪），なゆき的剧情实在是太短了，也没有其他几位女主角的好看，至少TV动画是这样的。<br>让我印象最深刻的是沢渡真琴，尤其是飯塚雅弓的配音实在是太完美了，可能因为我家里也有养猫，所以会有同感，喜欢猫，但每次猫撒娇，不知道是因为他生病了，还是单纯的撒娇，很让人担心。<br>因为这部算是按照GAL的模式改编的，有些地方可能比较生硬，但我还是非常喜欢这部作品，比上面的リトルバスターズ和Angel Beats都要喜欢。  </p>
<h3 id="Air"><a href="#Air" class="headerlink" title="Air"></a>Air</h3><p>这部前期和Kanon比较像，也是讲对几位女主的救赎，但整个剧情的设定完全变了。<br>主题曲是很好听，也很出名，但后面的剧情，说实话，我有点难以接受。<br>且这部算是唯一一部Key社的TV动画中以悲剧结尾的动画，其他几部虽然也很感动，但都是喜剧结尾。<br>当然这部也值得一看，比大部分动画还是好看的。</p>
<h3 id="神様になった日"><a href="#神様になった日" class="headerlink" title="神様になった日"></a>神様になった日</h3><p>与P.A. Works合作的第三部原创TV动画。<br>这部前期很正常，可以当作普通的日常动画，后期直接崩掉了，建议直接忽略后面几集，没有看的必要。<br>前面几集可以看，后面几集不推荐看。</p>
<h3 id="かぎなど"><a href="#かぎなど" class="headerlink" title="かぎなど"></a>かぎなど</h3><p>Key社自己的泡面番。<br>主讲各种地狱笑话，声优梗，剧情梗什么的，相当推荐看，前提是是把Key自己作品的TV动画全部看完加上Angel Beats。</p>
<h2 id="P-A-Works"><a href="#P-A-Works" class="headerlink" title="P.A. Works"></a>P.A. Works</h2><p>P.A. Works的几乎所有原创动画都很推荐：</p>
<ul>
<li>true tears</li>
<li>花咲くいろは</li>
<li>TARI TARI</li>
<li>グラスリップ</li>
<li>色づく世界の明日から</li>
<li>サクラクエスト</li>
<li>白い砂のアクアトープ</li>
<li>凪のあすから</li>
</ul>
<h3 id="true-tears"><a href="#true-tears" class="headerlink" title="true tears"></a>true tears</h3><p>true tears是PA的第一部原创动画，也是我目前看过的所有的PA的作品中最喜欢的一部。<br>剧情大概就是三女主都喜欢男主，最后某个人的胜利，而且结局对我来说是非常正常的一个走向，整个动画的制作都很精致，包括人物的动作细节，配音等我都很喜欢。<br>非常推荐的一部作品。</p>
<h3 id="花咲くいろは"><a href="#花咲くいろは" class="headerlink" title="花咲くいろは"></a>花咲くいろは</h3><p>PA打工系列的第一部，主讲仲居这个职业，除了前面几集，后面是真的体现这个职业的魅力之处，也有youtube的评论说自己看完这部TV动画后决定成为仲居、并且最后真的实现了。<br>其中有几集关于女主的爱情比较硬，算是这部的硬伤，不过整部看起来是真的好看，我用了一整天就看完了，完全停不下来。<br>非常推荐。</p>
<h3 id="TARI-TARI"><a href="#TARI-TARI" class="headerlink" title="TARI TARI"></a>TARI TARI</h3><p>主讲友情，讲了主角一行人，面对自己未来何去何从的纠结，有人比较顺利，有人困难重重最后也没有放弃，但是比较短，只有13集，剧情无硬伤。  </p>
<h3 id="グラスリップ"><a href="#グラスリップ" class="headerlink" title="グラスリップ"></a>グラスリップ</h3><p>这部比较意识流，主讲爱情，比较看人，我是比较喜欢的。</p>
<h3 id="色づく世界の明日から"><a href="#色づく世界の明日から" class="headerlink" title="色づく世界の明日から"></a>色づく世界の明日から</h3><p>这部有友情，有爱情，讲了女主被奶奶传送回奶奶高中时代之后，经历种种之后有所收获，且被男主拯救，虽然最后不得不回到自己所处的时代。<br>女主的人设也很可爱，这部我也非常喜欢。</p>
<h3 id="白い砂のアクアトープ"><a href="#白い砂のアクアトープ" class="headerlink" title="白い砂のアクアトープ"></a>白い砂のアクアトープ</h3><p>打工系列的其中一部，是近几年的作品，也是那时一集一集追着看的。<br>主角一行人面对不得不作出的决定，最后走上自己道路，相信大家在人生中会遇到很多这种时候，尤其是工作后，相信不少人感受更深。<br>也是一部很有意义的TV动画，推荐看。  </p>
]]></content>
      <categories>
        <category>影评</category>
      </categories>
      <tags>
        <tag>アニメ</tag>
        <tag>动漫</tag>
        <tag>影评</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓通过adb添加电池用户白名单</title>
    <url>/posts/1e63e0e/</url>
    <content><![CDATA[<p>安卓6.0引入了doze来节省电量,但某些国产ui(如锤子)阉割了这个菜单,可通过adb添加  </p>
<p>添加应用到白名单：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys deviceidle whitelist +&lt;package&gt;</span><br></pre></td></tr></table></figure>

<p>如:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys deviceidle whitelist +com.google.android.gms</span><br></pre></td></tr></table></figure>

<p>删除白名单(把加号改成减号):  <a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys deviceidle whitelist -&lt;package&gt;</span><br></pre></td></tr></table></figure>

<p>查看doze状态：  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys deviceidle</span><br></pre></td></tr></table></figure>

<p>获取完整的帮助菜单:  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys deviceidle -h</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Device idle controller (deviceidle) commands:</span><br><span class="line">  help</span><br><span class="line">    Print this help text.</span><br><span class="line">  step [light|deep]</span><br><span class="line">    Immediately step to next state, without waiting for alarm.</span><br><span class="line">  force-idle [light|deep]</span><br><span class="line">    Force directly into idle mode, regardless of other device state.</span><br><span class="line">  force-inactive</span><br><span class="line">    Force to be inactive, ready to freely step idle states.</span><br><span class="line">  unforce</span><br><span class="line">    Resume normal functioning after force-idle or force-inactive.</span><br><span class="line">  get [light|deep|force|screen|charging|network]</span><br><span class="line">    Retrieve the current given state.</span><br><span class="line">  disable [light|deep|all]</span><br><span class="line">    Completely disable device idle mode.</span><br><span class="line">  enable [light|deep|all]</span><br><span class="line">    Re-enable device idle mode after it had previously been disabled.</span><br><span class="line">  enabled [light|deep|all]</span><br><span class="line">    Print 1 if device idle mode is currently enabled, else 0.</span><br><span class="line">  whitelist</span><br><span class="line">    Print currently whitelisted apps.</span><br><span class="line">  whitelist [package ...]</span><br><span class="line">    Add (prefix with +) or remove (prefix with -) packages.</span><br><span class="line">  except-idle-whitelist [package ...|reset]</span><br><span class="line">    Prefix the package with &apos;+&apos; to add it to whitelist or &apos;=&apos; to check if it is already whitelisted</span><br><span class="line">    [reset] will reset the whitelist to it&apos;s original state</span><br><span class="line">    Note that unlike &lt;whitelist&gt; cmd, changes made using this won&apos;t be persisted across boots</span><br><span class="line">  tempwhitelist</span><br><span class="line">    Print packages that are temporarily whitelisted.</span><br><span class="line">  tempwhitelist [-u USER] [-d DURATION] [package ..]</span><br><span class="line">    Temporarily place packages in whitelist for DURATION milliseconds.</span><br><span class="line">    If no DURATION is specified, 10 seconds is used</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>常用等价无穷小的一般形式</title>
    <url>/posts/10bb899d/</url>
    <content><![CDATA[<p>当$\lim_{φ(x)\to0}$时,<br>$\sin φ(x)$<del>$φ(x)$<br>$arc\sin φ(x)$</del>$φ(x)$<br>$\tanφ(x)$<del>$φ(x)$<br>$arc\tanφ(x)$</del>$φ(x)$<br>$\ln(1+φ(x))$<del>$φ(x)$<br>$e^{φ(x)}-1$</del>$φ(x)$<br>$a^{φ(x)}-1$<del>$φ(x)\ln a$<br>$\sqrt[n]{1+φ(x)}-1$</del>$\frac{1}{n}φ(x)$<br>$(1+φ(x))^{\mu-1}$<del>$\muφ(x)$<br>$1-\cosφ(x)$</del>$\frac{(φ(x))^2}{2}$</p>
]]></content>
      <categories>
        <category>Math</category>
      </categories>
      <tags>
        <tag>Math</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓通过shell更改语言</title>
    <url>/posts/f7f814df/</url>
    <content><![CDATA[<p>对于Android M或更高版本，使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setprop ro.product.locale xx-XX</span><br><span class="line">setprop persist.sys.locale xx-XX</span><br></pre></td></tr></table></figure>

<p>xx是语言<br>XX是国家<br>改为日语为:xx&#x3D;ja XX&#x3D;JP  </p>
<p>其他安卓版本:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">setprop persist.sys.language xx</span><br><span class="line">setprop persist.sys.country XX</span><br><span class="line">setprop ctl.restart zygote</span><br></pre></td></tr></table></figure>

<p>xx是语言<br>XX是国家  <a id="more"></a><br>Zygote进程运行时, 会初始化Dalvik虚拟机, 并运行它. Android的应用程序是由Java编写的, 它们不能直接运行在Linux上, 只能运行在Dalvik虚拟机中. 并且, 每个应用程序都运行在各自的虚拟机中, 应用程序每次运行都要重新初始化并启动虚拟机, 这个过程会消耗相当长时间, 是拖慢应用程序的原因之一. 因此, 在Android中, 应用程序运行前, 通过Zygote进程共享已运行的虚拟机的代码与内存信息, 缩短应用程序运行所耗费的时间. 也就是说, Zygote进程会事先将应用程序要使用的Android Framework中的类与资源加载到内存中, 并组织形成所用资源的链接信息. 这样, 新运行的Android应用程序在使用所需资源时不必每次形成资源的链接信息, 这样就大大提升了程序的运行时间.   </p>
<p>参考:<br>1.<a href="http://bbs.bugcode.cn/t/16729" target="_blank" rel="noopener">通过ADB更改设备语言</a><br>2.<a href="https://www.jianshu.com/p/3dbe46439359" target="_blank" rel="noopener">初识Zygote进程</a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>暗影精灵更改efi启动顺序</title>
    <url>/posts/6683eff9/</url>
    <content><![CDATA[<p>–2019-04-22 更新–<br><strong>最新版bios已经可以调整启动顺序了(<a href="#jump">图在最下面</a>)</strong>  </p>
<p>——– 之 前 ——-<br>暗影精灵安装完ubuntu之后只能开机按esc+f9进入ubuntu，否则会直接启动windows,虽然可以使用但及其不方便的说</p>
<p>首先从ubuntu进入&#x2F;boot&#x2F;efi&#x2F;EFI<br><strong>备份windwos的启动文件</strong>（<strong>切记一定要备份，否则只能从pe重新建立windwos启动项</strong>）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp -arf Microsoft win10</span><br></pre></td></tr></table></figure>

<p>将ubuntu的grubx64.efi替换掉EFI&#x2F;Microsoft&#x2F;Boot&#x2F;bootmgfw.efi文件 <a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp -arf ubuntu/grubx64.efi Microsoft/Boot/bootmgfw.efi</span><br></pre></td></tr></table></figure>

<p>这样替换之后grub就接管了系统的启动</p>
<p>然后将&#x2F;boot&#x2F;grub&#x2F;grub.cfg中关于windows的启动段复制到&#x2F;etc&#x2F;grub.d&#x2F;40_custom中<br>将<strong>chainloader &#x2F;EFI&#x2F;Micorosoft&#x2F;Boot&#x2F;bootmgfw.efi</strong><br>改为<br><strong>chainloader &#x2F;EFI&#x2F;win10&#x2F;Boot&#x2F;bootmgfw.efi</strong><br>就是把中间那个改为你备份的文件夹，可以改一改前面的启动名称<br>最后执行update-grub来更新启动项</p>
<p>但是windwos有大更新的时候会把更改的覆盖掉，再来一遍就好了</p>
<p><span id="jump"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/efi.jpg"></span></p>
<p>参考文章<a href="https://blog.csdn.net/zyix_0712/article/details/69675748" target="_blank" rel="noopener">暗影精灵2pro安装win10+ubuntu16.10双系统</a></p>
]]></content>
      <categories>
        <category>Computer</category>
      </categories>
      <tags>
        <tag>EFI</tag>
        <tag>BIOS</tag>
      </tags>
  </entry>
  <entry>
    <title>更改绑定手机号</title>
    <url>/posts/3fee5f2/</url>
    <content><![CDATA[<p>绑定手机号：微信，网易云，淘宝原手机号及证件，支付宝，google<br>银行卡，贴吧，酷安，微博需要原手机号，bilibili（需要原手机号)<a id="more"></a><br>微软,欢喜云，京东（原手机号及银行卡，非我的实名认证）<br>天猫，银行卡，steam，小冰，yy(需要原手机号)<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/%E6%8D%95%E8%8E%B72.PNG"></p>
]]></content>
      <categories>
        <category>Personally</category>
      </categories>
      <tags>
        <tag>Personally</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言学习</title>
    <url>/posts/4f95e9f6/</url>
    <content><![CDATA[<p>最近想了解一下c是如何编译为汇编语言的<br>首先写了一个相当简单的c</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = a + b;</span><br><span class="line">    <span class="keyword">int</span> d = <span class="number">3</span> + <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>,c,d);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>gcc -S</code>编译为汇编语言:</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="meta">	.file</span>	<span class="string">"hello.c"</span></span><br><span class="line"><span class="meta">	.text</span></span><br><span class="line"><span class="meta">	.section</span>	.rodata</span><br><span class="line"><span class="symbol">.LC0:</span></span><br><span class="line"><span class="meta">	.string</span>	<span class="string">"%d %d"</span></span><br><span class="line"><span class="meta">	.text</span></span><br><span class="line"><span class="meta">	.globl</span>	main</span><br><span class="line"><span class="meta">	.type</span>	main, @function</span><br><span class="line"><span class="symbol">main:</span></span><br><span class="line"><span class="symbol">.LFB0:</span></span><br><span class="line"><span class="meta">	.cfi_startproc</span></span><br><span class="line">    pushq	%rbp</span><br><span class="line"><span class="meta">	.cfi_def_cfa_offset</span> <span class="number">16</span></span><br><span class="line"><span class="meta">	.cfi_offset</span> <span class="number">6</span>, -<span class="number">16</span></span><br><span class="line">    <span class="keyword">movq</span>	%rsp, %rbp</span><br><span class="line"><span class="meta">	.cfi_def_cfa_register</span> <span class="number">6</span></span><br><span class="line">    subq	<span class="number">$16</span>, %rsp</span><br><span class="line">    movl	<span class="number">$1</span>, -<span class="number">16</span>(%rbp)</span><br><span class="line">    movl	<span class="number">$2</span>, -<span class="number">12</span>(%rbp)</span><br><span class="line">    movl	-<span class="number">16</span>(%rbp), %edx</span><br><span class="line">    movl	-<span class="number">12</span>(%rbp), %eax</span><br><span class="line">    addl	%edx, %eax</span><br><span class="line">    movl	%eax, -<span class="number">8</span>(%rbp)</span><br><span class="line">    movl	<span class="number">$7</span>, -<span class="number">4</span>(%rbp)</span><br><span class="line">    movl	-<span class="number">4</span>(%rbp), %edx</span><br><span class="line">    movl	-<span class="number">8</span>(%rbp), %eax</span><br><span class="line">    movl	%eax, %esi</span><br><span class="line">    leaq	.LC0(%rip), %rdi</span><br><span class="line">    movl	<span class="number">$0</span>, %eax</span><br><span class="line">    <span class="keyword">call</span>	printf@PLT</span><br><span class="line">    movl	<span class="number">$0</span>, %eax</span><br><span class="line">    <span class="keyword">leave</span></span><br><span class="line"><span class="meta">	.cfi_def_cfa</span> <span class="number">7</span>, <span class="number">8</span></span><br><span class="line">    <span class="keyword">ret</span></span><br><span class="line"><span class="meta">	.cfi_endproc</span></span><br><span class="line"><span class="symbol">.LFE0:</span></span><br><span class="line"><span class="meta">	.size</span>	main, .-main</span><br><span class="line"><span class="meta">	.ident</span>	<span class="string">"GCC: (GNU) 9.1.0"</span></span><br><span class="line"><span class="meta">	.section</span>	.note<span class="number">.</span>GNU-stack,<span class="string">""</span>,@progbits</span><br></pre></td></tr></table></figure>

<p>以”点”做为前缀的指令都是用来指导汇编器的命令。<br>精简一下差不多这样:<a id="more"></a></p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">.LC0:</span></span><br><span class="line"><span class="meta"> .string</span>	<span class="string">"%d %d"</span></span><br><span class="line"><span class="meta"> .text</span></span><br><span class="line"><span class="meta"> .globl</span>	main</span><br><span class="line"><span class="meta"> .type</span>	main, @function</span><br><span class="line"></span><br><span class="line"><span class="symbol">main:</span></span><br><span class="line"> pushq	%rbp</span><br><span class="line"> <span class="keyword">movq</span>	%rsp, %rbp</span><br><span class="line"> movl	<span class="number">$1</span>, -<span class="number">16</span>(%rbp)</span><br><span class="line"> movl	<span class="number">$2</span>, -<span class="number">12</span>(%rbp)</span><br><span class="line"> movl	-<span class="number">16</span>(%rbp), %edx</span><br><span class="line"> movl	-<span class="number">12</span>(%rbp), %eax</span><br><span class="line"> addl	%edx, %eax</span><br><span class="line"> movl	%eax, -<span class="number">8</span>(%rbp)</span><br><span class="line"> movl	<span class="number">$7</span>, -<span class="number">4</span>(%rbp)</span><br><span class="line"> movl	-<span class="number">4</span>(%rbp), %edx</span><br><span class="line"> movl	-<span class="number">8</span>(%rbp), %eax</span><br><span class="line"> movl	%eax, %esi</span><br><span class="line"> leaq	.LC0(%rip), %rdi</span><br><span class="line"> movl	<span class="number">$0</span>, %eax</span><br><span class="line"> <span class="keyword">call</span>	printf@PLT</span><br><span class="line"> movl	<span class="number">$0</span>, %eax</span><br><span class="line"> <span class="keyword">leave</span></span><br><span class="line"> <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<p>首先了解一下几个寄存器<sup><a href="#1"><font color="red">[1]</font></a></sup></p>
<ul>
<li>%rbp 是栈帧指针，用于标识当前栈帧的起始位置</li>
<li>%rsp 是堆栈指针寄存器，通常会指向栈顶位置，堆栈的 pop 和push 操作就是通过改变 %rsp 的值即移动堆栈指针的位置来实现的。</li>
<li>%eax 是”累加器”(accumulator), 它是很多加法乘法指令的缺省寄存器。</li>
<li>%edx 则总是被用来放整数除法产生的余数。</li>
<li>%rip 指令地址寄存器，用来存储 CPU 即将要执行的指令地址。每次 CPU 执行完相应的汇编指令之后，rip 寄存器的值就会自行累加；rip 无法直接赋值，call, ret, jmp 等指令可以修改 rip。</li>
<li>%rdi，%rsi，%rdx，%rcx，%r8，%r9 用作函数参数，依次对应第1参数，第2参数。</li>
<li>ESI&#x2F;EDI 分别叫做”源&#x2F;目标索引寄存器”(source&#x2F;destination index),因为在很多字符串操作指令中, DS:ESI指向源串,而ES:EDI指向目标串.</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">pushq	%rbp</span><br><span class="line"><span class="keyword">movq</span>	%rsp, %rbp</span><br><span class="line">确认栈</span><br></pre></td></tr></table></figure>

<p><code>movl	$1, -16(%rbp)</code> 把1移入寄存器rbq中-16是地址起始位置<br><code>movl	$2, -12(%rbp)</code> 跟上面相同<br><code>movl	-16(%rbp), %edx</code> 把<code>-16(%rbp)</code>移入寄存器edx中,上面可知就是把1移入edx中<br><code>movl	-12(%rbp), %eax</code> 跟上面类似 不过这次用的是寄存器eax<br><code>addl	%edx, %eax</code> 把edx和eax中的内容相加,并存入edx中<br><code>movl	%eax, -8(%rbp)</code> 把eax中的内容存入rbq中位置为-8<br><code>movl	$7, -4(%rbp)</code> 把7存入rbq位置为-4,对应c代码为<code>int d = 3 + 4</code>,由此可知编译器在编译时其实是会进行相应优化的<br><code>.LC0(%rip)</code>は、printfが使うアドレス、前もってprintfで使用する書式を設定している(就是说设置printf使用的地址,并提前设置格式)<sup><a href="#2"><font color="red">[2]</font></a></sup><br><code>call	printf@PLT</code> 调用printf<br> <code>leave</code> 离开printf<br><code>ret</code>:结束当前函数</p>
<hr>
<p>接下来我们可以简单的实战一下:<br>给gcc开启O3级别的优化:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -O3 -S</span><br></pre></td></tr></table></figure>

<p>生成的汇编码:</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="meta">	.file</span>	<span class="string">"hello.c"</span></span><br><span class="line"><span class="meta">	.text</span></span><br><span class="line"><span class="meta">	.section</span>	.rodata<span class="number">.</span>str1<span class="number">.1</span>,<span class="string">"aMS"</span>,@progbits,<span class="number">1</span></span><br><span class="line"><span class="symbol">.LC0:</span></span><br><span class="line"><span class="meta">	.string</span>	<span class="string">"%d %d"</span></span><br><span class="line"><span class="meta">	.section</span>	.text<span class="number">.</span>startup,<span class="string">"ax"</span>,@progbits</span><br><span class="line"><span class="meta">	.p2align</span> <span class="number">4</span></span><br><span class="line"><span class="meta">	.globl</span>	main</span><br><span class="line"><span class="meta">	.type</span>	main, @function</span><br><span class="line"><span class="symbol">main:</span></span><br><span class="line"><span class="symbol">.LFB11:</span></span><br><span class="line"><span class="meta">	.cfi_startproc</span></span><br><span class="line">    subq	<span class="number">$8</span>, %rsp</span><br><span class="line"><span class="meta">	.cfi_def_cfa_offset</span> <span class="number">16</span></span><br><span class="line">    movl	<span class="number">$7</span>, %edx</span><br><span class="line">    movl	<span class="number">$3</span>, %esi</span><br><span class="line">    xorl	%eax, %eax</span><br><span class="line">    leaq	.LC0(%rip), %rdi</span><br><span class="line">    <span class="keyword">call</span>	printf@PLT</span><br><span class="line">    xorl	%eax, %eax</span><br><span class="line">    addq	<span class="number">$8</span>, %rsp</span><br><span class="line"><span class="meta">	.cfi_def_cfa_offset</span> <span class="number">8</span></span><br><span class="line">    <span class="keyword">ret</span></span><br><span class="line"><span class="meta">	.cfi_endproc</span></span><br><span class="line"><span class="symbol">.LFE11:</span></span><br><span class="line"><span class="meta">	.size</span>	main, .-main</span><br><span class="line"><span class="meta">	.ident</span>	<span class="string">"GCC: (GNU) 9.1.0"</span></span><br><span class="line"><span class="meta">	.section</span>	.note<span class="number">.</span>GNU-stack,<span class="string">""</span>,@progbits</span><br></pre></td></tr></table></figure>

<p>从以上汇编代码中我们可以发现,优化之后的汇编代码将最后相加的值给了内存,而不像之前那样先占用两个内存空间然后再相加.</p>
<hr>
<blockquote>
<p>[1] <a id="1"><a href="https://zhuanlan.zhihu.com/p/27339191" target="_blank" rel="noopener">x86-64 下函数调用及栈帧原理</a></a><br>[2] <a id="2"><a href="https://qiita.com/diggy-mo/items/fe56f6ea357e5928a8ca" target="_blank" rel="noopener">アセンブラ学習log_1</a></a></p>
</blockquote>
]]></content>
      <categories>
        <category>assembly</category>
      </categories>
      <tags>
        <tag>汇编语言</tag>
        <tag>assembly</tag>
      </tags>
  </entry>
  <entry>
    <title>深度学习</title>
    <url>/posts/33115a55/</url>
    <content><![CDATA[<p><strong>如果以下的表格及图像出现格式问题,请将你的浏览器中文字体的等宽字体设置好</strong></p>
<h2 id="一-预处理"><a href="#一-预处理" class="headerlink" title="一.预处理"></a>一.预处理</h2><h3 id="提取特征量"><a href="#提取特征量" class="headerlink" title="提取特征量"></a>提取特征量</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Human created algorithm: 人想到的算法</span><br><span class="line">         +-----------------------+</span><br><span class="line"><span class="meta">-------&gt;</span><span class="bash"> |Human created algorithm| --------&gt; 答案</span></span><br><span class="line">         +-----------------------+</span><br><span class="line"></span><br><span class="line">Human created Feature quantity: 人想到的特征量</span><br><span class="line">      +------------------------------------------+       +---------------------------+</span><br><span class="line"><span class="meta">----&gt;</span><span class="bash"> |Human created Feature quantity(SIF,HGD...)| ----&gt; |Machine learning(svm,knn..)| ---&gt; 答案</span></span><br><span class="line">      +------------------------------------------+       +---------------------------+</span><br><span class="line"></span><br><span class="line">Feature quantity find by computer: 计算机自动寻找特征量</span><br><span class="line">         +-----------------------------------+</span><br><span class="line">         |        Neural Networks            |</span><br><span class="line"><span class="meta">-------&gt;</span><span class="bash"> |      (Machine learning)           | --------&gt; 答案</span></span><br><span class="line">         | Feature quantity find by computer |</span><br><span class="line">         +-----------------------------------+</span><br></pre></td></tr></table></figure>

<h3 id="Hyper-Parameter"><a href="#Hyper-Parameter" class="headerlink" title="Hyper-Parameter"></a>Hyper-Parameter</h3><ol>
<li>设定超参数的范围</li>
<li>从设定的超参数的范围中随机采样</li>
<li>使用步骤1中采样到的超参数的值进行学习,通过验证数据,评估识别精度(要将epoch设置得很小)</li>
<li>重复步骤1和步骤2,根据他们的识别精度的结果缩小超参数的范围</li>
</ol>
<blockquote>
<p>超参数优化参考:贝叶斯最优化</p>
</blockquote>
<h4 id="权重"><a href="#权重" class="headerlink" title="权重"></a>权重</h4><p>权重的初始值:不应该设置为0&#x2F;1(设置为0或1,可能造成梯度消失),应选择随机生成初始值  </p>
<blockquote>
<p>其他权重初始值: He初始值</p>
</blockquote>
<h4 id="输出层"><a href="#输出层" class="headerlink" title="输出层"></a>输出层</h4><p>输出层的神经数量需要根据待解决的问题来决定,如:对于分类问题,输出层的神经元数量一般设定为类别的数量.</p>
<a id="more"></a>
<h2 id="二-激活函数"><a href="#二-激活函数" class="headerlink" title="二.激活函数"></a>二.激活函数</h2><p>激活函数用来决定如何来激活(处理)输入的信号.<br>如:<br>感知器<br>$ a &#x3D; b + w_1x_1 + w_2x_2 $</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">signal : 输入的信号</span><br><span class="line">Biasing: 偏置</span><br><span class="line">Weight : 权重</span><br><span class="line"></span><br><span class="line">+-----+---------+</span><br><span class="line">|x1 x2| Signal  |</span><br><span class="line">+-----+---------+</span><br><span class="line">|  b  | Biasing |</span><br><span class="line">+-----+---------+</span><br><span class="line">|w1 w2| Weight  |</span><br><span class="line">+-----+---------+</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">    b   +--------------------+</span><br><span class="line"><span class="meta"> 1----&gt;</span><span class="bash"> |                    |</span></span><br><span class="line">        | +---+  h()  +---+  |</span><br><span class="line">   w1   | | a | ----&gt; | y |  |</span><br><span class="line"><span class="meta">x1----&gt;</span><span class="bash"> | +---+       +---+  |</span></span><br><span class="line">        |                    |</span><br><span class="line">   w2   |                    |</span><br><span class="line"><span class="meta">x2----&gt;</span><span class="bash"> |                    |</span></span><br><span class="line">        +--------------------+</span><br></pre></td></tr></table></figure>

<h3 id="sigmoid函数"><a href="#sigmoid函数" class="headerlink" title="sigmoid函数"></a>sigmoid函数</h3><p>$ h(x) &#x3D; \frac{1}{1+exp(-1)} $</p>
<h3 id="阶越函数"><a href="#阶越函数" class="headerlink" title="阶越函数"></a>阶越函数</h3><p>在数学中，如果实数域上的某个函数可以用半开区间上的指示函数的有限次线性组合来表示，那么这个函数就是阶跃函数，或者叫赫维赛德函数。换一种不太正式的说法就是，阶跃函数是有限段分段常数函数的组合。</p>
<h3 id="ReLV-Rectified-Linear-Vnit-函数"><a href="#ReLV-Rectified-Linear-Vnit-函数" class="headerlink" title="ReLV(Rectified Linear Vnit)函数"></a>ReLV(Rectified Linear Vnit)函数</h3><p>$f(x)&#x3D;<br>\begin{cases}<br>x&amp; \text{x &gt; 0}\<br>0&amp; \text{x &lt;&#x3D; 0}<br>\end{cases}$<br>由于hexo渲染器的问题,此处公式本来应该为两行,如下:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">        +- x (x&gt;0)</span><br><span class="line">f(x) =  |</span><br><span class="line">        +- 0 (x&lt;=0)</span><br></pre></td></tr></table></figure>

<h2 id="三-损失函数"><a href="#三-损失函数" class="headerlink" title="三.损失函数"></a>三.损失函数</h2><p>表示神经网络性能的”恶劣程度”的指标,及当前的升级网络对监督数据在多大程度上不拟合,在多大程度上不一致.</p>
<h3 id="均方误差"><a href="#均方误差" class="headerlink" title="均方误差"></a>均方误差</h3><p>$E &#x3D; \frac{1}{2} \sum_k (y_k - t_k)^2 $<br>$k$: 数据的维度<br>$y_k$: 神经网络的输出<br>$t_k$: 监督数据</p>
<h3 id="交叉熵误差"><a href="#交叉熵误差" class="headerlink" title="交叉熵误差"></a>交叉熵误差</h3><p>$E &#x3D; - \sum_k t_k \log y_k $<br>$k$: 数据的维度<br>$y_k$: 神经网络的输出<br>$t_k$: 监督数据</p>
<h2 id="四-网络层"><a href="#四-网络层" class="headerlink" title="四.网络层"></a>四.网络层</h2><h3 id="sigmoid层"><a href="#sigmoid层" class="headerlink" title="sigmoid层"></a>sigmoid层</h3><p>$ y &#x3D; \frac{1}{1+exp(-1)} $</p>
<h3 id="Affine层-仿射变换"><a href="#Affine层-仿射变换" class="headerlink" title="Affine层(仿射变换)"></a>Affine层(仿射变换)</h3><p>仿射变换包括一次线性变换和一次平移变换,分别对应神经网络的加权和运算与加偏置运算</p>
<h3 id="Convolutional-Neural-Network-卷积神经网络-CNN"><a href="#Convolutional-Neural-Network-卷积神经网络-CNN" class="headerlink" title="Convolutional Neural Network(卷积神经网络,CNN)"></a>Convolutional Neural Network(卷积神经网络,CNN)</h3><h4 id="卷积层"><a href="#卷积层" class="headerlink" title="卷积层"></a>卷积层</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">                       滤波器(相当于权重)                     偏置</span><br><span class="line">+---+---+---+---+</span><br><span class="line">| 1 | 2 | 3 | 0 |       +---+---+---+</span><br><span class="line">+---+---+---+---+       | 2 | 0 | 1 |         +---+---+                 +---+---+</span><br><span class="line">| 0 | 1 | 2 | 3 |       +---+---+---+         |15 | 16|    +---+        |18 | 19|</span><br><span class="line">+---+---+---+---+   ⨀   | 0 | 1 | 2 |  ----&gt;  +---+---+  + | 3 |   ---&gt; +---+---+</span><br><span class="line">| 3 | 0 | 1 | 2 |       +---+---+---+         | 6 | 15|    +---+        | 9 | 18|</span><br><span class="line">+---+---+---+---+       | 1 | 0 | 2 |         +---+---+                 +---+---+</span><br><span class="line">| 2 | 4 | 0 | 1 |       +---+---+---+</span><br><span class="line">+---+---+---+---+</span><br></pre></td></tr></table></figure>

<p>$O_H &#x3D; \frac{H+2P-F_H}{S} + 1$<br>$O_W &#x3D; \frac{W+2P-F_W}{S} + 1$<br>输出大小: $O_H,O_W$<br>滤波器大小: $F_H,F_W$<br>填充大小: $P$ , 调整输出大小为相同大小的矩阵<br>步幅: $S$ , 应用滤波器的间隔  </p>
<h4 id="池化层-缩小高长方向上的空间的运算-提高鲁棒性"><a href="#池化层-缩小高长方向上的空间的运算-提高鲁棒性" class="headerlink" title="池化层(缩小高长方向上的空间的运算,提高鲁棒性)"></a>池化层(缩小高长方向上的空间的运算,提高鲁棒性)</h4><p>如:max池</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">                  Max池</span><br><span class="line">+---+---+---+---+</span><br><span class="line">| 1 | 2 | 1 | 0 |</span><br><span class="line">+---+---+---+---+             +---+---+</span><br><span class="line">| 0 | 1 | 2 | 3 |     Max     | 2 | 3 |</span><br><span class="line">+---+---+---+---+  -------&gt;   +---+---+</span><br><span class="line">| 3 | 0 | 1 | 2 |             | 4 | 2 |</span><br><span class="line">+---+---+---+---+             +---+---+</span><br><span class="line">| 2 | 4 | 0 | 1 |</span><br><span class="line">+---+---+---+---+</span><br></pre></td></tr></table></figure>

<h4 id="全连接层"><a href="#全连接层" class="headerlink" title="全连接层"></a>全连接层</h4><p>全连接层就是一般的激活函数,在tensorflow也是Dense,放在卷积层和池化层之后进行数据的处理</p>
<h4 id="CNN代表网络"><a href="#CNN代表网络" class="headerlink" title="CNN代表网络"></a>CNN代表网络</h4><h5 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h5><p>激活函数: sigmoid<br>池化方法: 子采样  </p>
<h5 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h5><p>激活函数: ReLV<br>局部正规化 LRN(Local Response Normalization)并使用Dropout  </p>
<h2 id="五-优化函数"><a href="#五-优化函数" class="headerlink" title="五.优化函数"></a>五.优化函数</h2><h3 id="梯度下降法"><a href="#梯度下降法" class="headerlink" title="梯度下降法"></a>梯度下降法</h3><ul>
<li>导数: 使用数值微分近似替代导数</li>
<li>偏导数: 与导数相同</li>
<li>梯度: 由全部变量的偏导数汇总而成的向量称为梯度,方向向量变化最快的地方,方向向量的导数.<br>  如:$ (\frac{\gamma_f}{\gamma_{x_0}},\frac{\gamma_f}{\gamma_{x_1}}) $</li>
<li>负梯度方向: 是梯度法中变量更新的方向,梯度指示的方向是各点处的函数值减少量最多的方向.</li>
<li>步骤<ol>
<li>mini-batch</li>
<li>计算梯度: 求出各个权重参数的梯度</li>
<li>更新参数: 将权重沿梯度方向进行微小更新</li>
<li>重复: 重复步骤1,2,3</li>
</ol>
</li>
</ul>
<h4 id="BGD-批量梯度下降法"><a href="#BGD-批量梯度下降法" class="headerlink" title="BGD(批量梯度下降法)"></a>BGD(批量梯度下降法)</h4><p>是梯度下降法的其中一种</p>
<h4 id="SGD-随机梯度下降法"><a href="#SGD-随机梯度下降法" class="headerlink" title="SGD(随机梯度下降法)"></a>SGD(随机梯度下降法)</h4><p>是梯度下降法的其中一种<br>随机梯度下降是通过每个样本来迭代更新一次，对比上面的批量梯度下降，迭代一次需要用到所有训练样本</p>
<h4 id="M-BGD-min-batch-小批量梯度下降法"><a href="#M-BGD-min-batch-小批量梯度下降法" class="headerlink" title="M-BGD(min-batch 小批量梯度下降法)"></a>M-BGD(min-batch 小批量梯度下降法)</h4><p>min-batch: 在所有数据中,随机选取一部分数据</p>
<h3 id="Momentum"><a href="#Momentum" class="headerlink" title="Momentum"></a>Momentum</h3><p>$ v \leftarrow \alpha{v} - \eta{\frac{\gamma_L}{\gamma_W}} $<br>$ W \leftarrow W + v $<br>$W$: 权重<br>$\frac{\gamma_L}{\gamma_W}$: 损失函数关于W的梯度<br>$\eta$: 学习率<br>$v$: 速度</p>
<h3 id="AdaGrad"><a href="#AdaGrad" class="headerlink" title="AdaGrad"></a>AdaGrad</h3><p>为参数的每个元素适当的调整学习率<br>learning rate decay:学习率衰减的方法,一开始”多”学,然后逐渐少学<br>$h \leftarrow h + \frac{\gamma_L}{\gamma_W} \bigodot \frac{\gamma_L}{\gamma_W}$<br>$W \leftarrow W - \eta{\frac{1}{\sqrt h}}{\frac{\gamma_L}{\gamma_W}}$<br>$\bigodot$: 表示对立矩阵元素的乘法<br>$W$: 权重参数<br>$\frac{\gamma_L}{\gamma_W}$: 损失函数关于W的梯度<br>$\eta$: 学习率  </p>
<h3 id="Adam-融合AdaGrad和Momentum"><a href="#Adam-融合AdaGrad和Momentum" class="headerlink" title="Adam(融合AdaGrad和Momentum)"></a>Adam(融合AdaGrad和Momentum)</h3><p>具体内容请查看原论文</p>
<h3 id="抑制过拟合"><a href="#抑制过拟合" class="headerlink" title="抑制过拟合"></a>抑制过拟合</h3><h3 id="softMax层"><a href="#softMax层" class="headerlink" title="softMax层"></a>softMax层</h3><p>softMax层是把输入值正规化后再输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">        +---+</span><br><span class="line">5.3 --&gt; | s | --&gt; 0.008</span><br><span class="line">0.3 --&gt; | o | --&gt; 0.00005</span><br><span class="line">10.1--&gt; | f | --&gt; 0.991</span><br><span class="line">   .    | t |  .</span><br><span class="line">   .    | m |  .</span><br><span class="line">   .    | a |  .</span><br><span class="line">   .    | x |  .</span><br><span class="line">0.01--&gt; |   | --&gt; 0.00004</span><br><span class="line">        +---+</span><br></pre></td></tr></table></figure>

<h4 id="batch-normalization-批量正则化"><a href="#batch-normalization-批量正则化" class="headerlink" title="batch normalization(批量正则化)"></a>batch normalization(批量正则化)</h4><h5 id="正则化"><a href="#正则化" class="headerlink" title="正则化"></a>正则化</h5><p>$\mu_B \leftarrow {\frac{1}{m}}{\sum_{i&#x3D;1}^m}{x_i}$<br>$\sigma^2_B \leftarrow {\frac{1}{m}}{\sum_{i&#x3D;1}^m}{(x_i-\mu_B)^2}$<br>$\hat{x}_i \leftarrow \frac{x_i-\mu_B}{\sqrt {\sigma^2_B + \varepsilon}}$<br>$\mu_B$: 均值<br>$\sigma^2_B$: 方差<br>进行缩放和平移: $y_i \leftarrow \gamma \hat{x}_i + \beta$ ($\gamma$和$\beta$为参数,初值为1和0)</p>
<p>正则化步骤:</p>
<ol>
<li>权值衰减(抑制过拟合): 为损失函数加上${\frac{1}{2}}{\lambda}{W^2}$ ($\lambda$:控制正则化强度的超参数 W:权重)  </li>
<li>Dropout:在学习过程中随机删除神经元的方法</li>
</ol>
<h2 id="六-整个训练过程"><a href="#六-整个训练过程" class="headerlink" title="六.整个训练过程"></a>六.整个训练过程</h2><ol>
<li>初始化<ul>
<li>网络初始化</li>
<li>优化器初始化</li>
</ul>
</li>
<li>mini-batch</li>
<li>计算梯度 -&gt; 更新梯度 -&gt; 优化梯度</li>
<li>获取损失函数</li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>深度学习之感知器的实现</title>
    <url>/posts/64e69c3e/</url>
    <content><![CDATA[<p>感知器的一个公式:<br>  <strong>当 wx+b&gt;0 , f(x)&#x3D;1,否则f(x)&#x3D;0</strong></p>
<ul>
<li>x输入的向量  </li>
<li>w:是权重  </li>
<li>w*x是点积  </li>
<li>b是偏置(与权重类似,偏置可以认为是激励函数的偏移量，或者给神经元一个基础活跃等级。)</li>
</ul>
<p>对权重的调整公式,此处使用了梯度下降的方法: <strong>w&#x3D;w+i*(t-count)*x</strong>  </p>
<ul>
<li>i是一个常数,i越小感知器学习越精确,当然耗费时间也最长  </li>
<li>t:本应该得到的值  </li>
<li>count:实际计算得到的值  </li>
<li>x:同上</li>
</ul>
<p>对偏置调整的公式: <em><em>b&#x3D;b+i</em>(t-count)</em>*</p>
<p>这次我们使用python来实现与和或<a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#因为与和或计算需要输入两个数,所以这里设置两个权重</span><br><span class="line">global w1,w2</span><br><span class="line">w1=0.4</span><br><span class="line">w2=0.6</span><br><span class="line">#偏置随便设一个</span><br><span class="line">global b</span><br><span class="line">b=0.8</span><br><span class="line">#上面提到的常数</span><br><span class="line">global i</span><br><span class="line">i=0.01</span><br></pre></td></tr></table></figure>

<p>对感知器公式实现的函数:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def count(x,y):</span><br><span class="line">    if w1*x+w2*y+b&gt;0:</span><br><span class="line">        return 1</span><br><span class="line">    else:</span><br><span class="line">        return 0</span><br></pre></td></tr></table></figure>

<p>对权重和偏置不断矫正的函数:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def update_all(r,x,y):</span><br><span class="line">    global w1,w2,b</span><br><span class="line">    temp = count(x,y)</span><br><span class="line">    w1=w1+i*(r-temp)*x</span><br><span class="line">    w2=w2+i*(r-temp)*y</span><br><span class="line">    b=b+i*(r-temp)</span><br><span class="line">    print(w1,w2,b)</span><br></pre></td></tr></table></figure>

<p>最后就是输入学习的资料和确认计算结果:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def main():</span><br><span class="line">    for _ in range(1,50):</span><br><span class="line">        update_all(1.0,1.0,1.0)</span><br><span class="line">        update_all(0.0,1.0,0.0)</span><br><span class="line">        update_all(0.0,0.0,1.0)</span><br><span class="line">        update_all(0.0,0.0,0.0)</span><br><span class="line">    </span><br><span class="line">    print(&apos;1 and 1 =&apos;,count(1,1))</span><br><span class="line">    print(&apos;0 and 1 =&apos;,count(0,1))</span><br><span class="line">    print(&apos;1 and 0 =&apos;,count(1,0))</span><br><span class="line">    print(&apos;0 and 0 =&apos;,count(0,0))</span><br></pre></td></tr></table></figure>

<p>这里我们先进行与的计算:<br>这里我前面代码写错了,所以说下面所有的结果会不一样…..<br>进行25次学习的结果:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0.4, 0.6, 0.8)</span><br><span class="line">(0.39, 0.6, 0.79)</span><br><span class="line">(0.39, 0.59, 0.78)</span><br><span class="line">(0.39, 0.59, 0.77)</span><br><span class="line">(0.39, 0.59, 0.77)</span><br><span class="line">.......省略........</span><br><span class="line">(0.1599999999999998, 0.35999999999999976, 0.08999999999999947)</span><br><span class="line">(0.1599999999999998, 0.35999999999999976, 0.07999999999999947)</span><br><span class="line">(&apos;1 and 1 =&apos;, 1)</span><br><span class="line">(&apos;0 and 1 =&apos;, 1)</span><br><span class="line">(&apos;1 and 0 =&apos;, 1)</span><br><span class="line">(&apos;0 and 0 =&apos;, 1)</span><br></pre></td></tr></table></figure>

<p>这里我们明显发现结果是错误的,提升到50次:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0.4, 0.6, 0.8)</span><br><span class="line">(0.39, 0.6, 0.79)</span><br><span class="line">(0.39, 0.59, 0.78)</span><br><span class="line">(0.39, 0.59, 0.77)</span><br><span class="line">(0.39, 0.59, 0.77)</span><br><span class="line">(0.38, 0.59, 0.76)</span><br><span class="line">(0.38, 0.58, 0.75)</span><br><span class="line">.......省略........</span><br><span class="line">(0.07999999999999981, 0.1799999999999996, -0.18000000000000055)</span><br><span class="line">(0.07999999999999981, 0.1799999999999996, -0.18000000000000055)</span><br><span class="line">(0.07999999999999981, 0.1799999999999996, -0.18000000000000055)</span><br><span class="line">(&apos;1 and 1 =&apos;, 1)</span><br><span class="line">(&apos;0 and 1 =&apos;, 0)</span><br><span class="line">(&apos;1 and 0 =&apos;, 0)</span><br><span class="line">(&apos;0 and 0 =&apos;, 0)</span><br></pre></td></tr></table></figure>

<p>结果正确了,并且权重和偏置都稳定到一个值,是不是感觉很神奇<br>或运算也是相同的,这里我们将偏置改为b&#x3D;0.4:<br>25次:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.38)</span><br><span class="line">(0.4, 0.6, 0.38)</span><br><span class="line">(0.4, 0.6, 0.38)</span><br><span class="line">.......省略........</span><br><span class="line">(0.4, 0.6, 0.16999999999999982)</span><br><span class="line">(0.4, 0.6, 0.16999999999999982)</span><br><span class="line">(0.4, 0.6, 0.16999999999999982)</span><br><span class="line">(0.4, 0.6, 0.16999999999999982)</span><br><span class="line">(0.4, 0.6, 0.1599999999999998)</span><br><span class="line">(&apos;1 and 1 =&apos;, 1)</span><br><span class="line">(&apos;0 and 1 =&apos;, 1)</span><br><span class="line">(&apos;1 and 0 =&apos;, 1)</span><br><span class="line">(&apos;0 and 0 =&apos;, 1)</span><br></pre></td></tr></table></figure>

<p>50次:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.4)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.39)</span><br><span class="line">(0.4, 0.6, 0.38)</span><br><span class="line">.......省略........</span><br><span class="line">(0.4, 0.6, -1.97758476261356e-16)</span><br><span class="line">(0.4, 0.6, -1.97758476261356e-16)</span><br><span class="line">(0.4, 0.6, -1.97758476261356e-16)</span><br><span class="line">(0.4, 0.6, -1.97758476261356e-16)</span><br><span class="line">(0.4, 0.6, -1.97758476261356e-16)</span><br><span class="line">(&apos;1 and 1 =&apos;, 1)</span><br><span class="line">(&apos;0 and 1 =&apos;, 1)</span><br><span class="line">(&apos;1 and 0 =&apos;, 1)</span><br><span class="line">(&apos;0 and 0 =&apos;, 0)</span><br></pre></td></tr></table></figure>

<p>参考:<br><a href="https://zh.wikipedia.org/wiki/%E6%84%9F%E7%9F%A5%E5%99%A8" target="_blank" rel="noopener">感知器(维基百科)</a><br><a href="https://www.zybuluo.com/hanbingtao/note/433855" target="_blank" rel="noopener">零基础入门深度学习(1) - 感知器</a>  </p>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>用CIDR表示网段</title>
    <url>/posts/e2b25bb8/</url>
    <content><![CDATA[<p>我们知道一般CIDR(无类别域间路由)网段的表示为:<strong>192.168.0.0&#x2F;24</strong>这种形式</p>
<h2 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h2><p>首先我们得知道ip地址是如何来的<br>ipv4的地址是用32位二进制数表示的<br>如: 255.255.255.0 -&gt; 11111111.11111111.11111111.00000000</p>
<h2 id="网络前缀"><a href="#网络前缀" class="headerlink" title="网络前缀"></a>网络前缀</h2><p><strong>192.168.0.0&#x2F;24</strong>中的24就是网络前缀,网络前缀可转化为网络掩码,24表示网络掩码的前24位为1 </p>
<h2 id="网络掩码"><a href="#网络掩码" class="headerlink" title="网络掩码"></a>网络掩码</h2><p>「网络掩码」又叫「子网掩码」、「地址掩码」、「子網路遮罩」（subnet mask），它是一种用来指明一个IP地址的哪些位标识的是主机所在的网络地址以及哪些位标识的是主机地址的位掩码。      –维基百科<a id="more"></a>  </p>
<p>将网络前缀转化为网络掩码: 24 -&gt; 11111111.11111111.11111111.00000000 -&gt; 255.255.255.0<br><em>255.255.255.0</em>就是网络掩码</p>
<h2 id="CIDR"><a href="#CIDR" class="headerlink" title="CIDR"></a>CIDR</h2><p><em><strong>网络地址的计算方法为ip地址与网络掩码进行’与’运算</strong></em><br>通过上面的计算好的网络掩码可知这个ip地址的前24位是不变的  ,所以<strong>192.168.0.0&#x2F;24</strong>表示的网段为: <strong>192.168.0.0 - 192.168.0.255</strong></p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>CIDR</tag>
        <tag>IP</tag>
      </tags>
  </entry>
  <entry>
    <title>用Android/PC为linux拓展屏幕</title>
    <url>/posts/4f3989f0/</url>
    <content><![CDATA[<h2 id="新建虚拟屏幕"><a href="#新建虚拟屏幕" class="headerlink" title="新建虚拟屏幕"></a>新建虚拟屏幕</h2><p>计算出拓展屏幕所需的信息.比如我想拓展1920x1200 60fps的虚拟屏幕:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gtf 1920 1200 60</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1920x1200 @ 60.00 Hz (GTF) hsync: 74.52 kHz; pclk: 193.16 MHz</span></span><br><span class="line"> Modeline "1920x1200_60.00"  193.16  1920 2048 2256 2592  1200 1201 1204 1242  -HSync +Vsync</span><br></pre></td></tr></table></figure>

<p>使用xrandr添加新的mode,参数就是上面结果<code>Modeline</code>后面那些东西:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --newmode "1920x1200_60.00"  193.16  1920 2048 2256 2592  1200 1201 1204 1242  -HSync +Vsync</span><br></pre></td></tr></table></figure>

<p>使用xrandr查看空闲的接口:</p>
<a id="more"></a>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[ ~ ] xrandr</span><br><span class="line">Screen 0: minimum 8 x 8, current 1920 x 1080, maximum 32767 x 32767</span><br><span class="line">eDP1 connected primary 1920x1080+0+0 (normal left inverted right x axis y axis) 340mm x 190mm</span><br><span class="line">   1920x1080     60.02*+  40.03  </span><br><span class="line">HDMI1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">VIRTUAL1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">HDMI-1-2 disconnected (normal left inverted right x axis y axis)</span><br></pre></td></tr></table></figure>

<p>比如我目前在使用的屏幕是eDP1,下面都为空闲,如果有虚拟的就用虚拟的,没有虚拟的用HDMI的也行:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --addmode VIRTUAL1 1920x1200_60.00</span><br></pre></td></tr></table></figure>

<p>拓展屏幕到左面:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --output VIRTUAL1 --mode 1920x1200_60.00 --left-of eDP1 # &lt;- 这里也可以使用--right-of,就是拓展到左边.</span><br></pre></td></tr></table></figure>

<p>目前为止我们已经创建好了一个虚拟屏幕.  </p>
<p>如果想删除上面新建的东西,可以使用下面的指令(注意相关参数换成自己的)或者直接重启电脑就好了.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xrandr --output VIRTUAL1 --off</span><br><span class="line">xrandr --delmode VIRTUAL1 1920x1200_60.00</span><br><span class="line">xrndr --rmmode 1920x1200_60.00</span><br></pre></td></tr></table></figure>

<h2 id="连接屏幕"><a href="#连接屏幕" class="headerlink" title="连接屏幕"></a>连接屏幕</h2><p>连接屏幕可以用teamviewer或者x11vnc,以及各种远程控制电脑的软件,这里我更建议使用teamviewer,更流畅,而且方法简单.</p>
<h3 id="x11vnc"><a href="#x11vnc" class="headerlink" title="x11vnc"></a>x11vnc</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">x11vnc -clip 1920x1200+0+0 # &lt;-这里的两个0,分别是开始剪切的x和y的坐标,如果你拓展到了右边,这里就要加上相应的大小.</span><br></pre></td></tr></table></figure>

<p>然后使用安卓上的连接vnc的软件即可,默认端口是5900.</p>
<h2 id="使用usb加快传输速度"><a href="#使用usb加快传输速度" class="headerlink" title="使用usb加快传输速度"></a>使用usb加快传输速度</h2><p>把手机用usb连接到电脑上,然后用adb连接.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>

<h3 id="x11vnc-1"><a href="#x11vnc-1" class="headerlink" title="x11vnc"></a>x11vnc</h3><p>这个的默认端口是5900,将电脑端口映射到android上.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb reverse tcp:5900 tcp:5900</span><br></pre></td></tr></table></figure>

<p>然后手机上直接连接127.0.0.1:5900就可以</p>
<h3 id="teamviewer"><a href="#teamviewer" class="headerlink" title="teamviewer"></a>teamviewer</h3><p>到teamviewer官网查询,可以知道默认端口为:</p>
<blockquote>
<p>TCP &#x2F; UDP端口5938<br>TCP端口443<br>TCP端口80  </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adb reverse tcp:5938 tcp:5938</span><br></pre></td></tr></table></figure>

<p>后面的443和80也可做映射,不过我这里就使用了5938就成功了.<br>然后手机上的teamviewer连接127.0.0.1就可以了.  </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://sangams.com.np/using-android-pc-as-a-second-monitor-in-linux/" target="_blank" rel="noopener">Using Android&#x2F;PC as a Second Monitor in Linux</a></p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>android</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>离散对数问题</title>
    <url>/posts/1f299eb2/</url>
    <content><![CDATA[<p>前置知识 欧拉, 欧拉定理, 模反元素(模逆元) 可参见: <a href="/posts/f1a158c9/">RSA加密</a></p>
<h2 id="阶"><a href="#阶" class="headerlink" title="阶"></a>阶</h2><p>由欧拉定理可知，若n,a为正整数，且n,a互素（即gcd(a,n)&#x3D;1），则 a^phi(n) &#x3D; 1 (mod n)。<br>因此满足同余式 a^m &#x3D; 1 (mod n)的<strong>最小正整数m</strong>存在，这个m称作a模n的阶，记作delta(n,a)。  </p>
<h2 id="原根"><a href="#原根" class="headerlink" title="原根"></a>原根</h2><p>若n,a为正整数，且n,a互质，如果 gcd(a,n)&#x3D;1 且 delta(n,a) &#x3D; phi(n), 则称a为模n的原根.<br>简单来说，使该式成立的d可能有很多个值，又由欧拉定理可知delta(n,a) &#x3D; phi(n)一定是满足的，如果此时所有delta(n,a)的可能取值中phi(n)是最小的，那么就称a为模n的原根。</p>
<p>eg:</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">a=3, n=7</span><br><span class="line">可知 3,7互质, 所以phi(n) = 7 - 1 = 6</span><br><span class="line">可得 3^6 = 1 (mod 7)</span><br><span class="line"></span><br><span class="line">计算3^1, 3^2, 3^3, 3^4, 3^5 (mod 7) 都不等于1, 所以 6为满足 a^x = 1 (mod n)的最小正整数</span><br><span class="line"></span><br><span class="line">delta(7,3) = 6 = phi(7), 可得 3为模7的原根</span><br></pre></td></tr></table></figure>

<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><a id="more"></a>
<ul>
<li>delta(n,a)一定能整除phi(n)</li>
<li>若一个数m有原根, 则它的原根个数为phi(phi(m))</li>
</ul>
<h2 id="离散对数"><a href="#离散对数" class="headerlink" title="离散对数"></a>离散对数</h2><p>如果对于一个整数b和质数p的一个原根a，可以找到一个唯一的指数i，使得：<br><strong>b&#x3D; a^i (mod p), 其中 0 &lt;&#x3D; i &lt;&#x3D; p-1</strong><br>成立，那么指数i称为b的以a为基数的模p的离散对数。  </p>
<p>离散对数难题是指：<br>当已知一个大质数p和它的一个原根a，如果给定一个b，要计算i的值是相当困难的。<br>常将i作为私钥, b作为公钥，即使知道b和a也无法求出i。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ul>
<li>DH密钥交换</li>
</ul>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">取一质数 7, 计算出其原根 3, 同时质数7和其原根3是公开的</span><br><span class="line"></span><br><span class="line">Alice:</span><br><span class="line"><span class="bullet">  - </span>取一个随机数 3 作为自己的私钥</span><br><span class="line"><span class="bullet">  - </span>计算 3^3 (mod 7) = 6</span><br><span class="line"><span class="bullet">  - </span>将6作为公钥发送给Bob</span><br><span class="line"></span><br><span class="line">Bob:</span><br><span class="line"><span class="bullet">    - </span>取一个随机数 1 作为自己的私钥</span><br><span class="line"><span class="bullet">    - </span>计算 3^1 (mod 7) = 3</span><br><span class="line"><span class="bullet">    - </span>将3作为公钥发送给Alice</span><br><span class="line"></span><br><span class="line">Alice 使用 3 计算出共享密钥 3^3 (mod 7) = 6</span><br><span class="line">Bob 使用 6 计算出共享密钥 6^1 (mod 7) = 6</span><br></pre></td></tr></table></figure>

<ul>
<li>Elgamal加密</li>
</ul>
<p>接上面DH密钥交换</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">获取到公共密钥6之后，Alice和Bob都可以使用公共密钥6来加密信息</span><br><span class="line"></span><br><span class="line">palintext: 6</span><br><span class="line"></span><br><span class="line">加密: 6*6 (mod 7) = 1, 密文为 1</span><br><span class="line">解密: 1*6^-1 (mod 7) = 6 <span class="xml"><span class="tag">&lt;<span class="name">-</span> <span class="attr">6</span>^<span class="attr">-1</span> 是指<span class="attr">6</span>关于模<span class="attr">7</span>的逆元</span></span></span><br></pre></td></tr></table></figure>

<p>上面的写的感觉不太对,完整过程</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Alice 取一质数 7, 计算出其原根 3, 选一数 3 作为自己的私钥, 3^3 (mod 7) = 6</span><br><span class="line">将 &#123;7,3,6&#125; 作为公钥公开</span><br><span class="line"></span><br><span class="line">Bob想传递信息 6 给 Alice</span><br><span class="line"></span><br><span class="line">Bob选一数 5 作为自己的私钥</span><br><span class="line"><span class="bullet"> - </span>加密密钥: 3^5 (mod 7) = 5</span><br><span class="line"><span class="bullet"> - </span>公钥: 3^5 (mod 7) = 5</span><br><span class="line"><span class="bullet"> - </span>密文: 6*(6^5) (mod 7) = 1</span><br><span class="line"><span class="bullet"> - </span>将 (5,1) 作为密文发送给Alice</span><br><span class="line"></span><br><span class="line">Alice解密</span><br><span class="line"><span class="bullet"> - </span>计算解密密钥: 5^3 (mod 7) = 6</span><br><span class="line"><span class="bullet"> - </span>解密: 1 * 6^-1 (mod 7) = 6 <span class="xml"><span class="tag">&lt;<span class="name">-</span> 此处<span class="attr">6</span>^<span class="attr">-1</span>是指<span class="attr">6</span>关于模<span class="attr">7</span>的逆元(模反元素)</span></span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
        <tag>离散对数</tag>
        <tag>DH密钥交换</tag>
        <tag>Elgamal</tag>
      </tags>
  </entry>
  <entry>
    <title>秘密共享</title>
    <url>/posts/ce6c7d90/</url>
    <content><![CDATA[<h2 id="拉格朗日插值法"><a href="#拉格朗日插值法" class="headerlink" title="拉格朗日插值法"></a>拉格朗日插值法</h2><p>对某个多项式函数，已知有给定的k + 1个取值点：<code>(x0,y0)...(xk,yk)</code><br>假设任意两个不同的xj都互不相同，那么应用拉格朗日插值公式所得到的拉格朗日插值多项式为：  </p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">l0 = (((x-x1)(x-x2)...(x-xk))/((x0-x1)(x0-x2)...(x0-xk)))*y0</span><br><span class="line"><span class="code">    ...</span></span><br><span class="line">lk = ...</span><br></pre></td></tr></table></figure>

<p><code>f(x) = l0+l1...+lk</code>即可求出多项式</p>
<h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><figure class="highlight md"><table><tr><td class="code"><pre><span class="line">已知3个点(4,10)(5,5.25)(6,1)</span><br><span class="line"></span><br><span class="line">l0 = (((x-5)(x-6))/((4-5)(4-6))) * 10</span><br><span class="line">l1 = (((x-4)(x-6))/((5-4)(5-6))) * 5.25</span><br><span class="line">l2 = (((x-4)(x-5))/((6-4)(6-5))) * 1</span><br><span class="line"></span><br><span class="line">f(x) = l0+l1+l2 = 1/4(x^2-28x+136)</span><br></pre></td></tr></table></figure>

<h2 id="Shamir-秘密共享"><a href="#Shamir-秘密共享" class="headerlink" title="Shamir 秘密共享"></a>Shamir 秘密共享</h2><p>生成</p>
<a id="more"></a>
<ul>
<li>设需要生成w个密钥，至少需要t个密钥才能算出真实密钥</li>
<li>选择一个数P，之后所有数都需要进行模运算</li>
<li>设置真实密钥K</li>
<li>随机选择t-1个不大于P的数 <code>a0,a1...at-1</code></li>
<li>得到多项式 <code>f(x)=K+a0x+a1x^2...+at-1x^t</code></li>
<li>将<code>x=1.x=2...x=w</code>带入多项式即可获得多个密钥<code>(1,k1)(2,k2)...(w,kw)</code></li>
</ul>
<p>解密</p>
<ul>
<li>利用拉格朗日插值法即可算出多项式</li>
<li>需要带上模计算多项式，如果计算多项式时有除法需要进行计算模乘逆元</li>
<li>因为只需要K所以计算的时候可以直接x&#x3D;0</li>
</ul>
<h3 id="eg1"><a href="#eg1" class="headerlink" title="eg1"></a>eg1</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">w=4,t=3,K=2,p=23，选择随机数 a0=3, a1=2</span><br><span class="line"></span><br><span class="line">加密</span><br><span class="line"></span><br><span class="line">得到多项式 f(x) = (2 + 3x + 2x^2) mod 23</span><br><span class="line">f(1) = 2, f(2) = 16, f(3) = 6, f(4) = 0</span><br><span class="line">获得4个密钥(1,2)(2,16)(3,6)(4,0)</span><br><span class="line"></span><br><span class="line">解密</span><br><span class="line"></span><br><span class="line">选择其中三个进行解密，(1,7)(3,6)(4,0)</span><br><span class="line"></span><br><span class="line">l0 = (((x-3)(x-4))/((1-3)(1-4)))*7</span><br><span class="line">l1 = (((x-1)(x-4))/((3-1)(3-4)))*6</span><br><span class="line">l2 = (((x-1)(x-3))/((4-1)(4-3)))*0</span><br><span class="line"></span><br><span class="line">将x=0带入可得</span><br><span class="line"></span><br><span class="line">l0 = 14</span><br><span class="line">l1 = -12</span><br><span class="line">l2 = 0</span><br><span class="line"></span><br><span class="line">可得k = (l0+l1+l2) mod 23</span><br><span class="line">     = 2 mod 23</span><br><span class="line">     = 2</span><br></pre></td></tr></table></figure>

<h3 id="eg2"><a href="#eg2" class="headerlink" title="eg2"></a>eg2</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">w=5,t=3,k=13,p=17,选择随机数a0=10,a1=2</span><br><span class="line"></span><br><span class="line">加密</span><br><span class="line"></span><br><span class="line">得到多项式 f(x) = (13 + 10x + 2x^2) mod 17</span><br><span class="line">f(1) = 8, f(2) = 7, f(3) = 10, f(4) = 0, f(5) = 11</span><br><span class="line">获得5个密钥(1,8)(2,7)(3,10)(4,0)(5,11)</span><br><span class="line"></span><br><span class="line">解密</span><br><span class="line"></span><br><span class="line">选择其中三个进行解密，(1,8)(2,7)(5,11)</span><br><span class="line"></span><br><span class="line">l0 = 11 * ( ((x-1)(x-2)) / ((5-1)(5-2)) )</span><br><span class="line">l1 = 7  * ( ((x-1)(x-5)) / ((2-1)(2-5)) )</span><br><span class="line">l2 = 8  * ( ((x-2)(x-5)) / ((1-2)(1-5)) )</span><br><span class="line"></span><br><span class="line">将 x=0 带入</span><br><span class="line"></span><br><span class="line">l0 = 22/12</span><br><span class="line">l1 = -140/12</span><br><span class="line">l2 = 240/12</span><br><span class="line"></span><br><span class="line">K = (l0+l1+l2) mod 17</span><br><span class="line">  = (61/6) mod 17</span><br><span class="line">  = (61 * 6^-1) mod 17 // 6^-1为6关于17的模乘逆元为3</span><br><span class="line">  = (61 * 3) mod 17 </span><br><span class="line">  = 13</span><br></pre></td></tr></table></figure>

<h2 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h2><p>example</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">w=5,t=3,K=117</span><br><span class="line"></span><br><span class="line">选择w个d,要求单调递增并两两互素,t个最小的d相乘大于K,K大于t-1个最大d相乘</span><br><span class="line">d1=4,d2=5,d3=7,d4=9,d5=11</span><br><span class="line"></span><br><span class="line">计算 ki=Key mod di // = -&gt; \equal</span><br><span class="line"></span><br><span class="line">k1 = 117 mod 4 = 1</span><br><span class="line">k2 = 117 mod 5 = 2</span><br><span class="line">k3 = 117 mod 7 = 5</span><br><span class="line">k4 = 117 mod 9 = 0</span><br><span class="line">k5 = 117 mod 11 = 7</span><br><span class="line"></span><br><span class="line">即五个密钥(1,4),(2,5),(3,7),(0,9),(7,11)</span><br><span class="line"></span><br><span class="line">解密</span><br><span class="line">选其中三个密钥(1,4)(2,5)(3,7)</span><br><span class="line">可得</span><br><span class="line"></span><br><span class="line">k mod 4 = 1</span><br><span class="line">k mod 5 = 2</span><br><span class="line">k mod 11 = 7</span><br><span class="line"></span><br><span class="line">分解为</span><br><span class="line">k1 mod 4 = 1, k1 mod 5 = 0, k1 mod 11 = 0</span><br><span class="line">  -&gt; 5 * 11 * x1 mod 4 = 1</span><br><span class="line">  -&gt; x1 = 3</span><br><span class="line">  -&gt; k1 = 55 * 3 = 165</span><br><span class="line"></span><br><span class="line">k2 mod 4 = 0, k2 mod 5 = 2, k2 mod 11 = 0</span><br><span class="line">  -&gt; 4 * 11 * x2 mod 5 = 2</span><br><span class="line">  -&gt; 44 * x2 * 2^-1 mod 5 = 1 // 2^-1 为2关于5的模乘逆元</span><br><span class="line">  -&gt; 44 * x2 * 3 mod 5 = 1</span><br><span class="line">  -&gt; 132 * x2 mod 5 = 1 // 相当于算132关于5的模乘逆元</span><br><span class="line">  -&gt; x2 = 3</span><br><span class="line">  -&gt; k2 = 44 * 3 = 132</span><br><span class="line"></span><br><span class="line">k3 mod 4 = 0, k3 mod 5 = 0, k3 mod 11 = 7</span><br><span class="line">  -&gt; 4 * 5 * x3 mod 11 = 7</span><br><span class="line">  -&gt; 20 * x3 * 7^-1 mod 11 = 1 // 7^-1 为7关于11的模乘逆元</span><br><span class="line">  -&gt; 20 * x3 * 8 mod 11 = 1</span><br><span class="line">  -&gt; 160 * x3 mod 11 = 1 // 相当于算160关于11的模乘逆元</span><br><span class="line">  -&gt; x3 = 2</span><br><span class="line">  -&gt; k3 = 40</span><br><span class="line"></span><br><span class="line">K = (k1 + k2 + k3) mod 4*5*11</span><br><span class="line">  = (165+132+40) mod 220</span><br><span class="line">  = 337 mod 220</span><br><span class="line">  = 117</span><br><span class="line"></span><br><span class="line">另一种：</span><br><span class="line">k1 mod 4 = 1, k1 mod 5 = 0, k1 mod 11 = 0</span><br><span class="line">  -&gt; 1 * (k1 mod 4 = 1, k1 mod 5 = 0, k1 mod 11 = 0) </span><br><span class="line">  -&gt; 5 * 11 * x1 mod 4 = 1</span><br><span class="line">  -&gt; x1 = 3</span><br><span class="line">  -&gt; k1 = 1 * 55 * 3 = 165</span><br><span class="line"></span><br><span class="line">k2 mod 4 = 0, k2 mod 5 = 2, k2 mod 11 = 0</span><br><span class="line">  -&gt; 2 * (k2 mod 4 = 0, k2 mod 5 = 1, k2 mod 11 = 0)</span><br><span class="line">  -&gt; 4 * 11 * x2 mod 5 = 1</span><br><span class="line">  -&gt; x2 = 4</span><br><span class="line">  -&gt; k2 2 * 44 * 4 = 352</span><br><span class="line"></span><br><span class="line">k3 mod 4 = 0, k3 mod 5 = 0, k3 mod 11 = 7</span><br><span class="line">  -&gt; 7 * (k3 mod 4 = 0, k3 mod 5 = 0, k3 mod 11 = 1)</span><br><span class="line">  -&gt; 4 * 5 * x3 mod 11 = 1</span><br><span class="line">  -&gt; x3 = 5</span><br><span class="line">  -&gt; k3 = 7 * 20 * 5 = 700</span><br><span class="line"></span><br><span class="line">K = (k1 + k2 + k3) mod (4*5*11)</span><br><span class="line">  = (165 + 352 + 700) mod 220</span><br><span class="line">  = 1217 mod 220</span><br><span class="line">  = 117</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" target="_blank" rel="noopener">Shamir’s Secret Sharing - Wikipedia</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95" target="_blank" rel="noopener">拉格朗日插值法 - Wikipedia</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/95362628" target="_blank" rel="noopener">趣说密码学（五）秘密共享方案——shamir,中国剩余定理,Brickell和Blakley</a></li>
<li><a href="https://www.cnblogs.com/pyrie/p/sss_py.html" target="_blank" rel="noopener">Shamir秘密共享方案 (Python)</a></li>
</ul>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
        <tag>Shamir</tag>
      </tags>
  </entry>
  <entry>
    <title>翻译-C程序员所应该知道的内存</title>
    <url>/posts/f87fc9f0/</url>
    <content><![CDATA[<blockquote>
<p>原文章 <a href="https://marek.vavrusa.com/memory/#mmap-fun" target="_blank" rel="noopener">What a C programmer should know about memory</a><br>提示: <strong>本篇文章的图片都是直接使用原文中的图片的地址,如果无法显示,请挂代理</strong></p>
</blockquote>
<hr>
<p>2007年,Ulrich Drepper写了一篇”<a href="http://www.akkadia.org/drepper/cpumemory.pdf" target="_blank" rel="noopener">每个程序员都应该知道的内存</a>“.是的,虽然这篇文章又细又长,但做到了它所应做到的.很多年后,虚拟内存的概念对于很多人来说仍然难以琢磨,仿佛是某种魔法.我无法抗拒的引用一下.很多年后甚至原始文章的有效性也被<a href="https://stackoverflow.com/questions/8126311/what-every-programmer-should-know-about-memory" target="_blank" rel="noopener">质疑</a>,到底发生了什么事?</p>
<blockquote>
<p>北桥,这是什么东西?那不是巷战.</p>
</blockquote>
<p>我尝试从”学习锁的基本原理”去传达实用的一面(比如:你能做什么)和更多有趣的东西.可以看待这是一个胶水在原始文章和你每天使用的东西之间.例子将使用linux上的C99,但是更多主题将是普遍的.<br>编辑: 虽然我对Windows不了解,但我很乐意联系文章去解释.我会尽全力去提起什么函数是平台特有的,但是再一次我只是一个人.如果你发现出入,请让我知道.<br>事不宜迟，倒一杯咖啡，让我们开始吧。</p>
<p>译者注:</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">worth one's salt:</span><br><span class="line"><span class="code">    good or competent at the job or profession specified.</span></span><br><span class="line"><span class="code">    ig:"any astrologer worth her salt would have predicted this"</span></span><br><span class="line"></span><br><span class="line">what gives?</span><br><span class="line"><span class="code">    是在英语对话中常用的一句口语</span></span><br><span class="line"><span class="code">    通常用它的时候只有两层意思</span></span><br><span class="line"><span class="code">    一个是What's happening?发生了什么事？</span></span><br><span class="line"><span class="code">    另一个是What is the news?有什么消息？</span></span><br><span class="line"></span><br><span class="line">the practical side</span><br><span class="line"><span class="code">    实用的一面</span></span><br></pre></td></tr></table></figure>

<h2 id="理解虚拟内存-复杂且神秘"><a href="#理解虚拟内存-复杂且神秘" class="headerlink" title="理解虚拟内存 - 复杂且神秘"></a>理解虚拟内存 - 复杂且神秘</h2><p>除非你要处理一些嵌入系统或内核空间的代码,否则你应该在保护模式下进行.这太棒了,你的程序一定拥有它自己的[虚拟]地址空间.”虚拟”在这里很重要.这意味着,除了其他事情外,你不会被可使用的内存限制,但是也无权获得任何.为了使用这些空间,你不得向操作系统要一些真东西来作后援,这被叫做映射.后援可能是物理内存,也可能是持久性存储.前者也被叫做”匿名映射”.但是,稍安勿躁.<a id="more"></a><br>虚拟内存分配(virtual memory allocator&#x3D;VMA)可以给你所不存在的内存,他只能徒劳的希望你不要去使用它,就像现在的银行.这是过量使用(<a href="https://www.kernel.org/doc/Documentation/vm/overcommit-accounting" target="_blank" rel="noopener">overcommiting</a>),并且也存在有需求的程序(稀疏数组),这也意味着内存分配不能简单的说”不”.  </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *block = <span class="built_in">malloc</span>(<span class="number">1024</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="keyword">if</span> (block == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> -ENOMEM; <span class="comment">/* Sad :( */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>检查NULL是一个很好的做法,但也没有曾经那么强大.因为过量使用(overcommiting)的存在,操作系统可能给你的内存分配器分配一个有效的内存指针,但当你去访问时-dang*.这里的dang是有平台差异的,但普遍情况下<a href="http://www.win.tue.nl/~aeb/linux/lk/lk-9.html#ss9.6" target="_blank" rel="noopener">oom(out-of-memory) killer</a>将结束你的程序.  </p>
<p><em>这里过于简单,as timbatron noted,并且将在<a href="https://marek.vavrusa.com/memory/#pagefault" target="_blank" rel="noopener">解释按需分页</a>节解释.但是我想要在研究细节之前先过一遍更普遍的知识.</em></p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">the plot thickens</span><br><span class="line"><span class="code">    said to mean that a complicated situation or series of events starts to become even more complicated or mysterious</span></span><br><span class="line"><span class="code">    At this point the plot thickened further. A link emerged between the attempt to kill the Pope and the kidnapping of the American.</span></span><br><span class="line"></span><br><span class="line">guaranteed 美 [ˌɡerənˈtid] 英 [ˌɡærənˈtiːd]</span><br><span class="line"><span class="code">    adj. 必定的，肯定的</span></span><br><span class="line"></span><br><span class="line">bounded 美 ['baundid] 英 [ˈbaʊndɪd]</span><br><span class="line"><span class="code">    有界限的, 有限制的</span></span><br><span class="line"></span><br><span class="line">entitled 美 [ɛnˈtaɪtəld; ɪnˈtaɪtəld] 英 [ɪnˈtaɪtəld]</span><br><span class="line"><span class="code">    adj. 有资格的</span></span><br><span class="line"></span><br><span class="line">hold your horses</span><br><span class="line"></span><br><span class="line"><span class="code">    used to tell someone to stop and consider carefully their decision or opinion about something:</span></span><br><span class="line"><span class="code">    Just hold your horses, Bill! Let's think about this for a moment.</span></span><br><span class="line"><span class="code">    停下來想想，且慢… 稍安勿躁</span></span><br><span class="line"></span><br><span class="line">vain 美 [veɪn] 英 [veɪn]</span><br><span class="line"><span class="code">    adj. 徒劳的</span></span><br><span class="line"></span><br><span class="line">a good practice 一个很好的做法</span><br></pre></td></tr></table></figure>

<h2 id="绕道-内存布局"><a href="#绕道-内存布局" class="headerlink" title="绕道 - 内存布局"></a>绕道 - 内存布局</h2><p>进程内存的布局已经很好的在Gustavo Duarte所著的<a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/" target="_blank" rel="noopener">剖析程序内存中</a>中进行解释,所以我将引用并参考原始文章,我希望这是合理的使用.我只有一点想要吹毛求疵一下,那就是他只讲到了x86-32的内存布局,但是幸运的是在x86-64中并没有多大的变化,只是进程可以使用更多的空间 - 在linux中高达 48 bits.</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://static.duartes.org/img/blogPosts/linuxFlexibleAddressSpaceLayout.png" alt="linux内存布局"></p>
<center>Source: Linux address space layout by <a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory/" target="_blank" rel="noopener">Gustavo Duarte</a></center>

<p>这也展示了内存映射段(<code>memory mapping segment</code>&#x3D;MMS)是向下增长的,但是并非总是如此.内存映射段通常开始与(<a href="http://lxr.free-electrons.com/source/mm/mmap.c#L1953" target="_blank" rel="noopener">x86&#x2F;mm&#x2F;mmap.c:113</a>和<a href="http://lxr.free-electrons.com/source/arch/x86/mm/mmap.c#L113" target="_blank" rel="noopener">arch&#x2F;mm&#x2F;mmap.c:1953</a>)一个栈底的随机地址.但也可以开始于栈之上或向栈之上增长当且仅当栈很大或栈无限大,或者兼容布局是被允许的.这重要吗?不,但是这将帮助你理解<a href="https://marek.vavrusa.com/memory/#mmap-fun" target="_blank" rel="noopener">自由地址范围</a>.<br>看那个图表,你可以看到三个不同的变量存放位置:进程数据段(静态存储或堆分配),内存映射段,和栈.让我们从这个开始</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">anatomy 美 [əˈnætəmi] 英 [əˈnætəmɪ]</span><br><span class="line"><span class="code">    n. 解剖学；结构；身体；剖析</span></span><br><span class="line"></span><br><span class="line">quibble 美 [ˈkwɪbəl] 英 [ˈkwɪbəl]</span><br><span class="line"><span class="code">    vi /ˈkwɪbəl/</span></span><br><span class="line"><span class="code">        1.（尤指为搪塞）吹毛求疵，诡辩</span></span><br><span class="line"><span class="code">        2.用双关语；说俏皮话</span></span><br><span class="line"><span class="code">    n /ˈkwɪbəl/</span></span><br><span class="line"><span class="code">        1.（尤指为搪塞）吹毛求疵，抱怨</span></span><br><span class="line"><span class="code">        2.双关语</span></span><br><span class="line"></span><br><span class="line">fair 美 [fɛr] 英 [fɛə]</span><br><span class="line"><span class="code">    合理的</span></span><br><span class="line"></span><br><span class="line">iff [if]</span><br><span class="line"><span class="code">    abbr. (= if and only if) 当且仅当</span></span><br></pre></td></tr></table></figure>

<h2 id="了解栈分配"><a href="#了解栈分配" class="headerlink" title="了解栈分配"></a>了解栈分配</h2><p>实用腰带(译者注：此处为直译，原文为Utility belt)：</p>
<ul>
<li><a href="https://linux.die.net/man/3/alloca" target="_blank" rel="noopener">alloca()-在调用者的栈帧中分配内存</a></li>
<li><a href="https://linux.die.net/man/2/getrlimit" target="_blank" rel="noopener">getrlimit()-获取&#x2F;设置资源限制</a></li>
<li><a href="https://linux.die.net/man/2/sigaltstack" target="_blank" rel="noopener">sigaltstack()-设置并且(或)得到信号栈上下文</a></li>
</ul>
<p>栈易于理解,所有人都知道如何在栈中创建一个变量,不是吗?<br>这里有两个例子:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> stairway = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span> heaven[] = &#123; <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>变量的有效性被范围所限制.在C语言中,这意味着:<code>{}</code>.所以每次出现右花括号时就意味着一个变量的结束.然后这里有<a href="https://linux.die.net/man/3/alloca" target="_blank" rel="noopener">alloca()</a>,允许在当前的栈帧中动态分配内存.栈帧与内存框架(memory frame)(也被叫做物理页(physical page))不同,这是一个简单的可以被放入栈中的数据组(函数,参数,变量…).每当我们在栈顶时,我们可以使用剩余的内存直到达到栈的大小限制.<br>这就是可变长数组(variable-length arrays&#x3D;VLA),以及alloca()的工作方式,但是有一个不同-可变长的数组的有效性被范围限制,alloca将保留内存直到函数返回(或被释放).这不是单纯的语法警察(译者注:原文language lawyering,这节下面有详细翻译),这确实是一个问题如果你在循环中使用alloca,因为你没有任何手段去释放它.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">laugh</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> i = <span class="number">0</span>; i &lt; megatron; ++i) &#123;</span><br><span class="line">        <span class="keyword">char</span> *res = alloca(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">memcpy</span>(res, <span class="string">"ha"</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">char</span> vla[<span class="number">2</span>] = &#123;<span class="string">'h'</span>,<span class="string">'a'</span>&#125;</span><br><span class="line">    &#125; <span class="comment">/* vla dies, res lives */</span></span><br><span class="line">&#125; <span class="comment">/* all allocas die */</span></span><br></pre></td></tr></table></figure>

<p>可变长数组和alloca都不适合大分配,因为你几乎没有控制可用的栈内存并且超过栈限制的分配将导致栈溢出.这里有两种方法,但都不实用.<br>第一个方法就是使用sigaltstack()去抓获<code>SIGSEGV</code>并处理.然而这仅仅是让你抓获到栈溢出.<br>另一个方法是以<code>split-stacks</code>进行编译,顾名思义,这真的就是把单片栈分为较小的栈链表也被叫做<code>stacklets</code>.就我所知,GCC和clang都支持-fsplit-stack选项.理论上这也改善了内存的消耗量并且降低了创建线程的成本 - 因为栈一开始就很小并且按需增长.实际上,预期可能会有兼容性问题,因为他需要一个split-stack链表感知器(译者注:原文aware linker)(如:gold)与split-stack unaware库配合使用,而且还有性能问题(Agis Anastasopoulos的”hot split”在Go中是个很好的<a href="http://agis.io/2014/03/25/contiguous-stacks-in-go.html" target="_blank" rel="noopener">解释</a>)</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Stack Frame 栈帧</span><br><span class="line">digest [ˈdaɪˌdʒɛst]</span><br><span class="line"><span class="code">    理解</span></span><br><span class="line"></span><br><span class="line">a variable dies 变量的结束</span><br><span class="line"></span><br><span class="line">aka = also-known-as</span><br><span class="line"></span><br><span class="line">this is how 这就是...</span><br><span class="line"></span><br><span class="line">means [mēnz]</span><br><span class="line"><span class="code">    名词 手段; 方法; 工具; 办法; 径; 繇; 款</span></span><br><span class="line"></span><br><span class="line">grow on demand 按需增长</span><br><span class="line"></span><br><span class="line">play nice with 配合</span><br><span class="line"></span><br><span class="line">scope 美 [skoʊp] 英 [skəʊp]</span><br><span class="line"><span class="code">    n. 范围，领域；</span></span><br><span class="line"></span><br><span class="line">remaining 其余</span><br></pre></td></tr></table></figure>

<p><strong>language lawyer</strong> from <a href="https://www.reddit.com/r/cpp/comments/52yd5s/what_does_stroustrup_mean_by_language_lawyers_hes/" target="_blank" rel="noopener">What does Stroustrup mean by ‘language lawyers’? He’s said it more than a few times.</a><br>A language lawyer is generally someone that is familiar enough with the details of the standard that they can quote it chapter and verse in order to answer a question, solve a problem, prove a point, etc. The standard is the ultimate authority on what is and isn’t valid C++, and much like the law it’s written in very technical and precise language that requires some effort to really unpack, so there are several parallels to the field of law.<br>It can have both positive and negative connotations. The idea is that you shouldn’t need to be a language lawyer to be able to learn and use the language. At the same time, having a single document that precisely defines the semantics of the language is a significant advantage that many other languages lack, so the fact that it’s possible to be a language lawyer is not an automatic negative. In order to have compatible implementations it’s necessary to define all the edge conditions and dark corners of the language, even if it results in some truly out there passages of the standard.  </p>
<h2 id="了解堆分配"><a href="#了解堆分配" class="headerlink" title="了解堆分配"></a>了解堆分配</h2><p>Utility belt:  </p>
<ul>
<li><a href="https://linux.die.net/man/2/sbrk" target="_blank" rel="noopener">brk(), sbrk() - manipulate the data segment size</a></li>
<li><a href="https://linux.die.net/man/3/malloc" target="_blank" rel="noopener">malloc() family - portable libc memory allocator</a></li>
</ul>
<p>堆分配可以简单的看作是移动堆段的结束位置(<a href="https://linux.die.net/man/2/sbrk" target="_blank" rel="noopener">program break</a>)和声明内存在旧位置和新位置之间。到了这一点，堆分配和栈分配一样快(没有分页，假设栈已锁定在内存中)。但是有一只猫(cat)，我的意思是捕获(catch)，该死的(dammit)。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *block = sbrk(<span class="number">1024</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br></pre></td></tr></table></figure>

<p>(1)我们不能重新声明未使用的内存块，(2)不是线程安全的，因为堆在线程之间共享，(3)接口很难移植，库不能接触到中断  </p>
<blockquote>
<p>man 3 sbrk — Various systems use various types for the argument of sbrk(). Common are int, ssize_t, ptrdiff_t, intptr_t.  </p>
</blockquote>
<p>由于这些原因，libc实现了用于内存分配的集中式接口。实现方式<a href="https://en.wikibooks.org/wiki/C_Programming/C_Reference/stdlib.h/malloc#Implementations" target="_blank" rel="noopener">各不相同</a>，但是它支持线程安全的任意大小的内存分配…但有代价。代价是延迟，因为这里还涉及锁，数据结构保留有关已用&#x2F;可用块的信息以及额外的内存开销。堆也不是唯一使用的，因为内存映射段也经常应用于大内存块。  </p>
<blockquote>
<p>man 3 malloc — Normally, malloc() allocates memory from the heap, … when allocating blocks of memory larger than<br>MMAP_THRESHOLD, the glibc malloc() implementation allocates the memory as a private anonymous mapping.  </p>
</blockquote>
<p>因为从<code>start_brk</code>到<code>brk</code>堆总是连续的，所以你不能精确钻取漏洞穿过它并减少数据段大小。想象以下情节：  </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *truck = <span class="built_in">malloc</span>(<span class="number">1024</span> * <span class="number">1024</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="keyword">char</span> *bike  = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="built_in">free</span>(truck);</span><br></pre></td></tr></table></figure>

<p>堆[分配器]移动<code>brk</code>为<code>truck</code>腾出空间。同样为<code>bike</code>也进行相同的操作。但是在<code>truck</code>释放后，<code>brk</code>也无法降级(向下移)，因为<code>bike</code>占据最高段地址。结论就是你的程序可以重用之前<code>truck</code>的内存，但是不会被交回系统直到<code>bike</code>被释放。<br>假设<code>truck</code>被映射，它将不能处于堆段，并且不能影响程序中断(program break)。不过，这种技巧并不能阻止因小分配(另一种说法也叫“碎片化”)而造成的漏洞。<br>注意<code>free()</code>不总是尝试去缩小数据段，因为这是一个<a href="https://marek.vavrusa.com/memory/#pagefault" target="_blank" rel="noopener">潜在的昂贵操作</a>。这对于长时间运行的程序来说是一个问题，如守护程序。一个GNU的拓展，被叫做<a href="https://linux.die.net/man/3/malloc_trim" target="_blank" rel="noopener">malloc_trim()</a>，用于从堆顶部释放内存，但可能会很慢。它对很多小对象的伤害很大，因此应谨慎使用。</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">sans [sænz]</span><br><span class="line"><span class="code">    __没有__,在外,外部</span></span><br><span class="line"></span><br><span class="line">portable [ˈpɔːtəbəl]</span><br><span class="line"><span class="code">    可移植的</span></span><br><span class="line"></span><br><span class="line">The cost</span><br><span class="line"><span class="code">    代价</span></span><br><span class="line"></span><br><span class="line">utilised</span><br><span class="line"><span class="code">    adj. 被利用的</span></span><br><span class="line"></span><br><span class="line">exclusively [iks'klu:sivli]</span><br><span class="line"><span class="code">    adv. 独占地，专门地，完全地</span></span><br><span class="line"></span><br><span class="line">contiguous [kənˈtɪgjuəs]</span><br><span class="line"><span class="code">    adj. 邻近的；__连续的__</span></span><br><span class="line"></span><br><span class="line">scenario [səˈnɛriˌoʊ]</span><br><span class="line"><span class="code">    n. __情节__；剧本；方案</span></span><br><span class="line"></span><br><span class="line">reuse [riˈjuz]</span><br><span class="line"><span class="code">    n. 再用，重新使用</span></span><br><span class="line"><span class="code">    v. 再用，重新使用</span></span><br><span class="line"></span><br><span class="line">fragmentation [frægmən'teiʃən]</span><br><span class="line"><span class="code">    碎片</span></span><br><span class="line"></span><br><span class="line">sparingly [ˈspeərɪŋlɪ]</span><br><span class="line"><span class="code">    adv. 拘谨地;朴实地;节俭地</span></span><br></pre></td></tr></table></figure>

<h2 id="未完待续-不定时接着翻译"><a href="#未完待续-不定时接着翻译" class="headerlink" title="未完待续-不定时接着翻译"></a>未完待续-不定时接着翻译</h2><figure class="highlight md"><table><tr><td class="code"><pre><span class="line">conquering [ˈkɒŋkərɪŋ]</span><br><span class="line"><span class="code">    adj /ˈkɒŋkərɪŋ/ 进行征服的</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Program</category>
      </categories>
      <tags>
        <tag>C</tag>
        <tag>English</tag>
        <tag>translate</tag>
      </tags>
  </entry>
  <entry>
    <title>解决linux下Realtek ALC295的耳机炸裂声</title>
    <url>/posts/67c8ee7f/</url>
    <content><![CDATA[<p>个人使用的笔记本是暗影精灵2 PRO,产品名称是: OMEN by HP Laptop 15-ax210TX.  </p>
<p>最初本人装的是ubuntu,左边耳机的声音一直有噼里啪啦的炸裂声,后来换了Arch还是一样的情况,而且本人喜欢听安静的声音,类似读故事或是心跳声这种,每次听到劈裂啪啦的声音真是难受.</p>
<p>最初尝试过Arch wiki中的各种方法 包括</p>
<blockquote>
<p><a href="https://wiki.archlinux.org/index.php/PulseAudio/Troubleshooting#Glitches,_skips_or_crackling" target="_blank" rel="noopener">PulseAudio&#x2F;Troubleshooting#Glitches,_skips_or_crackling</a><br><a href="https://wiki.archlinux.org/index.php/PulseAudio/Troubleshooting#Static_noise_when_using_headphones" target="_blank" rel="noopener">PulseAudio&#x2F;Troubleshooting#Static_noise_when_using_headphones</a></p>
</blockquote>
<p>都没有任何改进.</p>
<p>直到后来才发现这是linux下Realtek ALC295的驱动不完善导致的,这个bug在17年就提出了,至今都没有得到解决.</p>
<blockquote>
<p><a href="https://bugzilla.kernel.org/show_bug.cgi?id=195457" target="_blank" rel="noopener">Bug 195457 - Realtek ALC295 still unsupported</a><br><a href="https://bugs.launchpad.net/ubuntu/+source/alsa-driver/+bug/1648183" target="_blank" rel="noopener">Crackling and popping sound when using headphones</a>  </p>
</blockquote>
<p>即使有人提交补丁并合并到了linux内核中</p>
<blockquote>
<p><a href="https://github.com/torvalds/linux/commit/44be77c590f381bc629815ac789b8b15ecc4ddcf#diff-6cb60ab78549a5b6838f746b9e128105" target="_blank" rel="noopener">ALSA: hda - Fix missing COEF init for ALC225&#x2F;295&#x2F;299</a></p>
</blockquote>
<p>但是事实证明并没有用</p>
<p>依照上面有人提供的方法却有效(看起来跟提交补丁差不多,但是补丁却没有起作用):</p>
<a id="more"></a>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">I've managed to fix this problem on my machine (HP Omen 15 running Ubuntu 17.04 using codec for Realtek ALC295 sound device). To fix the problem, I can do the following:</span><br><span class="line"></span><br><span class="line">Install alsa-tools if not installed:</span><br><span class="line"></span><br><span class="line">sudo apt install alsa-tools</span><br><span class="line"></span><br><span class="line">Create and save a script in /usr/local/bin:</span><br><span class="line"></span><br><span class="line"><span class="section">#!/bin/bash</span></span><br><span class="line">hda-verb /dev/snd/hwC0D0 0x20 SET<span class="emphasis">_COEF_</span>INDEX 0x67</span><br><span class="line">hda-verb /dev/snd/hwC0D0 0x20 SET<span class="emphasis">_PROC_</span>COEF 0x3000</span><br><span class="line"></span><br><span class="line">Run the script as root in a terminal to immediately fix the problem.</span><br><span class="line"></span><br><span class="line">To run the script on startup, use cron with the @reboot command:</span><br><span class="line"></span><br><span class="line">sudo crontab -e</span><br><span class="line"></span><br><span class="line">and then add line in crontab:</span><br><span class="line">@reboot [full path to script]</span><br><span class="line"></span><br><span class="line">To run script on resume from suspend, copy the script to /lib/systemd/system-sleep</span><br><span class="line"></span><br><span class="line">For more technical details regarding this fix, see https://bugzilla.kernel.org/show_bug.cgi?id=195457</span><br></pre></td></tr></table></figure>

<p>arch下类似 除了是用pacman安装alsa-tools,之后操作是一样的.</p>
<p>不使用crontab,使用systemd的方法<a href="https://wiki.archlinux.org/index.php/ASUS_Zenbook_UX430/UX530#Headphones_audio_is_too_low" target="_blank" rel="noopener">ASUS_Zenbook_UX430&#x2F;UX530#Headphones_audio_is_too_low</a></p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">In order to fix it, install alsa-tools or hda-verbAUR and create the file:</span><br><span class="line"></span><br><span class="line">/usr/local/bin/fix<span class="emphasis">_headphones_</span>audio.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    DEVICE=`ls /dev/snd/hwC[[:<span class="built_in">print</span>:]]*D0 | head -n 1`</span><br><span class="line">    <span class="keyword">if</span> [ ! -z <span class="string">"<span class="variable">$DEVICE</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        hda-verb <span class="string">"<span class="variable">$DEVICE</span>"</span> 0x20 SET_COEF_INDEX 0x67</span><br><span class="line">        hda-verb <span class="string">"<span class="variable">$DEVICE</span>"</span> 0x20 SET_PROC_COEF 0x3000</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Then create a systemd script with the following content:</span><br><span class="line"></span><br><span class="line">/etc/systemd/system/fix<span class="emphasis">_headphones_</span>audio.service</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Fix headphones audio after boot &amp; resume.</span><br><span class="line">After=multi-user.target suspend.target hibernate.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">ExecStart=/bin/sh &apos;/usr/local/bin/fix_headphones_audio.sh&apos;</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target suspend.target hibernate.target</span><br></pre></td></tr></table></figure>

<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">And finally, start and enable fix<span class="emphasis">_headphones_</span>audio.service.</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p><a href="https://bugzilla.kernel.org/show_bug.cgi?id=195457" target="_blank" rel="noopener">Bug 195457 - Realtek ALC295 still unsupported</a><br><a href="https://bugs.launchpad.net/ubuntu/+source/alsa-driver/+bug/1648183" target="_blank" rel="noopener">Crackling and popping sound when using headphones</a><br><a href="https://askubuntu.com/questions/873881/how-to-install-bang-and-olufsen-audio-drivers-for-hp-laptop" target="_blank" rel="noopener">How to install Bang and Olufsen Audio drivers for HP laptop?</a><br><a href="https://wiki.archlinux.org/index.php/ASUS_Zenbook_UX430/UX530#Headphones_audio_is_too_low" target="_blank" rel="noopener">ASUS_Zenbook_UX430&#x2F;UX530#Headphones_audio_is_too_low</a></p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>driver</tag>
        <tag>Realtek ALC295</tag>
      </tags>
  </entry>
  <entry>
    <title>让win10的UWP应用走代理</title>
    <url>/posts/d22ffdb6/</url>
    <content><![CDATA[<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>因为uwp应用的特殊性,即使使用proxifier和proxycap这种应用也无法让其走代理</p>
<h2 id="现在可直接用WindowsLoopbackManager"><a href="#现在可直接用WindowsLoopbackManager" class="headerlink" title="现在可直接用WindowsLoopbackManager"></a>现在可直接用WindowsLoopbackManager</h2><p><a href="https://github.com/tiagonmas/Windows-Loopback-Exemption-Manager" target="_blank" rel="noopener">WindowsLoopbackManager</a></p>
<a id="more"></a>
<h2 id="1-SSTAP"><a href="#1-SSTAP" class="headerlink" title="1.SSTAP"></a>1.SSTAP</h2><p>这个应用是创建虚拟网卡,让windows全局走代理.但其有弊端就是有一些国内的网站也会走代理,比如BILIBILI.虽然可以自己写规则但实在是麻烦无比.</p>
<h2 id="2-fiddler"><a href="#2-fiddler" class="headerlink" title="2.fiddler"></a>2.fiddler</h2><p>利用fiddler的winconfig实现uwp应用走代理<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/WK%290~%29WR%29N79$KZ4HZZTDQ2.png" alt="."><br>把要走代理的应用勾上<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/KT3%28H@%60C63P@2KH_X7C@QDI.png" alt="."><br>但这不是全局代理,只能让uwp应用走代理</p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>解决xfce4画面撕裂</title>
    <url>/posts/38868ade/</url>
    <content><![CDATA[<h2 id="安装compton"><a href="#安装compton" class="headerlink" title="安装compton"></a>安装compton</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install compton</span><br></pre></td></tr></table></figure>

<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>compton的配置文件在~&#x2F;.config&#x2F;compton.conf<br>因为有些窗口的阴影有时候会变的很奇怪,大概你有可能需要修改一下,附上我的:<a id="more"></a>  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Backend</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line"># Backend to use: &quot;xrender&quot; or &quot;glx&quot;.</span><br><span class="line"># GLX backend is typically much faster but depends on a sane driver.</span><br><span class="line">backend = &quot;glx&quot;;</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># GLX backend</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line">glx-no-stencil = true;</span><br><span class="line"></span><br><span class="line"># GLX backend: Copy unmodified regions from front buffer instead of redrawing them all.</span><br><span class="line"># My tests with nvidia-drivers show a 10% decrease in performance when the whole screen is modified,</span><br><span class="line"># but a 20% increase when only 1/4 is.</span><br><span class="line"># My tests on nouveau show terrible slowdown.</span><br><span class="line"># Useful with --glx-swap-method, as well.</span><br><span class="line">glx-copy-from-front = false;</span><br><span class="line"></span><br><span class="line"># GLX backend: Use MESA_copy_sub_buffer to do partial screen update.</span><br><span class="line"># My tests on nouveau shows a 200% performance boost when only 1/4 of the screen is updated.</span><br><span class="line"># May break VSync and is not available on some drivers.</span><br><span class="line"># Overrides --glx-copy-from-front.</span><br><span class="line"># glx-use-copysubbuffermesa = true;</span><br><span class="line"></span><br><span class="line"># GLX backend: Avoid rebinding pixmap on window damage.</span><br><span class="line"># Probably could improve performance on rapid window content changes, but is known to break things on some drivers (LLVMpipe).</span><br><span class="line"># Recommended if it works.</span><br><span class="line"># glx-no-rebind-pixmap = true;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># GLX backend: GLX buffer swap method we assume.</span><br><span class="line"># Could be undefined (0), copy (1), exchange (2), 3-6, or buffer-age (-1).</span><br><span class="line"># undefined is the slowest and the safest, and the default value.</span><br><span class="line"># copy is fastest, but may fail on some drivers,</span><br><span class="line"># 2-6 are gradually slower but safer (6 is still faster than 0).</span><br><span class="line"># Usually, double buffer means 2, triple buffer means 3.</span><br><span class="line"># buffer-age means auto-detect using GLX_EXT_buffer_age, supported by some drivers.</span><br><span class="line"># Useless with --glx-use-copysubbuffermesa.</span><br><span class="line"># Partially breaks --resize-damage.</span><br><span class="line"># Defaults to undefined.</span><br><span class="line">glx-swap-method = &quot;undefined&quot;;</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Shadows</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line"># Enabled client-side shadows on windows.</span><br><span class="line">shadow = true;</span><br><span class="line"># Don&apos;t draw shadows on DND windows.</span><br><span class="line">no-dnd-shadow = true;</span><br><span class="line"># Avoid drawing shadows on dock/panel windows.</span><br><span class="line">no-dock-shadow = true;</span><br><span class="line"># Zero the part of the shadow&apos;s mask behind the window. Fix some weirdness with ARGB windows.</span><br><span class="line">#clear-shadow = true;</span><br><span class="line"># The blur radius for shadows. (default 12)</span><br><span class="line">shadow-radius = 5;</span><br><span class="line"># The left offset for shadows. (default -15)</span><br><span class="line">shadow-offset-x = -5;</span><br><span class="line"># The top offset for shadows. (default -15)</span><br><span class="line">shadow-offset-y = -5;</span><br><span class="line"># The translucency for shadows. (default .75)</span><br><span class="line">shadow-opacity = 0.5;</span><br><span class="line"></span><br><span class="line"># Set if you want different colour shadows</span><br><span class="line"># shadow-red = 0.0;</span><br><span class="line"># shadow-green = 0.0;</span><br><span class="line"># shadow-blue = 0.0;</span><br><span class="line"></span><br><span class="line"># The shadow exclude options are helpful if you have shadows enabled. </span><br><span class="line">#Due to the way compton draws its shadows, certain applications will have visual glitches</span><br><span class="line"></span><br><span class="line"># (most applications are fine, only apps that do weird things with xshapes or argb are affected).</span><br><span class="line"></span><br><span class="line"># This list includes all the affected apps I found in my testing. </span><br><span class="line">#The &quot;! name~=&apos;&apos;&quot; part excludes shadows on any &quot;Unknown&quot; windows, this prevents a visual glitch with the XFWM alt tab switcher.</span><br><span class="line">#此处加入排除阴影的程序名字</span><br><span class="line">shadow-exclude = [</span><br><span class="line">    &quot;! name~=&apos;&apos;&quot;,</span><br><span class="line">    &quot;name = &apos;Notification&apos;&quot;,</span><br><span class="line">    &quot;name = &apos;Plank&apos;&quot;,</span><br><span class="line">    &quot;name = &apos;Docky&apos;&quot;,</span><br><span class="line">    &quot;name = &apos;Kupfer&apos;&quot;,</span><br><span class="line">    &quot;name = &apos;xfce4-notifyd&apos;&quot;,</span><br><span class="line">    &quot;name *= &apos;VLC&apos;&quot;,</span><br><span class="line">    &quot;name *= &apos;compton&apos;&quot;,</span><br><span class="line">    &quot;name *= &apos;gedit&apos;&quot;,</span><br><span class="line">    &quot;name *= &apos;Archive Manager&apos;&quot;,</span><br><span class="line">#    &quot;name *= &apos;Chromium&apos;&quot;,</span><br><span class="line">#    &quot;name *= &apos;Chrome&apos;&quot;,</span><br><span class="line">#    &quot;name *= &apos;Firefox&apos;&quot;,</span><br><span class="line">    &quot;class_g = &apos;Conky&apos;&quot;,</span><br><span class="line">    &quot;class_g = &apos;Kupfer&apos;&quot;,</span><br><span class="line">    &quot;class_g = &apos;Synapse&apos;&quot;,</span><br><span class="line">    &quot;class_g ?= &apos;Notify-osd&apos;&quot;,</span><br><span class="line">    &quot;class_g ?= &apos;Cairo-dock&apos;&quot;,</span><br><span class="line">    &quot;class_g ?= &apos;Xfce4-notifyd&apos;&quot;,</span><br><span class="line">    &quot;class_g ?= &apos;Xfce4-power-manager&apos;&quot;</span><br><span class="line">];</span><br><span class="line"># Avoid drawing shadow on all shaped windows (see also: --detect-rounded-corners)</span><br><span class="line">shadow-ignore-shaped = false;</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Opacity</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Fading</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line"># Fade windows during opacity changes.</span><br><span class="line">fading = true;</span><br><span class="line"># The time between steps in a fade in milliseconds. (default 10).</span><br><span class="line">fade-delta = 4;</span><br><span class="line"># Opacity change between steps while fading in. (default 0.028).</span><br><span class="line">#fade-in-step = 0.03;</span><br><span class="line"># Opacity change between steps while fading out. (default 0.03).</span><br><span class="line">#fade-out-step = 0.03;</span><br><span class="line"># Fade windows in/out when opening/closing</span><br><span class="line">#no-fading-openclose = true;</span><br><span class="line"></span><br><span class="line"># Specify a list of conditions of windows that should not be faded.</span><br><span class="line">#fade-exclude = [ ];</span><br><span class="line">fade-exclude = [ ];</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Other</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line"># Try to detect WM windows and mark them as active.</span><br><span class="line">mark-wmwin-focused = true;</span><br><span class="line"># Mark all non-WM but override-redirect windows active (e.g. menus).</span><br><span class="line">mark-ovredir-focused = true;</span><br><span class="line"># Use EWMH _NET_WM_ACTIVE_WINDOW to determine which window is focused instead of using FocusIn/Out events.</span><br><span class="line"># Usually more reliable but depends on a EWMH-compliant WM.</span><br><span class="line">use-ewmh-active-win = true;</span><br><span class="line"># Detect rounded corners and treat them as rectangular when --shadow-ignore-shaped is on.</span><br><span class="line">detect-rounded-corners = true;</span><br><span class="line"></span><br><span class="line"># Detect _NET_WM_OPACITY on client windows, useful for window managers not passing _NET_WM_OPACITY of client windows to frame windows.</span><br><span class="line"># This prevents opacity being ignored for some apps.</span><br><span class="line"># For example without this enabled my xfce4-notifyd is 100% opacity no matter what.</span><br><span class="line">#detect-client-opacity = true;</span><br><span class="line"></span><br><span class="line"># Specify refresh rate of the screen.</span><br><span class="line"># If not specified or 0, compton will try detecting this with X RandR extension.</span><br><span class="line">refresh-rate = 0;</span><br><span class="line"></span><br><span class="line"># Set VSync method. VSync methods currently available:</span><br><span class="line"># none: No VSync</span><br><span class="line"># drm: VSync with DRM_IOCTL_WAIT_VBLANK. May only work on some drivers.</span><br><span class="line"># opengl: Try to VSync with SGI_video_sync OpenGL extension. Only work on some drivers.</span><br><span class="line"># opengl-oml: Try to VSync with OML_sync_control OpenGL extension. Only work on some drivers.</span><br><span class="line"></span><br><span class="line"># opengl-swc: Try to VSync with SGI_swap_control OpenGL extension. Only work on some drivers. </span><br><span class="line">#Works only with GLX backend. Known to be most effective on many drivers. </span><br><span class="line">#Does not actually control paint timing, only buffer swap is affected, </span><br><span class="line">#so it doesn’t have the effect of --sw-opti unlike other methods. Experimental.</span><br><span class="line"></span><br><span class="line"># opengl-mswc: Try to VSync with MESA_swap_control OpenGL extension. Basically the same as opengl-swc above, except the extension we use.</span><br><span class="line"># (Note some VSync methods may not be enabled at compile time.)</span><br><span class="line">vsync = &quot;opengl-swc&quot;;</span><br><span class="line"></span><br><span class="line"># Enable DBE painting mode, intended to use with VSync to (hopefully) eliminate tearing.</span><br><span class="line"># Reported to have no effect, though.</span><br><span class="line">dbe = false;</span><br><span class="line"># Painting on X Composite overlay window. Recommended.</span><br><span class="line">paint-on-overlay = true;</span><br><span class="line"></span><br><span class="line"># Limit compton to repaint at most once every 1 / refresh_rate second to boost performance.</span><br><span class="line"># This should not be used with --vsync drm/opengl/opengl-oml as they essentially does --sw-opti&apos;s job already,</span><br><span class="line"># unless you wish to specify a lower refresh rate than the actual value.</span><br><span class="line">sw-opti = false;</span><br><span class="line"></span><br><span class="line"># Unredirect all windows if a full-screen opaque window is detected, to maximize performance for full-screen windows, like games.</span><br><span class="line"># Known to cause flickering when redirecting/unredirecting windows.</span><br><span class="line"># paint-on-overlay may make the flickering less obvious.</span><br><span class="line">unredir-if-possible = false;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Specify a list of conditions of windows that should always be considered focused.</span><br><span class="line">focus-exclude = [ ];</span><br><span class="line"></span><br><span class="line"># Use WM_TRANSIENT_FOR to group windows, and consider windows in the same group focused at the same time.</span><br><span class="line">detect-transient = true;</span><br><span class="line"># Use WM_CLIENT_LEADER to group windows, and consider windows in the same group focused at the same time.</span><br><span class="line"># WM_TRANSIENT_FOR has higher priority if --detect-transient is enabled, too.</span><br><span class="line">detect-client-leader = true;</span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line">#</span><br><span class="line"># Window type settings</span><br><span class="line">#</span><br><span class="line">#################################</span><br><span class="line"></span><br><span class="line">wintypes:</span><br><span class="line">&#123;</span><br><span class="line">    tooltip =</span><br><span class="line">    &#123;</span><br><span class="line">        # fade: Fade the particular type of windows.</span><br><span class="line">        fade = true;</span><br><span class="line">        # shadow: Give those windows shadow</span><br><span class="line">        shadow = false;</span><br><span class="line">        # opacity: Default opacity for the type of windows.</span><br><span class="line">        opacity = 0.85;</span><br><span class="line">        # focus: Whether to always consider windows of this type focused.</span><br><span class="line">        focus = true;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="关闭xfce4自带的合成器"><a href="#关闭xfce4自带的合成器" class="headerlink" title="关闭xfce4自带的合成器"></a>关闭xfce4自带的合成器</h2><p><strong>设置管理器-&gt;窗口管理器微调-&gt;合成器</strong>  </p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://blog-1254450445.cossgp.myqcloud.com/compton.png"></p>
<h2 id="启动compton"><a href="#启动compton" class="headerlink" title="启动compton"></a>启动compton</h2><h3 id="前台运行"><a href="#前台运行" class="headerlink" title="前台运行"></a>前台运行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compton</span><br></pre></td></tr></table></figure>

<h3 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compton -b</span><br></pre></td></tr></table></figure>

<h3 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h3><p>修改~&#x2F;.xprofile文件<br>将<code>compton -b</code>直接加到新的一行就行了</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>xfce4</tag>
      </tags>
  </entry>
  <entry>
    <title>関西弁コレクション</title>
    <url>/posts/a4241e7/</url>
    <content><![CDATA[<p>普段発見の関西弁ここで記録します。</p>
<p>–<strong>2020年1月30日</strong>–<br> おらん とはどういう意味ですか?</p>
<blockquote>
<p>文からするとその方は関西の人ですかね。おらんは方言で、「いない」という意味です。<br>例文：<em>俺も一緒やな 3年ぐらいはおらん。</em></p>
</blockquote>
<p>–<strong>2019年2月1日</strong>–</p>
<hr>
<p>①関西弁の～ねんけど、～やねん、～ねんの意味を教えて下さい<br>②～ねやは～ですかの意味ですか？それ意外に意味、使い方等は有りますか？<br>③言葉の関西弁のアクセントを教えて下さい  </p>
<p>①・・・<br>～ねんけど ですけれど（〇〇なんですけれど）<br>～やねん、～ねん です（〇〇なんです）</p>
<p>②・・・<br>～ねやは～（～やねん”わ”～ですね。）<br>〇○なんですよ。</p>
<p>③・・・<br>～ねんけど（中中）<br>～やねん（高低）<br>～やねんわ～（高低中）</p>
<a id="more"></a>  

<hr>
<p>関西弁で、「あんねんけど」と「あるねんけど」の違いはなんですか？  </p>
<p>意味の違いはない。<br>「あるねんけど」＝「あんねんけど」</p>
<p>「る」が撥音化して「ん」になっただけ。日本語では語中の「ラ行音」が「ん」に変化する傾向がある。<br>・それで→そんで<br>・分からない→分かんない</p>
<p>–<strong>2018年12月8日</strong>–  </p>
<hr>
<p>せやからアカンてゆうたやろ<br>せやから 別表記：そやから<br>「だから」の意味。主に関西地方で用いる。「そやから」ともいう。  </p>
<p>アカン(あかん)<br>関西弁で「ダメ」の意味。  </p>
<p>『ゆうて』は『～言って』<br> ##方言で だから ダメって 言ったでしょ  </p>
<p>–<strong>2018年8月29日</strong>–</p>
<hr>
<p>ビビり【名词】<br>1.颤动，振纹（机械）<br>2.胆小，大阪方言。関西弁</p>
<hr>
<p>女子|おなご  </p>
<ul>
<li>名词<ul>
<li>（女の子、女児）。</li>
<li>（女の人、女性、婦人）。</li>
<li>（召し使いの女、女中、はしため）。　&lt;-関西弁</li>
</ul>
</li>
</ul>
<p>–<strong>2018年8月7日</strong>–</p>
<hr>
<p>それアカンやつや<br>一字一句、分けてみましょう。「それ、アカン、やつ、や」になります。<br>「それ」はthatのことですよね。<br>「アカン」はNOのことです。その通り、関西弁です。<br>「やつ」は奴のことです。人を愚弄する言い方ですね。でも人以外に、ものに対しても指す場合があります。<br>「や」も関西弁です。<br>これを東京の人が話すと「それはいけない人だよね～」や「それはありえないよね～」という言い方になります。元ネタを想像すると、ここでは「やつ」はものを指していると思います。</p>
<hr>
<p>せ や な<br>同意を表明する語。関西弁。「そうだね」、「そうだな」などに相当する。</p>
<hr>
<p>しんどい</p>
<ul>
<li>骨が折れる。難儀だ。<br>例文：<ul>
<li>この仕事はしんどい。</li>
</ul>
</li>
<li>くたびれている。<br>例文：<ul>
<li>しんどくてもこの仕事をやってしまおう。  </li>
<li>おお，しんどい。</li>
</ul>
</li>
</ul>
<hr>
<p>ほんま 【本真】（ 名 ・形動 ）<br>本当である・こと（さま）。真実。主に関西地方で用いる。 「 －の話やで」 「 －に驚いたわ」</p>
<hr>
<p>しゃあない<br>大阪弁で「しかたない」の意味である。</p>
<hr>
<p>アカン<br>（「埒らち明かぬ」の略。多く関西で使う）うまくいかない。だめだ。不可である。</p>
<hr>
<p>アホやん<br>ドジっ娘</p>
<p>中国語：<br>跟冒失娘（ドジっ娘）类似，关西方言</p>
<blockquote>
<p>冒失娘（ドジっ娘），萌属性之一。此属性以女性为主，若是男性可用较中性的“ドジっ子”。<br>日文“どじ”或“どぢ”是指人或事的出错和失误。“ドジっ娘”就是指经常弄翻物件、行事笨拙、“大错不出，小错不断”，总是搞出呆呆笨笨事情的少女。<br>中文意译的“冒失”，是指做事有漏失，而不是为人鲁莽无礼的意思。<br>どじっ应该不写成汉字<br>参考自维基百科</p>
</blockquote>
]]></content>
      <categories>
        <category>日本語</category>
      </categories>
      <tags>
        <tag>関西弁</tag>
      </tags>
  </entry>
</search>
